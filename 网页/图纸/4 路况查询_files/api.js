var API={singleFile:true};(function(){var g=(typeof API=="object"&&API.singleFile);window.API={_scriptName:(!g)?"lib/api.js":"api.js",_getScriptLocation:function(){var q="";var r=OpenLayers._scriptName;var m=document.getElementsByTagName("script");for(var o=0,h=m.length;o<h;o++){var s=m[o].getAttribute("src");if(s){var n=s.lastIndexOf(r);var p=s.lastIndexOf("?");if(p<0){p=s.length;}if((n>-1)&&(n+r.length==p)){q=s.slice(0,p-r.length);break;}}}return q;}};if(!g){var j=["apilib/Config/Config_debug.js","apilib/Style/CNavDefaultStyle.js","apilib/Style/CNavStyle.js","apilib/BaseTypes/Bounds.js","apilib/BaseTypes/LonLat.js","apilib/BaseTypes/Pixel.js","apilib/BaseTypes/Size.js","apilib/BaseTypes/Icon.js","apilib/BaseTypes/Point.js","apilib/Util/AjaxRemote.js","apilib/Util/CNavUtil.js","apilib/Layer/CNavTileCache.js","apilib/Layer/CNavTrafficTileCache.js","apilib/Layer/CNavOviewLayer.js","apilib/Layer/CNavDynamicMarkerLayer.js","apilib/Layer/CNavMarkersLayer.js","apilib/CNavOviewMap.js","apilib/Handler/CNavPathHandler.js","apilib/Handler/CNavPolygonHandler.js","apilib/Handler/CNavClickHandler.js","apilib/Handler/CNavRegularPolygonHandler.js","apilib/Handler/CNavDragHandler.js","apilib/Handler/CNavFeatureHandler.js","apilib/Control/CNavOviewControl.js","apilib/Control/CNavCustomImg.js","apilib/Control/CNavRemoveElementsControl.js","apilib/Control/CNavNavigation.js","apilib/Control/CNavDragRouteControl.js","apilib/Control/CNavDynamicMarkerControl.js","apilib/Control/CNavMeasureControl.js","apilib/Control/CNavNavigationControl.js","apilib/Control/CNavScaleLine.js","apilib/Control/CNavToolbar.js","apilib/Control/CNavPanZoom2.js","apilib/Control/CNavPanZoombar2.js","apilib/Control/CNavSelectCityControl.js","apilib/Control/CNavZoomInControl.js","apilib/Control/CNavSearchBoxControl.js","apilib/Control/CNavZoomOutControl.js","apilib/Control/CNavViewPortControl.js","apilib/Marker/CNavMarker.js","apilib/Marker/CNavTextMarker.js","apilib/Marker/CNavSpecialMarker.js","apilib/Draw/Draw.js","apilib/Draw/CNavLine.js","apilib/Draw/CNavCircle.js","apilib/Draw/CNavSquare.js","apilib/Draw/CNavPolygon.js","apilib/Popup/CNavPopup.js","apilib/Popup/CNavTextPopup.js","apilib/Popup/CNavRelativePopup.js","apilib/Popup/CNavSpecialTextPopup.js","apilib/Search/CNavPlaceList.js","apilib/Search/CNavSearchPOI.js","apilib/Search/CNavSearchParking.js","apilib/Search/CNavSearchHB.js","apilib/Search/CNavSearchNearby.js","apilib/Search/CNavSearchBusStop.js","apilib/Search/CNavSearchStopAround.js","apilib/Search/CNavSearchRoute.js","apilib/Search/CNavSearchBusLine.js","apilib/Search/CNavSearchRoadCondition.js","apilib/Search/CNavSearchEvents.js","apilib/Search/CNavSearchBusTransfer.js","apilib/Search/CNavSearchBox.js","apilib/CNavMap.js"];var b=navigator.userAgent;var d=(b.match("MSIE")||b.match("Safari"));if(d){var a=new Array(j.length);}var k=OpenLayers._getScriptLocation()+"lib/";for(var c=0,f=j.length;c<f;c++){if(d){a[c]="<script src='"+k+j[c]+"' charset='gb2312'><\/script>";}else{var l=document.createElement("script");l.src=k+j[c];var e=document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body;e.appendChild(l);}}if(d){document.write(a.join(""));}}})();Bounds=OpenLayers.Class(OpenLayers.Bounds,{initialize:function(d,a,b,c){OpenLayers.Bounds.prototype.initialize.apply(this,arguments);}});Icon=OpenLayers.Class(OpenLayers.Icon,{initialize:function(a,b,d,c){OpenLayers.Icon.prototype.initialize.apply(this,arguments);}});LonLat=OpenLayers.Class(OpenLayers.LonLat,{initialize:function(b,a){OpenLayers.LonLat.prototype.initialize.apply(this,arguments);},clone:function(){return new LonLat(this.lon,this.lat);}});Pixel=OpenLayers.Class(OpenLayers.Pixel,{initialize:function(a,b){OpenLayers.Pixel.prototype.initialize.apply(this,arguments);}});Point=OpenLayers.Class(OpenLayers.Geometry.Point,{initialize:function(a,b){OpenLayers.Geometry.Point.prototype.initialize.apply(this,arguments);}});Size=OpenLayers.Class(OpenLayers.Size,{initialize:function(a,b){OpenLayers.Size.prototype.initialize.apply(this,arguments);}});var CITY_URL=[],MAX_ZOOM=17,MIN_ZOOM=4,DEFAULT_CITY_CODE=null,DEFAULT_CITY_NAME="上海";var TYPE={POIType:[{name:"派出所",code:"1000000",subtype:[]},{name:"金融行业",code:"2000000",subtype:[{name:"银行",code:"2010000"},{name:"自助银行(ATM)",code:"2030000"},{name:"信用社",code:"2020000"}]},{name:"教育培训",code:"3000000",subtype:[]},{name:"文化艺术",code:"4000000",subtype:[{name:"旅游景点",code:"4120000"},{name:"书刊销售",code:"4020000"},{name:"皇宫皇陵",code:"4140000"},{name:"寺庙教堂",code:"4130000"},{name:"美术馆、雕塑馆",code:"4050000"},{name:"烈士陵园、纪念馆",code:"4080000"},{name:"书店",code:"4030000"},{name:"音像制品",code:"4010000"},{name:"画院、画社、画廊",code:"4060000"},{name:"名胜古迹",code:"4110000"},{name:"图书馆、档案、博物馆",code:"4070000"},{name:"会展中心",code:"4100000"},{name:"艺术展览",code:"4040000"},{name:"文化活动场所",code:"4090000"}]},{name:"医疗卫生",code:"5000000",subtype:[{name:"整形美容",code:"5070000"},{name:"卫生保健、康复疗养",code:"5090000"},{name:"救护",code:"5120000"},{name:"民族医院",code:"5030000"},{name:"护理医院、老年医院、临终关怀医院",code:"5080000"},{name:"其他卫生机构",code:"5110000"},{name:"医疗咨询、疾病防治",code:"5100000"},{name:"中医医院",code:"5020000"},{name:"专科医院",code:"5050000"},{name:"特色医疗",code:"5060000"},{name:"职工医院",code:"5040000"},{name:"综合医院",code:"5010000"}]},{name:"宾馆度假",code:"6000000",subtype:[{name:"招待所",code:"6050000"},{name:"酒店",code:"6020000"},{name:"旅馆(社)",code:"6040000"},{name:"宾馆",code:"6010000"},{name:"度假村",code:"6030000"}]},{name:"公共厕所",code:"7000000",subtype:[]},{name:"餐饮美食",code:"8000000",subtype:[{name:"中餐",code:"8020000"},{name:"风味特色佳肴",code:"8040000"},{name:"小吃、面点",code:"8060000"},{name:"甜品、冷饮店",code:"8070000"},{name:"快餐",code:"8090000"},{name:"咖啡馆",code:"8080000"},{name:"饭店、酒家、餐厅",code:"8010000"},{name:"美食广场",code:"8050000"},{name:"异国风味",code:"8030000"}]},{name:"休闲运动",code:"9000000",subtype:[{name:"休闲娱乐",code:"9020000"},{name:"运动场所",code:"9010000"}]},{name:"汽车服务",code:"10000000",subtype:[{name:"加油(气)站",code:"10010000"},{name:"停车场",code:"10020000"}]},{name:"交通",code:"11000000",subtype:[{name:"车站",code:"11010000"},{name:"港口、码头",code:"11020000"}]},{name:"日常服务",code:"12000000",subtype:[]},{name:"购物",code:"13000000",subtype:[{name:"购物场所",code:"13010000"},{name:"自选购物",code:"13020000"}]},{name:"通信邮政",code:"14000000",subtype:[]},{name:"其他",code:"15000000",subtype:[]},{name:"道路、门址",code:"16000000",subtype:[{name:"门址",code:"16020000"},{name:"交叉路口",code:"16030000"},{name:"兴趣点地址",code:"16040000"},{name:"道路名称",code:"16010000"}]}]};var CITY={businessType:"poiCityList",provinceList:[{proviceName:"山西省",proviceCode:"140000",cityList:[{name:"太原市",code:"140100",centerLonLat:[112.5508,37.8706]},{name:"晋城市",code:"140500",centerLonLat:[112.8423,35.5007]},{name:"运城市",code:"140800",centerLonLat:[110.9935,35.0173]},{name:"阳泉市",code:"140300",centerLonLat:[113.5805,37.8567]},{name:"忻州市",code:"140900",centerLonLat:[112.7378,38.4158]},{name:"晋中市",code:"140700",centerLonLat:[112.7528,37.687]},{name:"长治市",code:"140400",centerLonLat:[113.118,36.1956]},{name:"吕梁市",code:"141100",centerLonLat:[111.1429,37.5198]},{name:"临汾市",code:"141000",centerLonLat:[111.519,36.088]},{name:"大同市",code:"140200",centerLonLat:[113.3002,40.0763]},{name:"朔州市",code:"140600",centerLonLat:[112.433,39.3314]}]},{proviceName:"宁夏回族自治区",proviceCode:"640000",cityList:[{name:"吴忠市",code:"640300",centerLonLat:[106.1996,37.9865]},{name:"固原市",code:"640400",centerLonLat:[106.286,36.0039]},{name:"中卫市",code:"640500",centerLonLat:[105.1892,37.5161]},{name:"银川市",code:"640100",centerLonLat:[106.2872,38.464]},{name:"石嘴山市",code:"640200",centerLonLat:[106.3799,39.0222]}]},{proviceName:"河北省",proviceCode:"130000",cityList:[{name:"衡水市",code:"131100",centerLonLat:[115.697,37.7368]},{name:"唐山市",code:"130200",centerLonLat:[118.1806,39.6305]},{name:"张家口市",code:"130700",centerLonLat:[114.8875,40.8243]},{name:"邢台市",code:"130500",centerLonLat:[114.505,37.0707]},{name:"秦皇岛市",code:"130300",centerLonLat:[119.6019,39.9357]},{name:"廊坊市",code:"131000",centerLonLat:[116.7065,39.5208]},{name:"保定市",code:"130600",centerLonLat:[115.4646,38.874]},{name:"石家庄市",code:"130100",centerLonLat:[114.5147,38.0428]},{name:"沧州市",code:"130900",centerLonLat:[116.8387,38.305]},{name:"承德市",code:"130800",centerLonLat:[117.9441,40.9781]},{name:"邯郸市",code:"130400",centerLonLat:[114.4935,36.6118]}]},{proviceName:"内蒙古自治区",proviceCode:"150000",cityList:[{name:"乌海市",code:"150300",centerLonLat:[106.8216,39.6684]},{name:"赤峰市",code:"150400",centerLonLat:[118.9577,42.2649]},{name:"阿拉善盟",code:"152900",centerLonLat:[105.674,38.8369]},{name:"巴彦淖尔市",code:"150800",centerLonLat:[107.421,40.7575]},{name:"通辽市",code:"150500",centerLonLat:[122.2662,43.6193]},{name:"包头市",code:"150200",centerLonLat:[109.8403,40.6574]},{name:"兴安盟",code:"152200",centerLonLat:[122.0638,46.0781]},{name:"乌兰察布市",code:"150900",centerLonLat:[113.1079,41.0361]},{name:"鄂尔多斯市",code:"150600",centerLonLat:[110.0123,39.8185]},{name:"呼和浩特市",code:"150100",centerLonLat:[111.7485,40.8426]},{name:"锡林郭勒盟",code:"152500",centerLonLat:[116.0765,43.9441]},{name:"呼伦贝尔市",code:"150700",centerLonLat:[119.7661,49.2123]}]},{proviceName:"广东省",proviceCode:"440000",cityList:[{name:"汕尾市",code:"441500",centerLonLat:[115.3755,22.7858]},{name:"深圳市",code:"440300",centerLonLat:[114.058,22.543]},{name:"佛山市",code:"440600",centerLonLat:[113.1218,23.0221]},{name:"茂名市",code:"440900",centerLonLat:[110.9252,21.6633]},{name:"河源市",code:"441600",centerLonLat:[114.7007,23.7437]},{name:"湛江市",code:"440800",centerLonLat:[110.3595,21.2708]},{name:"惠州市",code:"441300",centerLonLat:[114.4169,23.1112]},{name:"揭阳市",code:"445200",centerLonLat:[116.3727,23.5496]},{name:"广州市",code:"440100",centerLonLat:[113.2643,23.1289]},{name:"清远市",code:"441800",centerLonLat:[113.0562,23.6818]},{name:"潮州市",code:"445100",centerLonLat:[116.623,23.6567]},{name:"韶关市",code:"440200",centerLonLat:[113.5973,24.8103]},{name:"江门市",code:"440700",centerLonLat:[113.082,22.5789]},{name:"中山市",code:"442000",centerLonLat:[113.392,22.516]},{name:"云浮市",code:"445300",centerLonLat:[112.0447,22.915]},{name:"肇庆市",code:"441200",centerLonLat:[112.4654,23.0471]},{name:"阳江市",code:"441700",centerLonLat:[111.9826,21.8583]},{name:"珠海市",code:"440400",centerLonLat:[113.5768,22.271]},{name:"梅州市",code:"441400",centerLonLat:[116.1224,24.2886]},{name:"东莞市",code:"441900",centerLonLat:[113.7516,23.02]},{name:"汕头市",code:"440500",centerLonLat:[116.6819,23.3535]}]},{proviceName:"四川省",proviceCode:"510000",cityList:[{name:"资阳市",code:"512000",centerLonLat:[104.6287,30.1289]},{name:"巴中市",code:"511900",centerLonLat:[106.7448,31.8652]},{name:"雅安市",code:"511800",centerLonLat:[103.0133,29.9805]},{name:"德阳市",code:"510600",centerLonLat:[104.3977,31.1268]},{name:"甘孜藏族自治州",code:"513300",centerLonLat:[101.9631,30.0508]},{name:"南充市",code:"511300",centerLonLat:[106.1107,30.8373]},{name:"成都市",code:"510100",centerLonLat:[104.065,30.6585]},{name:"达州市",code:"511700",centerLonLat:[107.5009,31.2117]},{name:"眉山市",code:"511400",centerLonLat:[103.8485,30.0755]},{name:"广元市",code:"510800",centerLonLat:[105.8437,32.4352]},{name:"乐山市",code:"511100",centerLonLat:[103.7654,29.5522]},{name:"绵阳市",code:"510700",centerLonLat:[104.7413,31.4647]},{name:"宜宾市",code:"511500",centerLonLat:[104.6434,28.7518]},{name:"阿坝藏族羌族自治州",code:"513200",centerLonLat:[102.2253,31.9001]},{name:"遂宁市",code:"510900",centerLonLat:[105.5679,30.5255]},{name:"广安市",code:"511600",centerLonLat:[106.6332,30.456]},{name:"自贡市",code:"510300",centerLonLat:[104.7783,29.339]},{name:"内江市",code:"511000",centerLonLat:[105.0587,29.5805]},{name:"攀枝花市",code:"510400",centerLonLat:[101.7176,26.5824]},{name:"凉山彝族自治州",code:"513400",centerLonLat:[102.2678,27.8811]},{name:"泸州市",code:"510500",centerLonLat:[105.4426,28.8717]}]},{proviceName:"贵州省",proviceCode:"520000",cityList:[{name:"黔南布依族苗族自治州",code:"522700",centerLonLat:[107.517,26.2626]},{name:"六盘水市",code:"520200",centerLonLat:[104.8772,26.575]},{name:"黔西南布依族苗族自治州",code:"522300",centerLonLat:[104.8968,25.0915]},{name:"安顺市",code:"520400",centerLonLat:[105.9476,26.253]},{name:"毕节地区",code:"522400",centerLonLat:[105.2854,27.3043]},{name:"遵义市",code:"520300",centerLonLat:[106.9272,27.7254]},{name:"黔东南苗族侗族自治州",code:"522600",centerLonLat:[107.9748,26.5852]},{name:"铜仁地区",code:"522200",centerLonLat:[109.1602,27.6916]},{name:"贵阳市",code:"520100",centerLonLat:[106.6302,26.6473]}]},{proviceName:"浙江省",proviceCode:"330000",cityList:[{name:"绍兴市",code:"330600",centerLonLat:[120.5779,30.0045]},{name:"宁波市",code:"330200",centerLonLat:[121.5498,29.8741]},{name:"杭州市",code:"330100",centerLonLat:[120.1552,30.273]},{name:"舟山市",code:"330900",centerLonLat:[122.1067,30.0202]},{name:"湖州市",code:"330500",centerLonLat:[120.0869,30.8939]},{name:"台州市",code:"331000",centerLonLat:[121.4208,28.6543]},{name:"温州市",code:"330300",centerLonLat:[120.6994,27.9949]},{name:"嘉兴市",code:"330400",centerLonLat:[120.7555,30.746]},{name:"衢州市",code:"330800",centerLonLat:[118.8735,28.9361]},{name:"丽水市",code:"331100",centerLonLat:[119.9171,28.4516]},{name:"金华市",code:"330700",centerLonLat:[119.6476,29.0781]}]},{proviceName:"陕西省",proviceCode:"610000",cityList:[{name:"汉中市",code:"610700",centerLonLat:[107.034,33.0709]},{name:"咸阳市",code:"610400",centerLonLat:[108.7095,34.3293]},{name:"榆林市",code:"610800",centerLonLat:[109.7552,38.2962]},{name:"渭南市",code:"610500",centerLonLat:[109.5102,34.5]},{name:"西安市",code:"610100",centerLonLat:[108.9442,34.2649]},{name:"商洛市",code:"611000",centerLonLat:[109.935,33.8701]},{name:"铜川市",code:"610200",centerLonLat:[108.9451,34.8967]},{name:"宝鸡市",code:"610300",centerLonLat:[107.134,34.3725]},{name:"安康市",code:"610900",centerLonLat:[109.0275,32.6892]},{name:"延安市",code:"610600",centerLonLat:[109.4898,36.5855]}]},{proviceName:"河南省",proviceCode:"410000",cityList:[{name:"鹤壁市",code:"410600",centerLonLat:[114.2973,35.7499]},{name:"开封市",code:"410200",centerLonLat:[114.3073,34.7973]},{name:"新乡市",code:"410700",centerLonLat:[113.9269,35.3025]},{name:"周口市",code:"411600",centerLonLat:[114.6533,33.6232]},{name:"三门峡市",code:"411200",centerLonLat:[111.2023,34.7801]},{name:"平顶山市",code:"410400",centerLonLat:[113.3093,33.7267]},{name:"商丘市",code:"411400",centerLonLat:[115.6514,34.4469]},{name:"濮阳市",code:"410900",centerLonLat:[115.0325,35.7593]},{name:"信阳市",code:"411500",centerLonLat:[114.0687,32.1231]},{name:"漯河市",code:"411100",centerLonLat:[114.0168,33.5815]},{name:"南阳市",code:"411300",centerLonLat:[112.5286,32.9907]},{name:"洛阳市",code:"410300",centerLonLat:[112.4536,34.618]},{name:"郑州市",code:"410100",centerLonLat:[113.625,34.7472]},{name:"驻马店市",code:"411700",centerLonLat:[114.0268,32.976]},{name:"许昌市",code:"411000",centerLonLat:[113.8523,34.0357]},{name:"焦作市",code:"410800",centerLonLat:[113.2332,35.2383]},{name:"济源市",code:"410881",centerLonLat:[112.60561,35.08189]},{name:"安阳市",code:"410500",centerLonLat:[114.3926,36.1]}]},{proviceName:"黑龙江省",proviceCode:"230000",cityList:[{name:"鹤岗市",code:"230400",centerLonLat:[130.2806,47.3287]},{name:"牡丹江市",code:"231000",centerLonLat:[129.6144,44.5877]},{name:"佳木斯市",code:"230800",centerLonLat:[130.3694,46.8122]},{name:"鸡西市",code:"230300",centerLonLat:[130.9736,45.2983]},{name:"齐齐哈尔市",code:"230200",centerLonLat:[123.9176,47.3543]},{name:"双鸭山市",code:"230500",centerLonLat:[131.1612,46.6382]},{name:"黑河市",code:"231100",centerLonLat:[127.5286,50.2454]},{name:"大兴安岭地区",code:"232700",centerLonLat:[124.3096,51.9815]},{name:"哈尔滨市",code:"230100",centerLonLat:[126.5351,45.8034]},{name:"大庆市",code:"230600",centerLonLat:[125.1025,46.5882]},{name:"伊春市",code:"230700",centerLonLat:[128.9041,47.7274]},{name:"绥化市",code:"231200",centerLonLat:[126.9917,46.6412]},{name:"七台河市",code:"230900",centerLonLat:[130.8893,45.7949]}]},{proviceName:"西藏自治区",proviceCode:"540000",cityList:[{name:"昌都地区",code:"542100",centerLonLat:[97.1777,31.141]},{name:"那曲地区",code:"542400",centerLonLat:[92.0608,31.474]},{name:"日喀则地区",code:"542300",centerLonLat:[88.8827,29.2685]},{name:"山南地区",code:"542200",centerLonLat:[91.7757,29.2252]},{name:"拉萨市",code:"540100",centerLonLat:[91.141,29.6465]},{name:"林芝地区",code:"542600",centerLonLat:[94.36,29.6724]},{name:"阿里地区",code:"542500",centerLonLat:[81.1457,30.4006]}]},{proviceName:"江苏省",proviceCode:"320000",cityList:[{name:"常州市",code:"320400",centerLonLat:[119.9563,31.7811]},{name:"徐州市",code:"320300",centerLonLat:[117.1916,34.2598]},{name:"泰州市",code:"321200",centerLonLat:[119.9231,32.4549]},{name:"苏州市",code:"320500",centerLonLat:[120.5855,31.2973]},{name:"无锡市",code:"320200",centerLonLat:[120.3029,31.5659]},{name:"连云港市",code:"320700",centerLonLat:[119.2218,34.5953]},{name:"扬州市",code:"321000",centerLonLat:[119.4136,32.3939]},{name:"镇江市",code:"321100",centerLonLat:[119.4565,32.2002]},{name:"淮安市",code:"320800",centerLonLat:[119.0156,33.6103]},{name:"盐城市",code:"320900",centerLonLat:[120.1453,33.3545]},{name:"南京市",code:"320100",centerLonLat:[118.7965,32.0584]},{name:"宿迁市",code:"321300",centerLonLat:[118.2755,33.9619]},{name:"南通市",code:"320600",centerLonLat:[120.8935,31.9824]}]},{proviceName:"新疆维吾尔自治区",proviceCode:"650000",cityList:[{name:"吐鲁番地区",code:"652100",centerLonLat:[89.1732,42.9647]},{name:"昌吉回族自治州",code:"652300",centerLonLat:[87.3084,44.0117]},{name:"克孜勒苏柯尔克孜自治州",code:"653000",centerLonLat:[76.167,39.7165]},{name:"巴音郭楞蒙古自治州",code:"652800",centerLonLat:[86.1499,41.782]},{name:"喀什地区",code:"653100",centerLonLat:[75.9882,39.4643]},{name:"阿勒泰地区",code:"654300",centerLonLat:[88.1384,47.8499]},{name:"伊犁哈萨克自治州",code:"654000",centerLonLat:[81.3276,43.9194]},{name:"和田地区",code:"653200",centerLonLat:[79.9312,37.1138]},{name:"塔城地区",code:"654200",centerLonLat:[82.9842,46.749]},{name:"哈密地区",code:"652200",centerLonLat:[93.5179,42.8227]},{name:"博尔塔拉蒙古自治州",code:"652700",centerLonLat:[82.0734,44.9021]},{name:"阿克苏地区",code:"652900",centerLonLat:[80.2629,41.1703]},{name:"乌鲁木齐市",code:"650100",centerLonLat:[87.6166,43.8265]},{name:"克拉玛依市",code:"650200",centerLonLat:[84.8723,45.5979]}]},{proviceName:"云南省",proviceCode:"530000",cityList:[{name:"普洱市",code:"530800",centerLonLat:[100.9758,22.7837]},{name:"红河哈尼族彝族自治州",code:"532500",centerLonLat:[103.3958,23.3777]},{name:"文山壮族苗族自治州",code:"532600",centerLonLat:[104.2501,23.3697]},{name:"临沧市",code:"530900",centerLonLat:[100.0879,23.8763]},{name:"楚雄彝族自治州",code:"532300",centerLonLat:[101.5451,25.0349]},{name:"曲靖市",code:"530300",centerLonLat:[103.7962,25.49]},{name:"昭通市",code:"530600",centerLonLat:[103.7154,27.3379]},{name:"玉溪市",code:"530400",centerLonLat:[102.5466,24.3519]},{name:"迪庆藏族自治州",code:"533400",centerLonLat:[99.7031,27.8192]},{name:"保山市",code:"530500",centerLonLat:[99.1631,25.1177]},{name:"大理白族自治州",code:"532900",centerLonLat:[100.2676,25.6065]},{name:"西双版纳傣族自治州",code:"532800",centerLonLat:[100.7977,22.0072]},{name:"德宏傣族景颇族自治州",code:"533100",centerLonLat:[98.5882,24.4381]},{name:"昆明市",code:"530100",centerLonLat:[102.7222,25.0379]},{name:"丽江市",code:"530700",centerLonLat:[100.2298,26.8771]},{name:"怒江傈僳族自治州",code:"533300",centerLonLat:[98.8528,25.8553]}]},{proviceName:"甘肃省",proviceCode:"620000",cityList:[{name:"天水市",code:"620500",centerLonLat:[105.7251,34.5824]},{name:"定西市",code:"621100",centerLonLat:[104.6259,35.5845]},{name:"金昌市",code:"620300",centerLonLat:[102.1877,38.5227]},{name:"白银市",code:"620400",centerLonLat:[104.1735,36.546]},{name:"临夏回族自治州",code:"622900",centerLonLat:[103.2111,35.6015]},{name:"嘉峪关市",code:"620200",centerLonLat:[98.2672,39.7987]},{name:"庆阳市",code:"621000",centerLonLat:[107.6331,35.7385]},{name:"酒泉市",code:"620900",centerLonLat:[98.5095,39.7469]},{name:"武威市",code:"620600",centerLonLat:[102.6379,37.9318]},{name:"陇南市",code:"621200",centerLonLat:[104.9193,33.3998]},{name:"张掖市",code:"620700",centerLonLat:[100.4522,38.931]},{name:"平凉市",code:"620800",centerLonLat:[106.665,35.5422]},{name:"兰州市",code:"620100",centerLonLat:[103.8342,36.0614]},{name:"甘南藏族自治州",code:"623000",centerLonLat:[102.9121,34.9836]}]},{proviceName:"吉林省",proviceCode:"220000",cityList:[{name:"松原市",code:"220700",centerLonLat:[124.825,45.1413]},{name:"辽源市",code:"220400",centerLonLat:[125.1437,42.888]},{name:"吉林市",code:"220200",centerLonLat:[126.5495,43.8378]},{name:"长春市",code:"220100",centerLonLat:[125.3231,43.893]},{name:"白城市",code:"220800",centerLonLat:[122.8387,45.6196]},{name:"通化市",code:"220500",centerLonLat:[125.94,41.7283]},{name:"四平市",code:"220300",centerLonLat:[124.35,43.166]},{name:"延边朝鲜族自治州",code:"222400",centerLonLat:[129.5091,42.8913]},{name:"白山市",code:"220600",centerLonLat:[126.4238,41.9402]}]},{proviceName:"福建省",proviceCode:"350000",cityList:[{name:"龙岩市",code:"350800",centerLonLat:[117.0341,25.1007]},{name:"三明市",code:"350400",centerLonLat:[117.6392,26.2638]},{name:"南平市",code:"350700",centerLonLat:[118.1778,26.6415]},{name:"莆田市",code:"350300",centerLonLat:[119.0077,25.454]},{name:"厦门市",code:"350200",centerLonLat:[118.0895,24.4795]},{name:"福州市",code:"350100",centerLonLat:[119.2966,26.074]},{name:"漳州市",code:"350600",centerLonLat:[117.6473,24.5135]},{name:"宁德市",code:"350900",centerLonLat:[119.5264,26.6665]},{name:"泉州市",code:"350500",centerLonLat:[118.5871,24.9074]}]},{proviceName:"辽宁省",proviceCode:"210000",cityList:[{name:"盘锦市",code:"211100",centerLonLat:[122.0721,41.1207]},{name:"锦州市",code:"210700",centerLonLat:[121.1353,41.0941]},{name:"阜新市",code:"210900",centerLonLat:[121.6697,42.022]},{name:"朝阳市",code:"211300",centerLonLat:[120.45,41.5737]},{name:"营口市",code:"210800",centerLonLat:[122.2349,40.6668]},{name:"辽阳市",code:"211000",centerLonLat:[123.1736,41.2695]},{name:"沈阳市",code:"210100",centerLonLat:[123.4319,41.8063]},{name:"葫芦岛市",code:"211400",centerLonLat:[120.837,40.711]},{name:"丹东市",code:"210600",centerLonLat:[124.3851,40.127]},{name:"抚顺市",code:"210400",centerLonLat:[123.9576,41.8807]},{name:"铁岭市",code:"211200",centerLonLat:[123.8424,42.2862]},{name:"鞍山市",code:"210300",centerLonLat:[122.9949,41.1085]},{name:"本溪市",code:"210500",centerLonLat:[123.7669,41.2941]},{name:"大连市",code:"210200",centerLonLat:[121.6148,38.9137]}]},{proviceName:"安徽省",proviceCode:"340000",cityList:[{name:"淮北市",code:"340600",centerLonLat:[116.7969,33.9741]},{name:"滁州市",code:"341100",centerLonLat:[118.3094,32.3163]},{name:"铜陵市",code:"340700",centerLonLat:[117.8173,30.9273]},{name:"池州市",code:"341700",centerLonLat:[117.4909,30.6597]},{name:"合肥市",code:"340100",centerLonLat:[117.2876,31.8651]},{name:"宣城市",code:"341800",centerLonLat:[118.7587,30.9408]},{name:"巢湖市",code:"341400",centerLonLat:[117.8648,31.5977]},{name:"六安市",code:"341500",centerLonLat:[116.4996,31.7555]},{name:"宿州市",code:"341300",centerLonLat:[116.9787,33.6405]},{name:"阜阳市",code:"341200",centerLonLat:[115.8141,32.8898]},{name:"马鞍山市",code:"340500",centerLonLat:[118.5047,31.6973]},{name:"芜湖市",code:"340200",centerLonLat:[118.3853,31.3392]},{name:"安庆市",code:"340800",centerLonLat:[117.0572,30.5249]},{name:"亳州市",code:"341600",centerLonLat:[115.7807,33.8524]},{name:"淮南市",code:"340400",centerLonLat:[117.0029,32.6248]},{name:"蚌埠市",code:"340300",centerLonLat:[117.3886,32.9155]},{name:"黄山市",code:"341000",centerLonLat:[118.3389,29.7155]}]},{proviceName:"山东省",proviceCode:"370000",cityList:[{name:"临沂市",code:"371300",centerLonLat:[118.3477,35.0513]},{name:"菏泽市",code:"371700",centerLonLat:[115.4806,35.2336]},{name:"东营市",code:"370500",centerLonLat:[118.6747,37.4336]},{name:"威海市",code:"371000",centerLonLat:[122.1216,37.5135]},{name:"青岛市",code:"370200",centerLonLat:[120.383,36.0662]},{name:"济宁市",code:"370800",centerLonLat:[116.5874,35.4145]},{name:"潍坊市",code:"370700",centerLonLat:[119.1618,36.7069]},{name:"滨州市",code:"371600",centerLonLat:[117.9707,37.3819]},{name:"济南市",code:"370100",centerLonLat:[116.9953,36.6654]},{name:"淄博市",code:"370300",centerLonLat:[118.0551,36.8129]},{name:"泰安市",code:"370900",centerLonLat:[117.0876,36.2001]},{name:"烟台市",code:"370600",centerLonLat:[121.4477,37.4636]},{name:"莱芜市",code:"371200",centerLonLat:[117.6767,36.2136]},{name:"聊城市",code:"371500",centerLonLat:[115.9853,36.457]},{name:"德州市",code:"371400",centerLonLat:[116.3024,37.4507]},{name:"日照市",code:"371100",centerLonLat:[119.5272,35.4165]},{name:"枣庄市",code:"370400",centerLonLat:[117.3236,34.8101]}]},{proviceName:"广西壮族自治区",proviceCode:"450000",cityList:[{name:"贵港市",code:"450800",centerLonLat:[109.5969,23.1068]},{name:"北海市",code:"450500",centerLonLat:[109.12,21.4812]},{name:"百色市",code:"451000",centerLonLat:[106.6178,23.9034]},{name:"河池市",code:"451200",centerLonLat:[108.0582,24.6947]},{name:"桂林市",code:"450300",centerLonLat:[110.29,25.2734]},{name:"柳州市",code:"450200",centerLonLat:[109.4155,24.3254]},{name:"梧州市",code:"450400",centerLonLat:[111.2789,23.4777]},{name:"南宁市",code:"450100",centerLonLat:[108.3666,22.8164]},{name:"来宾市",code:"451300",centerLonLat:[109.2352,23.7283]},{name:"崇左市",code:"451400",centerLonLat:[107.361,22.42]},{name:"防城港市",code:"450600",centerLonLat:[108.3472,21.6153]},{name:"玉林市",code:"450900",centerLonLat:[110.1646,22.6362]},{name:"贺州市",code:"451100",centerLonLat:[111.549,24.4132]},{name:"钦州市",code:"450700",centerLonLat:[108.6542,21.9809]}]},{proviceName:"湖北省",proviceCode:"420000",cityList:[{name:"荆门市",code:"420800",centerLonLat:[112.1995,31.0355]},{name:"黄冈市",code:"421100",centerLonLat:[114.8754,30.4546]},{name:"孝感市",code:"420900",centerLonLat:[113.9164,30.9248]},{name:"咸宁市",code:"421200",centerLonLat:[114.3221,29.8409]},{name:"随州市",code:"421300",centerLonLat:[113.3729,31.714]},{name:"十堰市",code:"420300",centerLonLat:[110.7889,32.6507]},{name:"襄樊市",code:"420600",centerLonLat:[112.1541,32.0227]},{name:"宜昌市",code:"420500",centerLonLat:[111.287,30.6921]},{name:"武汉市",code:"420100",centerLonLat:[114.3053,30.5928]},{name:"鄂州市",code:"420700",centerLonLat:[114.8851,30.4051]},{name:"恩施土家族苗族自治州",code:"422800",centerLonLat:[109.4858,30.2722]},{name:"黄石市",code:"420200",centerLonLat:[115.038,30.1993]},{name:"荆州市",code:"421000",centerLonLat:[112.2396,30.3346]}]},{proviceName:"江西省",proviceCode:"360000",cityList:[{name:"吉安市",code:"360800",centerLonLat:[114.9936,27.1139]},{name:"萍乡市",code:"360300",centerLonLat:[113.8552,27.6223]},{name:"上饶市",code:"361100",centerLonLat:[117.976,28.4431]},{name:"赣州市",code:"360700",centerLonLat:[114.9334,25.8291]},{name:"抚州市",code:"361000",centerLonLat:[116.358,27.992]},{name:"九江市",code:"360400",centerLonLat:[116.0015,29.7055]},{name:"南昌市",code:"360100",centerLonLat:[115.8851,28.6794]},{name:"新余市",code:"360500",centerLonLat:[114.9166,27.8183]},{name:"宜春市",code:"360900",centerLonLat:[114.3959,27.7973]},{name:"景德镇市",code:"360200",centerLonLat:[117.1818,29.3071]},{name:"鹰潭市",code:"360600",centerLonLat:[117.0692,28.2602]}]},{proviceName:"海南省",proviceCode:"460000",cityList:[{name:"三亚市",code:"460200",centerLonLat:[109.5117,18.2526]},{name:"海口市",code:"460100",centerLonLat:[110.3283,20.0314]}]},{proviceName:"湖南省",proviceCode:"430000",cityList:[{name:"湘潭市",code:"430300",centerLonLat:[112.943,27.8302]},{name:"湘西土家族苗族自治州",code:"433100",centerLonLat:[109.7393,28.3146]},{name:"株洲市",code:"430200",centerLonLat:[113.1345,27.8279]},{name:"怀化市",code:"431200",centerLonLat:[109.9974,27.5577]},{name:"邵阳市",code:"430500",centerLonLat:[111.4679,27.24]},{name:"永州市",code:"431100",centerLonLat:[111.614,26.4217]},{name:"张家界市",code:"430800",centerLonLat:[110.4837,29.1272]},{name:"郴州市",code:"431000",centerLonLat:[113.0146,25.7706]},{name:"常德市",code:"430700",centerLonLat:[111.6986,29.0317]},{name:"岳阳市",code:"430600",centerLonLat:[113.127,29.3571]},{name:"益阳市",code:"430900",centerLonLat:[112.3244,28.592]},{name:"娄底市",code:"431300",centerLonLat:[112.0089,27.7277]},{name:"衡阳市",code:"430400",centerLonLat:[112.572,26.8932]},{name:"长沙市",code:"430100",centerLonLat:[112.9389,28.2278]}]},{proviceName:"青海省",proviceCode:"630000",cityList:[{name:"海北藏族自治州",code:"632200",centerLonLat:[100.8968,36.969]},{name:"海南藏族自治州",code:"632500",centerLonLat:[100.6176,36.2784]},{name:"海西蒙古族藏族自治州",code:"632800",centerLonLat:[97.3708,37.3775]},{name:"海东地区",code:"632100",centerLonLat:[102.1105,36.507]},{name:"玉树藏族自治州",code:"632700",centerLonLat:[97.0093,33.0054]},{name:"黄南藏族自治州",code:"632300",centerLonLat:[102.0159,35.5165]},{name:"果洛藏族自治州",code:"632600",centerLonLat:[100.2408,34.4786]},{name:"西宁市",code:"630100",centerLonLat:[101.7778,36.6173]}]}],specialRegionList:[{name:"天津市",code:"120000",centerLonLat:[117.2146,39.1209]},{name:"台湾省",code:"710000",centerLonLat:[121.0275,23.6887]},{name:"香港特别行政区",code:"810000",centerLonLat:[114.2104,22.354]},{name:"重庆市",code:"500000",centerLonLat:[106.5522,29.5628]},{name:"上海市",code:"310000",centerLonLat:[121.4739,31.23]},{name:"北京市",code:"110000",centerLonLat:[116.4074,39.9046]}]};OpenLayers.IMAGE_RELOAD_ATTEMPTS=5;OpenLayers.Util.onImageLoadErrorColor="#fff";var AjaxRemote=function(a){this.head=document.getElementsByTagName("head")[0];this.display=true;if(a==false){this.display=a;}};var AjaxRequest={count:0,display:false};AjaxRemote.prototype={loadUrl:function(a,h,d,e,c){transId=OpenLayers.Util.createUniqueID("_Id_");if(d){this.map=d.map||d;}var k={id:transId,cb:"stcCallback"+transId,scriptId:"stcscript"+transId,url:a,params:h,caller:d,onComplete:e,onFailure:c};var f=this;window[k.cb]=function(l){f.handleResponse(l,k);};if(h){a+="?callback="+k.cb;h.bizcode=window.__BIZCODE;var b=window.DEFAULT_LANGUAGE?window.DEFAULT_LANGUAGE:null;if(b){h.lang=b;}var g=OpenLayers.Util.getParameterString(h);if(g.length>0){var i=(a.indexOf("?")>-1)?"&":"?";a+=i+g;}a+="&r="+Math.random();}var j=document.createElement("script");j.setAttribute("src",a);j.setAttribute("type","text/javascript");j.setAttribute("id",k.scriptId);j.setAttribute("charset","utf-8");k.timeoutId=setTimeout(OpenLayers.Function.bind(this.handleFailure,f,k),10000);if(this.map){this.showLoad();}this.head.appendChild(j);},handleResponse:function(b,a){this.destroyTrans(a,true);a.onComplete.call(a.caller||window,b);},add:function(a){AjaxRequest.count=AjaxRequest.count+(a);},showLoad:function(){if(this.display){this.add(1);if(!AjaxRequest.display){this.map.loading.div.style.display="block";AjaxRequest.display=true;}}},hideLoad:function(){this.map.loading.div.style.display="none";AjaxRequest.display=false;},hide:function(a){if(this.display){this.add(a);if(!AjaxRequest.count){this.hideLoad();}}},handleFailure:function(a){this.destroyTrans(a,false);if(a.onFailure){a.onFailure.call(a.caller||window,null);}else{alert("超时");}},destroyTrans:function(b,a){var f=document.getElementById(b.scriptId);if(f.parentNode==this.head){this.head.removeChild(f);}clearTimeout(b.timeoutId);this.hide(-1);if(a){window[b.cb]=undefined;try{delete window[b.cb];}catch(d){}}else{window[b.cb]=function(){window[b.cb]=undefined;try{delete window[b.cb];}catch(c){}};}}};SmsHelper={send:function(d,a,c){if(d&&a&&c){var b={loop:1,id:d,content:a,listener:c,serviceType:""};this.__getRemote(b);}},__getRemote:function(c){var d=OpenLayers.Function.bind(this.__callback,this,c);var a=OpenLayers.Function.bind(this.__failure,this,c);var b=CNavUtil.__ajaxRemote;b.loadUrl(SERVER_URL+"/SmsMobileServlet",{msisdn:c.id,smsContent:c.content,IEtemp:true},this,d,a);},__callback:function(b,c){if(c){var a=this._buildList(c,b);if(a){b.listener.apply(this,[a]);}else{if(b.loop<2){b.loop++;this.__getRemote(b);}else{return null;}}}},__failure:function(a,b){if(a.loop<2){a.loop++;this.__getRemote(a);}else{return null;}},__buildList:function(a){return a;},CLASS_NAME:"SmsHelper"};var CNavUtil={_loadURL:function(d,g,b,e,c){if(typeof g=="string"){g=OpenLayers.Util.getParameters(g);}var f=(e)?e:OpenLayers.nullHandler;var a=(c)?c:OpenLayers.nullHandler;return OpenLayers.Request.GET({url:d,params:g,success:f,failure:a,async:false,scope:b});},_buildDesc:function(a,b){if(b){return"暂时获取不到该点位置信息";}return a.info;},_buildPOIList:function(b,h){if(h){return null;}if(b.ExceptionMessage){return null;}var e=b.features;var a=[];for(var d=0;d<e.length;d++){var g=e[d];var k=g.geometry.coordinates;var j=g.properties;a.push({pid:g.id,name:j.name,lonlat:new OpenLayers.LonLat(k[0],k[1]),addr:j.addr,tel:j.tel,orgid:j.hbid?j.hbid:"0",dist:j.dist?j.dist:"0"});}return a;},_buildRouteList:function(a,b){if(b){return null;}if(a.ExceptionMessage){return null;}return a;},_evalResponse:function(resp){return eval("("+resp.responseText+")");},EPSG4326:new OpenLayers.Projection("EPSG:4326"),EPSG900913:new OpenLayers.Projection("EPSG:900913"),_toMerc:function(b){if(!b||!b.lon){return;}var a=new LonLat(b.lon,b.lat);a.transform(this.EPSG4326,this.EPSG900913);return a;},_toWGS84:function(b){if(!b||!b.lon){return;}var a=new LonLat(b.lon,b.lat);a.transform(this.EPSG900913,this.EPSG4326);return a;},__getStaticMap:function(d,b,c){var a=d.name+","+d.x+","+d.y;delete d.name;delete d.x;delete d.y;d=OpenLayers.Util.extend(d,{serviceType:"MapHighlightService",reqFlag:"http",hl:a,callers:c,callback:b,loop:1});CNavUtil.__staticMapRemote(d);},__staticMapRemote:function(c){var d=OpenLayers.Function.bind(CNavUtil.__staticMapCallback,this,c);var a=OpenLayers.Function.bind(CNavUtil.__staticMapfailure,this,c);var b=CNavUtil.__ajaxRemote;b.loadUrl(SERVER_URL+"query.do",c,c.callers,d,a);},__staticMapCallback:function(a,b){if(b){a.callback(b);}else{CNavUtil.__staticMapfailure(a);}},__staticMapfailure:function(a,b){if(a.loop<2){a.loop++;CNavUtil.__staticMapRemote(a);}else{a.callback(null);}},__ajaxRemote:new AjaxRemote(),__ajaxRemoteF:new AjaxRemote(false),get_TIMESTAMP_URL_ByCode:function(b){var c;for(var a=0;a<CITY_URL.length;a++){if(CITY_URL[a]["CITYCODE"]===b){c=CITY_URL[a]["TIMESTAMP_URL"];}}return c;},get_TRAFFIC_PIV_URL_ByCode:function(c){var a;for(var b=0;b<CITY_URL.length;b++){if(CITY_URL[b]["CITYCODE"]===c){a=CITY_URL[b]["TRAFFIC_PIV_URL"];}}return a;},get_CITYNAME_ByCode:function(c){var a;for(var b=0;b<CITY_URL.length;b++){if(CITY_URL[b]["CITYCODE"]===c){a=CITY_URL[b]["CITYNAME"];}}return a;},get_HIS_TRAF_URL_ByCode:function(b){var c;for(var a=0;a<CITY_URL.length;a++){if(CITY_URL[a]["CITYCODE"]===b){c=CITY_URL[a]["HIS_TRAF_URL"];}}return c;}};CNavPathHandler=OpenLayers.Class(OpenLayers.Handler.Path,{initialize:function(c,b,a){OpenLayers.Handler.Path.prototype.initialize.apply(this,arguments);},calArea:function(){var b=this.map.calculateBounds();var a=20;return new OpenLayers.Bounds((b.left+b.getWidth()/a),(b.bottom+b.getHeight()/a),(b.right-b.getWidth()/a),(b.top-b.getHeight()/a));},activate:function(){var a=OpenLayers.Handler.Path.prototype.activate.apply(this,arguments);this.map.removeLayer(this.layer);this.layer=this.map.dynamicVectorLayer;return a;},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return false;}if(this.drawing){this.cancel();}if(this.layer.map){}this.layer=null;return true;},triggerMove:function(a,d){var b=this.map.getLonLatFromPixel(a.xy);var c=this.calArea();if(b.lon<c.left&&b.lat>c.top){this.map.pan(-d,-d);}else{if(b.lon<c.left&&b.lat<c.bottom){this.map.pan(-d,d);}else{if(b.lon>c.right&&b.lat>c.top){this.map.pan(d,-d);}else{if(b.lon>c.right&&b.lat<c.bottom){this.map.pan(d,d);}else{if(c.left>b.lon){this.map.pan(-d,0);}else{if(c.right<b.lon){this.map.pan(d,0);}else{if(c.top<b.lat){this.map.pan(0,-d);}else{if(c.bottom>b.lat){this.map.pan(0,d);}}}}}}}}},mouseover:function(a){},mousemove:function(a){if(this.drawing){this.triggerMove(a,80);var b=this.map.getLonLatFromPixel(a.xy);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.point.geometry.clearBounds();if(this.mouseDown&&this.freehandMode(a)){this.addPoint();}else{this.modifyFeature();}this.drawFeature();this.lastevt=a;}return true;},click:function(a){},dblclick:function(a){this.lastevt=a;return OpenLayers.Handler.Path.prototype.dblclick.apply(this,arguments);},createFeature:function(){this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString());this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point());this.layer.addFeatures([this.line],{silent:true});},drawFeature:function(){this.layer.drawFeature(this.line,this.style);},CLASS_NAME:"CNavPathHandler"});CNavPolygonHandler=OpenLayers.Class(CNavPathHandler,{polygon:null,initialize:function(c,b,a){CNavPathHandler.prototype.initialize.apply(this,arguments);},createFeature:function(){this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon());this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing());this.polygon.geometry.addComponent(this.line.geometry);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point());this.layer.addFeatures([this.polygon,this.point],{silent:true});},destroyFeature:function(){CNavPathHandler.prototype.destroyFeature.apply(this);this.polygon=null;},modifyFeature:function(){var a=this.line.geometry.components.length-2;this.line.geometry.components[a].x=this.point.geometry.x;this.line.geometry.components[a].y=this.point.geometry.y;this.line.geometry.components[a].clearBounds();},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);},getGeometry:function(){var a=this.polygon.geometry;if(this.multi){a=new OpenLayers.Geometry.MultiPolygon([a]);}return a;},dblclick:function(a){this.lastevt=a;if(!this.freehandMode(a)){var b=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[b]);if(this.persist){this.destroyPoint();}this.finalize();}return false;},createFeature:function(){this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon());this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing());this.polygon.geometry.addComponent(this.line.geometry);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point());this.layer.addFeatures([this.polygon],{silent:true});},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);},CLASS_NAME:"CennaviPolygon"});CNavClickHandler=OpenLayers.Class(OpenLayers.Handler.Click,{initialize:function(){OpenLayers.Handler.Click.prototype.initialize.apply(this,arguments);},mouseup:function(b){var a=true;if(this.checkModifiers(b)&&OpenLayers.Event.isRightClick(b)){if(this.control.handleDoubleRightClick){propogate=this.rightclick(b);}else{if(this.control.handleSingleRightClick){this.callback("contextmenu",[b]);}}}return a;}});CNavDragHandler=OpenLayers.Class(OpenLayers.Handler.Drag,{initialize:function(){OpenLayers.Handler.Drag.prototype.initialize.apply(this,arguments);},mousedown:function(b){var a=true;this.dragging=false;if(this.checkModifiers(b)&&OpenLayers.Event.isLeftClick(b)){this.started=true;this.start=b.xy;this.last=b.xy;this.map.div.style.cursor="move";this.down(b);this.callback("down",[b.xy,b]);OpenLayers.Event.stop(b);if(!this.oldOnselectstart){this.oldOnselectstart=(document.onselectstart)?document.onselectstart:function(){return true;};document.onselectstart=function(){return false;};}a=!this.stopDown;}else{this.started=false;this.start=null;this.last=null;}return a;}});CNavFeatureHandler=OpenLayers.Class(OpenLayers.Handler.Feature,{handle:function(a){var c=a.type;var f=false;var e=!!(this.feature);var d=(c=="click"||c=="dblclick");if(c=="mousemove"&&e){this.feature=this.layer.getFeatureFromEvent(a);}if(c=="dblclick"){this.feature=this.layer.getFeatureFromEvent(a);}this.feature=this.layer.getFeatureFromEvent(a);if(this.feature){var b=(this.feature!=this.lastFeature);if(this.geometryTypeMatches(this.feature)){if(e&&b){this.triggerCallback(c,"in",[this.feature,a]);}else{if(e&&!b&&!d){this.triggerCallback(c,"in",[this.feature,a]);}else{if(!e||d){this.triggerCallback(c,"in",[this.feature,a]);}}}this.lastFeature=this.feature;f=true;}else{if(e&&b||(d&&this.lastFeature)){this.triggerCallback(c,"out",[this.lastFeature,a]);}this.feature=null;}}else{if(e||(d&&this.lastFeature)){this.triggerCallback(c,"out",[this.lastFeature,a]);}}return f;},dblclick:function(a){var d=this.layer.getFeatureFromEvent(a);if(d&&d.__flag){if(d.__flag=="middle"){if(this.control.marker){this.control.layer.removeFeatures([this.control.marker]);}this.control.over=false;this.control.upFeature(a.xy);var b=OpenLayers.Util.indexOf(this.control.search.trip.byway,d.__lonlat);OpenLayers.Util.removeItem(this.control.search.trip.byway,d.__lonlat);var e=OpenLayers.Util.indexOf(this.control.__byWay,d);OpenLayers.Util.removeItem(this.control.__byWay,d);var c={lonlat:d.__lonlat,index:b,index2:e,t:"d"};this.control.layer.removeFeatures([d]);this.control.search.trip.__noPanZoom=true;this.control.search.trip.__feature=null;this.control.search.trip.__oldLonLat=null;this.control.search.trip.__delOption=c;this.control.search.__getRemote(this.control.search.trip);}}return !this.handle(a);},click:function(a){this.control.over=false;this.control.upFeature(a.xy);if(this.control.marker){this.control.layer.removeFeatures([this.control.marker]);}return this.handle(a)?!this.stopClick:true;},CLASS_NAME:"CNavFeatureHandler"});CNavRegularPolygonHandler=OpenLayers.Class(OpenLayers.Handler.RegularPolygon,{irregular:true,initialize:function(c,b,a){OpenLayers.Handler.RegularPolygon.prototype.initialize.apply(this,arguments);},activate:function(){var a=OpenLayers.Handler.RegularPolygon.prototype.activate.apply(this,arguments);this.map.removeLayer(this.layer);this.layer=this.map.dynamicVectorLayer;return a;},deactivate:function(){var a=false;if(OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)){if(this.dragging){this.cancel();}if(this.layer.map!=null){}this.layer=null;a=true;}return a;},up:function(a){this.lastevt=a;this.finalize();},out:function(a){this.lastevt=a;this.finalize();},callback:function(b,a){if(this.callbacks[b]){this.callbacks[b].apply(this.control,[this.feature.geometry.clone()]);}if(this.persist&&(b=="done"||b=="cancel")){this.clear();}},CLASS_NAME:"CNavRegularPolygonHandler"});CNavStyle=OpenLayers.Class({style:null,initialize:function(b){this.style=CNavDefaultStyle.clone();if(b){for(var a in b){this.style[a]=b[a];}}},getStyle:function(){return this.style;},setStyle:function(a){OpenLayers.Util.extend(this.style,a);},clone:function(){return new CNavStyle(this.style);},CLASS_NAME:"CNavStyle"});CNavDefaultStyle={clone:function(){return{fillColor:"#FFFFFF",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#FF6633",strokeOpacity:1,strokeWidth:6,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",arrow:false};},getStyleMap:function(b){var a={externalGraphic:OpenLayers.Util.getImagesLocation()+"marker-blue.png",graphicZIndex:10,backgroundGraphicZIndex:11};OpenLayers.Util.extend(a,b);return a;}};CNavDynamicMarkerLayer=OpenLayers.Class(OpenLayers.Layer.Vector,{initialize:function(b,a){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments);this.styleMap=new OpenLayers.StyleMap({externalGraphic:"img/marker-gold.png",backgroundGraphic:"http://openlayers.org/dev/examples/marker_shadow.png",backgroundXOffset:0,backgroundYOffset:-7,graphicZIndex:10,backgroundGraphicZIndex:11,pointRadius:10,fillColor:"#FFFFFF",fillOpacity:1,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#FF6633",strokeOpacity:1,strokeWidth:5,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",arrow:false});this.isBaseLayer=false;this.rendererOptions={yOrdering:true};},CLASS_NAME:"CNavDynamicMarkerLayer"});CNavTileCache=OpenLayers.Class(OpenLayers.Layer.TileCache,{initialize:function(d,c,b){var a=OpenLayers.Util.extend({format:"image/png",isBaseLayer:true},b);OpenLayers.Layer.TileCache.prototype.initialize.apply(this,[d,c,{},a]);this.extension=this.format.split("/")[1].toLowerCase();this.extension=(this.extension=="jpg")?"jpeg":this.extension;this.transitionEffect="resize";this.buffer=0;},refresh:function(){if(this.visibility){this.clearGrid();this.redraw();this.map.updateSize();}},getURL:function(e){var b=this.map.getResolution();var g=this.map.getMaxExtent();var a=this.tileSize;var f=Math.round((e.left-g.left)/(b*a.w));var d=Math.round((g.top-e.top)/(b*a.h));var c=this.map.zoom+this.map.minZoom;c>MAX_ZOOM?MAX_ZOOM:c;if(c==3&&f>(Math.pow(2,c)-1)){f=f-Math.pow(2,c);}if(f<0){f=f+Math.round(g.getWidth()/e.getWidth());}if(d<0){d=d+Math.round(g.getHeight()/e.getHeight());}return this.getTilePic(f,d,c);},getTilePic:function(a,i,h){var d="";if(h>6){var f=Math.pow(2,h-5);var e="R"+Math.floor(i/f);var g="C"+Math.floor(a/f);d=h+"/"+e+"/"+g+"/";}else{d=h+"/";}var c=h+"-"+a+"-"+i;var b=this.url+d+c+".png";return b;},clone:function(a){if(a==null){a=new CNavTileCache(this.name,this.url,this.options);}a=OpenLayers.Layer.TileCache.prototype.clone.apply(this,[a]);return a;},CLASS_NAME:"CNavTileCache"});CNavOviewLayer=OpenLayers.Class(CNavTileCache,{initialize:function(c,b,a){tempoptions=OpenLayers.Util.extend({format:"image/png",isBaseLayer:true},a);CNavTileCache.prototype.initialize.apply(this,[c,b,{},tempoptions]);this.extension=this.format.split("/")[1].toLowerCase();this.extension=(this.extension=="jpg")?"jpeg":this.extension;this.transitionEffect="resize";this.buffer=0;},getURL:function(e){var b=this.map.getResolution();var g=this.map.getMaxExtent();var a=this.tileSize;var f=Math.round((e.left-g.left)/(b*a.w));var d=Math.round((g.top-e.top)/(b*a.h));var c=this.map.zoom;if(f>(Math.pow(2,c)-1)){f=f-Math.pow(2,c);}return this.getTilePic(f,d,c);},clone:function(a){if(a==null){a=new CNavOviewLayer(this.name,this.url,this.options);}a=CNavTileCache.prototype.clone.apply(this,[a]);return a;},CLASS_NAME:"CNavOviewLayer"});CNavMarkersLayer=OpenLayers.Class(OpenLayers.Layer.Markers,{initialize:function(b,a){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments);},moveTo:function(d,b,f){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(b||!this.drawn){if(this.markers.length<20){for(var c=0,a=this.markers.length;c<a;c++){this.drawMarker(this.markers[c]);}}else{this.div.style.display="none";var e=document.createDocumentFragment();for(var c=0,a=this.markers.length;c<a;c++){e.appendChild(this.__drawMarker(this.markers[c]));}this.div.appendChild(e);this.div.style.display="block";}this.drawn=true;}},__addMarker:function(a){this.markers.push(a);if(this.opacity!=null){a.setOpacity(this.opacity);}var b;if(this.map&&this.map.getExtent()){a.map=this.map;b=this.__drawMarker(a);}return b;},addMarker:function(b){this.markers.push(b);if(this.opacity!=null){b.setOpacity(this.opacity);}if(b.popups&&b.bshow){for(var c=0;c<b.popups.length;c++){var a=b.popups[c];this.map.addPopup(a);a.updatePosition();b.__popupAdded=true;}}else{if(b.popup&&b.bshow){var a=b.popup;this.map.addPopup(a);a.updatePosition();b.__popupAdded=true;}}if(this.map&&this.map.getExtent()){b.map=this.map;this.drawMarker(b);}},__drawMarker:function(a){var b=this.map.getLayerPxFromLonLat(a.lonlat);if(b==null){a.display(false);}else{var c=a.draw(b);if(!a.drawn){a.drawn=true;}return c;}return null;},addMarkerArray:function(h){var f=this;var e=document.createDocumentFragment();var g=document.createDocumentFragment();if(h.constructor===Array){for(var d=0;d<h.length;d++){var b=h[d];if(b.popups&&b.popups.length>0&&b.bshow){for(var c=0;c<b.popups.length;c++){var a=b.popups[c];e.appendChild(this.map.__addPopup(a));a.updatePosition();b.__popupAdded=true;}}else{if(b.popup&&b.bshow){var a=b.popup;e.appendChild(this.map.__addPopup(a));a.updatePosition();b.__popupAdded=true;}}g.appendChild(f.__addMarker(b));this.markers.push(b);}this.map.layerContainerDiv.appendChild(e);f.div.appendChild(g);}},removeMarker:function(b){if(this.markers&&this.markers.length){if(b.popups){for(var c=0;c<b.popups.length;c++){var a=b.popups[c];this.map.removePopup(a);}}else{if(b.popup){this.map.removePopup(a);}}OpenLayers.Util.removeItem(this.markers,b);if((b.icon!=null)&&(b.icon.imageDiv!=null)&&(b.icon.imageDiv.parentNode==this.div)){this.div.removeChild(b.icon.imageDiv);b.drawn=false;}}},clearMarkers:function(b){if(b&&b.length>0){for(var a=0;a<b.length;a++){this.removeMarker(b[a]);}}else{if(this.markers!=null){while(this.markers.length>0){this.removeMarker(this.markers[0]);}}}},getMarkerById:function(c){if(!c){return null;}var b=this;for(var a=0;a<b.markers.length;a++){if(b.markers[a].id===c){return b.markers[a];}}return null;},CLASS_NAME:"CNavMarkersLayer"});CNavTrafficTileCache=OpenLayers.Class(CNavTileCache,{timeID:null,timeCallback:function(){},curentTimeStamp:null,initialize:function(c,b,a){CNavTileCache.prototype.initialize.apply(this,arguments);this.transitionEffect=null;this.alpha=false;if(window.DD_belatedPNG){this.events.on({moveend:this.__tmp,scope:this});}},__tmp:function(){this.setVisibility(false);if(this.timeout){window.clearTimeout(this.timeout);}var a=function(){this.setVisibility(true);this.refresh();};var b=OpenLayers.Function.bind(a,this);this.timeout=window.setTimeout(b,300);},destroy:function(){CNavTileCache.prototype.destroy.apply(this,arguments);this.unregisterRefresh();},getTilePic:function(a,k,j){var e="";if(j>6){var h=Math.pow(2,j-5);var g="R"+Math.floor(k/h);var i="C"+Math.floor(a/h);e=j+"/"+g+"/"+i+"/";}else{e=j+"/";}var d=j+"-"+a+"-"+k;var c=this.map.getCurrentCode();var f=CNavUtil.get_TRAFFIC_PIV_URL_ByCode("000000");this.url=TRAFFIC_PIV_URL;if(f!=undefined){if(f==="0"){this.url=CNavUtil.get_TRAFFIC_PIV_URL_ByCode(c);}else{this.url=f;}}var b=this.url+e+d+".png?r="+Math.random();return b;},__getTimeStamp:function(c){var e=c?c:null;if(!e){e={loop:1};}var d=new AjaxRemote(false);var a=OpenLayers.Function.bind(this.__callback,this,e);var b=OpenLayers.Function.bind(this.__failure,this,e);d.loadUrl(SERVER_URL+"timestamp",{serviceType:"timeService",citycode:DEFAULT_CITY_CODE},this,a,b);},__callback:function(d,e){if(e&&e.info){var b=e.info+"";var a=OpenLayers.String.trim(b);if(!OpenLayers.String.contains(a,"Error")){var c=a.substring(a.length-4);a=c.substring(0,2)+":"+c.substring(2);if(this.curentTimeStamp!==a){this.refresh();this.curentTimeStamp=a;}this.timeCallback(a);}}},__failure:function(a,b){if(a.loop<2){a.loop++;this.__getTimeStamp(a);}else{return null;}},stopInterval:function(){if(this.timeID){window.clearInterval(this.timeID);}this.timeID=null;},startInterval:function(){if(this.timeID){this.stopInterval();}this.timeID=window.setInterval(OpenLayers.Function.bind(this.__getTimeStamp,this),60000);},start:function(){this.url=TRAFFIC_PIV_URL;this.__getTimeStamp();this.setVisibility(true);this.startInterval();},toHistory:function(b,d){var c=this.map.getCurrentCode();var a=CNavUtil.get_HIS_TRAF_URL_ByCode("000000");this.url=HIS_TRAF_URL+b+"/"+d+"/";if(a!=undefined){if(a==="0"){this.url=CNavUtil.get_TRAFFIC_PIV_URL_ByCode(c);}else{this.url=a;}}this.redraw();},registerRefresh:function(){if(this.map){this.map.registerEvents({changecity:this.refresh,scope:this});}},unregisterRefresh:function(){if(this.map){this.map.unregisterEvents({changecity:this.refresh,scope:this});}},addTileMonitoringHooks:function(c){c.onLoadStart=function(){if(this.numLoadingTiles==0){this.events.triggerEvent("loadstart");}this.numLoadingTiles++;};c.events.register("loadstart",this,c.onLoadStart);var b=function(e){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");if(this.numLoadingTiles==0){this.events.triggerEvent("loadend");}if(window.DD_belatedPNG){DD_belatedPNG.fix("#"+e.imgDiv.id);}};var a=function(e){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");if(this.numLoadingTiles==0){this.events.triggerEvent("loadend");}};var d=OpenLayers.Function.bind(b,this,c);c.onLoadEnd=d;c.onLoadEnd1=a;c.events.register("loadend",this,c.onLoadEnd);c.events.register("unload",this,c.onLoadEnd1);},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd1,scope:this});},CLASS_NAME:"CNavTrafficTileCache"});Draw=OpenLayers.Class({id:null,layer:null,style:null,defaultStyle:CNavDefaultStyle.clone(),initialize:function(a){this.id=OpenLayers.Util.createUniqueID("CNavLine");OpenLayers.Util.extend(this,a);if(this.style){OpenLayers.Util.extend(this.defaultStyle,this.style.getStyle());}},initLayer:function(){var a=API.map;if(!a.dynamicVectorLayer){a.dynamicVectorLayer=new OpenLayers.Layer.Vector("staticVectorLayer",{style:this.defaultStyle});a.addLayer(a.dynamicVectorLayer);}this.layer=a.dynamicVectorLayer;this.initStyle();},initStyle:function(){this.layer.style=this.defaultStyle;},create:function(){},addToMap:function(a){},set:function(){},clear:function(a){if(a){if(a instanceof Array){this.layer.removeFeatures(a);}else{this.layer.removeFeatures([a]);}}else{this.layer.removeFeatures(this.layer.features);}},getDataExtent:function(){return this.layer.getDataExtent();},CLASS_NAME:"Draw"});CNavLine=OpenLayers.Class(Draw,{points:null,initialize:function(b,a){Draw.prototype.initialize.apply(this,[a]);this.points=b;},create:function(){if((!this.points)||(!this.points instanceof Array)){return;}var d=[];var c;for(c=0,arr=this.points;c<arr.length;c++){var b=new OpenLayers.Geometry.Point(arr[c][0],arr[c][1]);b.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));d.push(b);}var e=[];for(c=0;c<d.length-1;c++){var a=[d[c],d[c+1]];e.push(new OpenLayers.Geometry.LineString(a));}return e;},addToMap:function(c){this.initLayer();var d=this.create();var b=[];for(var a=0;a<d.length;a++){b.push(new OpenLayers.Feature.Vector(d[a]));}if(c){this.clear(this.layer.features);}this.layer.addFeatures(b);return b;},set:function(a){this.points=a;},CLASS_NAME:"CNavLine"});CNavCircle=OpenLayers.Class(Draw,{point:null,R:null,initialize:function(a,c,b){Draw.prototype.initialize.apply(this,[b]);this.point=a;this.R=c;},create:function(){if(!this.point||!this.R){return;}var a=new OpenLayers.Geometry.Point(this.point.lon,this.point.lat);a.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));var b=this.createRegularPolygon(a,this.R,40);return b;},addToMap:function(b){this.initLayer();var c=this.create();var a=new OpenLayers.Feature.Vector(c);if(b){this.clear(this.layer.features);}this.layer.addFeatures(a);return a;},set:function(a,b){this.point=a;this.R=b;},createRegularPolygon:function(i,f,d,m){var e=Math.PI*((1/d)-(1/2));if(m){e+=(m/180)*Math.PI;}var b,h,g;var k=[];b=e;h=i.x+(f*Math.cos(b));g=i.y+(f*Math.sin(b));k.push(new OpenLayers.Geometry.Point(h,g));var c=k.shift();var l=new OpenLayers.LonLat(c.x,c.y);var j=new OpenLayers.LonLat(i.x,i.y);l=CNavUtil._toWGS84(l);j=CNavUtil._toWGS84(j);var a=OpenLayers.Util.distVincenty(l,j)*1000;f=f*f/a;return OpenLayers.Geometry.Polygon.createRegularPolygon(i,f,d,m);},CLASS_NAME:"CNavCircle"});CNavSquare=OpenLayers.Class(CNavCircle,{initialize:function(a,b,c){Draw.prototype.initialize.apply(this,[c]);this.point=a;this.w=b;},create:function(){if(!this.point||!this.w){return;}var b=new OpenLayers.Geometry.Point(this.point.lon,this.point.lat);b.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));this.w*=2;var c=this.w*this.w/4;var a=Math.sqrt(2*c);var d=this.createRegularPolygon(b,a,4);return d;},set:function(a,b){this.point=a;this.w=b;}});CNavPolygon=OpenLayers.Class(Draw,{points:null,initialize:function(b,a){Draw.prototype.initialize.apply(this,[a]);this.points=b;},create:function(){if((!this.points)||(!this.points instanceof Array)){return;}var e=[];var d;for(d=0,arr=this.points;d<arr.length;d++){var c=new OpenLayers.Geometry.Point(arr[d][0],arr[d][1]);c.transform(CNavUtil.EPSG4326,CNavUtil.EPSG900913);e.push(c);}var a=new OpenLayers.Geometry.LinearRing(e);var b=new OpenLayers.Geometry.Polygon([a]);return b;},addToMap:function(c){this.initLayer();var b=this.create();var a=new OpenLayers.Feature.Vector(b);if(c){this.clear(this.layer.features);}this.layer.addFeatures(a);return a;},set:function(a){this.points=a;},CLASS_NAME:"CNavLine"});CNavNavigation=OpenLayers.Class(OpenLayers.Control.Navigation,{initialize:function(a){OpenLayers.Control.Navigation.prototype.initialize.apply(this,arguments);},deactivate:function(){if(this.zoomBox){this.zoomBox.deactivate();}if(this.dragPan){this.dragPan.deactivate();}if(this.handlers&&this.handlers.click){this.handlers.click.deactivate();}if(this.handlers&&this.handlers.wheel){this.handlers.wheel.deactivate();}return OpenLayers.Control.prototype.deactivate.apply(this,arguments);},CLASS_NAME:"CNavNavigation"});CNavNavigationControl=OpenLayers.Class(OpenLayers.Control.Navigation,{Navigation:null,initialize:function(a){OpenLayers.Control.Navigation.prototype.initialize.apply(this,arguments);this.zoomWheelEnabled=false;if(a&&a.Navigation){this.Navigation=a.Navigation;}},activate:function(){this.dragPan.activate();if(this.zoomWheelEnabled){this.handlers.wheel.activate();}return OpenLayers.Control.prototype.activate.apply(this,arguments);},deactivate:function(){if(this.zoomBox){this.zoomBox.deactivate();}if(this.dragPan){this.dragPan.deactivate();}if(this.handlers&&this.handlers.click){this.handlers.click.deactivate();}if(this.handlers&&this.handlers.wheel){this.handlers.wheel.deactivate();}return OpenLayers.Control.prototype.deactivate.apply(this,arguments);},draw:function(){if(this.handleRightClicks){this.map.div.oncontextmenu=function(){return false;};}this.dragPan=new CNavDragPanControl(OpenLayers.Util.extend({map:this.map,Navigation:this.Navigation},this.dragPanOptions));this.dragPan.draw();this.activate();}});CNavDragPanControl=OpenLayers.Class(OpenLayers.Control.DragPan,{Navigation:null,initialize:function(a){OpenLayers.Control.DragPan.prototype.initialize.apply(this,arguments);if(a&&a.Navigation){this.Navigation=a.Navigation;}},panMapDone:function(a){if(this.panned){this.panMap(a);if(this.Navigation){this.Navigation.updateMapToRect();}this.panned=false;}}});CNavDragRouteControl=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(b,a){},onDrag:function(b,a){if(this.search.searchOnMove){this.__timerPixel=a;if(!this.__timer){var c=OpenLayers.Function.bind(this.movIng,this);window.setTimeout(c,1000);}}},styleMaps:CNavDefaultStyle.getStyleMap(),__byWay:[],onComplete:function(r,b){var g=this.map.getLonLatFromPixel(b);g=CNavUtil._toWGS84(g);if(r){this.__featuretype=null;var c=r.geometry.id;if(!c){return;}var l="";if(c.indexOf("Point")!=-1){var k=r.__flag;if(!k){return;}if(k.indexOf("from")!=-1){l="s";var a=this.search.trip;var h=a.slonlat.clone();a.__feature=r;a.__oldLonLat=h;a.__noPanZoom=true;a.slonlat=g;a.sname="起点";a.__noPanZoom=true;if(window.DEFAULT_LANGUAGE&&window.DEFAULT_LANGUAGE==="EN_US"){a.sname="Start";}this.search.__getRemote(a);}else{if(k.indexOf("to")!=-1){l="e";var a=this.search.trip;var h=a.elonlat.clone();a.__feature=r;a.__oldLonLat=h;a.__noPanZoom=true;a.elonlat=g;a.ename="终点";a.__noPanZoom=true;if(window.DEFAULT_LANGUAGE&&window.DEFAULT_LANGUAGE==="EN_US"){a.ename="End";}this.search.__getRemote(a);}else{var n=r.__lonlat.clone();var a=this.search.trip;a.__feature=r;a.__oldLonLat=n;a.__noPanZoom=true;var q=false;for(var e=0;e<a.byway.length;e++){var m=a.byway[e];if(n.equals(m)){q=true;a.byway[e]=g;r.__lonlat=g;this.search.__getRemote(a);}}if(!q){return;}}}}}else{if(this.__featuretype&&this.__featuretype=="O"){this.__featuretype=null;this.onComplete(this.__feature,b);return;}falg="l";var a=this.search.trip;if(a.byway){var j=a.byway.length;if(this.search.limit>0){if(j<this.search.limit){this.insertLonLat(a.byway,g);a.__noPanZoom=true;a.__insertOption={lonlat:g};this.search.__getRemote(a);}else{var d="只支持最多"+this.search.limit+"个途径点";if(window.DEFAULT_LANGUAGE&&window.DEFAULT_LANGUAGE==="EN_US"){d="We Only Support"+this.search.limit+"Middle Points";}alert(d);this.layer.removeFeatures([this.marker]);return;}}else{a.__noPanZoom=true;this.insertLonLat(a.byway,g);a.__insertOption={lonlat:g};this.search.__getRemote(a);}}else{a.byway=[g];this.search.__getRemote(a);}var p=this.map.getLonLatFromPixel(b);var o=this.mapFeature(g,p);this.__byWay.push(o);a.__feature=o;}},insertLonLat:function(b,d){var c=false;for(var a=0;a<this.__byWay.length;a++){if(this.index<this.__byWay[a].__indexOfFeature){b.splice(a,0,d);c=true;}}if(!c){b.push(d);}return OpenLayers.Util.indexOf(b,d);},mapFeature:function(d,b){var a=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.styleMaps.externalGraphic=CNavMarker.dragNode().url;var c=CNavMarker.dragNode().size;this.styleMaps.graphicWidth=c.w;this.styleMaps.graphicHeight=c.h;this.styleMaps.graphicXOffset=-c.w/2;this.styleMaps.graphicYOffset=-c.h/2;a.style=this.styleMaps;a.__lonlat=d;a.__flag="middle";return a;},addByWay:function(){this.layer.removeFeatures(this.__features);var a=-1;for(var b=0;b<this.__byWay.length;b++){var c=this.__byWay[b];a=this.__getIndex(c.geometry,a+1);c.__indexOfFeature=a;this.layer.addFeatures(c);}this.__byWay.sort(function(e,d){return e.__indexOfFeature-d.__indexOfFeature;});},__getIndex:function(h,a){var k=null;var c=null;for(var b=0;b<this.layer.features.length;b++){var e=this.layer.features[b];if((e.geometry.CLASS_NAME=="OpenLayers.Geometry.Point")){continue;}var g=e.geometry;var j=h.distanceTo(g);if(k){if(j<k){c=b;k=j;}}else{k=j;c=b;}}return c;},sort:function(e,d,c){d=CNavUtil._toMerc(d);c=CNavUtil._toMerc(c);var g=new Point(d.lon,d.lat);var f=new Point(c.lon,c.lat);return(g.distanceTo(e)-f.distanceTo(e));},layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,marker:null,search:null,initialize:function(c,b,a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.layer=c;this.search=b;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks)),feature:new CNavFeatureHandler(this,this.layer,OpenLayers.Util.extend({over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})};},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[]);},activate:function(){return(this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments));},deactivate:function(){var a=this;if(this.handlers&&this.handlers.drag){this.handlers.drag.deactivate();}if(this.handlers&&this.handlers.feature){this.handlers.feature.deactivate();}this.feature=null;this.dragging=false;this.lastPixel=null;return OpenLayers.Control.prototype.deactivate.apply(this,arguments);},overFeature:function(b,a){if(!this.handlers.drag.dragging){this.feature=b;this.handlers.drag.activate();this.over=true;this.map.div.style.cursor="pointer";}else{if(b){if(this.feature.id==b.id){this.over=true;}else{this.over=false;}}}if(!(b.geometry.CLASS_NAME=="OpenLayers.Geometry.Point")){this.makePoint(a.xy);}else{}},makePoint:function(c){if(!this.marker){var a=this.map.getLonLatFromPixel(c);this.marker=new OpenLayers.Feature.Vector(new Point(a.lon,a.lat));this.styleMaps.externalGraphic=CNavMarker.dragNode().url;var b=CNavMarker.dragNode().size;this.styleMaps.graphicWidth=b.w;this.styleMaps.graphicHeight=b.h;this.styleMaps.graphicXOffset=-b.w/2;this.styleMaps.graphicYOffset=-b.h/2;this.marker.style=this.styleMaps;this.layer.addFeatures([this.marker]);}else{this.marker.layer=this.layer;this.marker.move(c);}},clearPoint:function(){if(this.marker){this.layer.removeFeatures([this.marker]);}},downFeature:function(a){this.lastPixel=a;this.map.div.style.cursor="pointer";this.onStart(this.feature,a);},moveFeature:function(b){var c=this.map.getResolution();if(!(this.feature.geometry.CLASS_NAME=="OpenLayers.Geometry.Point")){this.index=OpenLayers.Util.indexOf(this.layer.features,this.feature);this.makePoint(b);this.__featuretype="N";}else{var a=this.feature.__flag;this.feature.geometry.move(c*(b.x-this.lastPixel.x),c*(this.lastPixel.y-b.y));this.layer.drawFeature(this.feature);this.__featuretype="O";this.__flagtype=a;this.__featurelonlat=this.feature.__lonlat;this.__feature=this.feature;}this.lastPixel=b;this.onDrag(this.feature,b);},movIng:function(){var b=this.__timerPixel;if(!b){return;}else{this.__timerPixel=null;}var a=this.map.getLonLatFromPixel(b);var e=CNavUtil._toWGS84(a);var f={};f=OpenLayers.Util.extend(f,this.search.trip);f.byway=[];for(var d=0;d<this.search.trip.byway.length;d++){f.byway[d]=this.search.trip.byway[d];}if(this.__insertIndex==null){var c=null;if(this.__featuretype&&this.__featuretype=="O"){if(this.__flagtype=="from"){this.__insertIndex=0;c="s";}else{if(this.__flagtype=="to"){this.__insertIndex=f.byway.length-1;c="e";}else{this.__insertIndex=OpenLayers.Util.indexOf(f.byway,this.__featurelonlat);c="m";}}}else{if(this.__featuretype&&this.__featuretype=="N"){this.__insertIndex=this.insertLonLat(f.byway,e);c="mn";}}f.byway.unshift(f.slonlat);f.byway.push(f.elonlat);this.__tmptrip=f;this.__insertIndex+=1;if(c=="s"){this.__tmptrip.slonlat=this.__tmptrip.byway[0];this.__tmptrip.elonlat=this.__tmptrip.byway[1];this.__tmptrip.byway=[];this.__tmptrip.t="s";this.__getRemote(this.__tmptrip);}else{if(c=="e"){this.__tmptrip.slonlat=this.__tmptrip.byway[this.__tmptrip.byway.length-2];this.__tmptrip.elonlat=this.__tmptrip.byway[this.__tmptrip.byway.length-1];this.__tmptrip.byway=[];this.__tmptrip.t="e";this.__getRemote(this.__tmptrip);}else{if(c=="m"){this.__tmptrip.slonlat=this.__tmptrip.byway[this.__insertIndex-1];this.__tmptrip.elonlat=this.__tmptrip.byway[this.__insertIndex+1];this.__tmptrip.byway=[this.__tmptrip.byway[this.__insertIndex]];this.__tmptrip.t="m";this.__getRemote(this.__tmptrip);}else{if(c=="mn"){this.__tmptrip.slonlat=this.__tmptrip.byway[this.__insertIndex-1];this.__tmptrip.elonlat=this.__tmptrip.byway[this.__insertIndex+1];this.__tmptrip.byway=[e];this.__tmptrip.t="mn";this.__getRemote(this.__tmptrip);}}}}}else{var c=this.__tmptrip.t;if(c=="s"){this.__tmptrip.slonlat=e;this.__getRemote(this.__tmptrip);}else{if(c=="e"){this.__tmptrip.elonlat=e;this.__getRemote(this.__tmptrip);}else{if(c=="m"){this.__tmptrip.byway=[e];this.__getRemote(this.__tmptrip);}else{if(c=="mn"){this.__tmptrip.byway=[e];this.__getRemote(this.__tmptrip);}}}}}},__getRemote:function(h){var a=OpenLayers.Function.bind(this.__callback,this,h);var b=OpenLayers.Function.bind(this.__callback,this,h);var g=CNavUtil.__ajaxRemoteF;var e="()";if(h.byway){var d=[];for(var c=0;c<h.byway.length;c++){var f=h.byway[c];d.push(f.lon+" "+f.lat);}e="("+d.join(",")+")";}g.loadUrl(SERVER_URL+"query.do",{serviceType:"simpleDrivemultipleService",mp:e,type:h.strategy,spx:h.slonlat.lon,spy:h.slonlat.lat,epx:h.elonlat.lon,epy:h.elonlat.lat,realtime:h.realtime,shpflag:1,IP:null},this,a,b);return true;},__callback:function(d,e){this.layer.removeFeatures(this.__features);this.__features=[];if(e&&this.handlers.drag.dragging){var c=this.search.GeoJSONFormater.read(e);if(!c){return;}for(var a=0;a<c.length;a++){if(c[a].geometry.CLASS_NAME=="OpenLayers.Geometry.LineString"){var b=new CNavStyle({strokeColor:"green"});c[a].style=b.getStyle();this.layer.addFeatures([c[a]]);this.__features[a]=c[a];}}}},upFeature:function(a){if(!this.over){this.handlers.drag.deactivate();this.feature=null;this.map.div.style.cursor="default";}else{this.map.div.style.cursor="default";}},doneDragging:function(a){this.__insertIndex=null;this.__tmptrip=null;this.__flagtype=null;this.onComplete(this.feature,a);},outFeature:function(b,a){if(!this.handlers.drag.dragging){this.over=false;this.handlers.drag.deactivate();this.map.div.style.cursor="default";this.feature=null;}else{if(b){if(this.feature.id==b.id){this.over=false;}}}this.clearPoint();},cancel:function(){this.handlers.drag.deactivate();this.over=false;},setMap:function(a){this.handlers.drag.setMap(a);this.handlers.feature.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments);},CLASS_NAME:"OpenLayers.Control.DragFeature"});CNavRemoveElementsControl=OpenLayers.Class(OpenLayers.Control.Navigation,{initialize:function(a){OpenLayers.Control.Navigation.prototype.initialize.apply(this,arguments);},deactivate:function(){if(this.zoomBox){this.zoomBox.deactivate();}if(this.dragPan){this.dragPan.deactivate();}if(this.handlers&&this.handlers.click){this.handlers.click.deactivate();}if(this.handlers&&this.handlers.wheel){this.handlers.wheel.deactivate();}return OpenLayers.Control.prototype.deactivate.apply(this,arguments);},CLASS_NAME:"CNavRemoveElementsControl"});CNavMeasureControl=OpenLayers.Class(OpenLayers.Control.Measure,{unitcontrast:{length:{mi:"英哩",ft:"英尺","in":"英寸",km:"km",m:"m"},area:{mi:"平方英哩",ft:"平方英尺","in":"平方英寸",km:"km<sup>2</sup>",m:"m<sup>2</sup>"}},onMeasureComplete:null,isLine:true,isPolygon:false,isRetangle:false,initialize:function(b){if(b){this.isPolygon=b.isPolygon?b.isPolygon:false;this.isRetangle=b.isRetangle?b.isRetangle:false;this.onMeasureComplete=b.onMeasureComplete?b.onMeasureComplete:null;}var a=this.isRetangle?CNavRegularPolygonHandler:(this.isPolygon?CNavPolygonHandler:CNavPathHandler);if(b&&b.handlerOptions&&b.handlerOptions.style){}else{if(b){if(!b.handlerOptions){b.handlerOptions={style:CNavDefaultStyle.clone()};}else{b.handlerOptions.style=CNavDefaultStyle.clone();}}else{b={};b.handlerOptions={style:CNavDefaultStyle.clone()};}}OpenLayers.Control.Measure.prototype.initialize.apply(this,[a,b]);this.events.on({measure:this.handleMeasureResult,scope:this});},handleMeasureResult:function(d){var i=d.geometry;var g=d.units;var c=d.order;var b=d.measure;var e=this.map.getLonLatFromPixel(this.handler.lastevt.xy);var h="";if(c==1){h="<div style='font-size:14px;padding:1px 2px 1px 2px;'>距离:"+b.toFixed(3)+""+this.unitcontrast.length[g]+"</div>";}else{h="<div style='font-size:14px;padding:1px 2px 1px 2px;'>面积:"+b.toFixed(3)+""+this.unitcontrast.area[g]+"</div>";}var l=CNavUtil._toWGS84(e);var f=this.handler.layer.features.length-1;var m=this.handler.layer.features[f];var j=OpenLayers.Function.bind(this.removeFeature,this,m);var a=new OpenLayers.Popup("MeasurePopup",e,null,h,true,j);a.autoSize=true;a.setBorder("1px solid #39c");this.map.addPopup(a);this.handler.layer.features[f].popup=a;if(this.onMeasureComplete){var k=this.isPolygon?this.unitcontrast.area[g]:this.unitcontrast.length[g];this.onMeasureComplete.apply(this,[{units:k,measure:b}]);}if(this.handler.lastevt.type=="dblclick"||this.handler.lastevt.type=="mouseup"){this.deactivate();}},removeFeature:function(b){var a=this.map.dynamicVectorLayer;if(b&&b.popup){this.map.removePopup(b.popup);b.popup=null;}a.removeFeatures([b],{silent:true});},doMeasure:function(){this.handler.persist=true;this.handler.finalize();this.handler.persist=false;this.deactivate();},CLASS_NAME:"CNavMeasureControl"});CNavZoomInControl=OpenLayers.Class(OpenLayers.Control.ZoomBox,{initialize:function(a){OpenLayers.Control.ZoomBox.prototype.initialize.apply(this,[a]);},CLASS_NAME:"CNavZoomInControl"});CNavZoomOutControl=OpenLayers.Class(OpenLayers.Control.ZoomBox,{initialize:function(a){if(!a){a={out:true};}OpenLayers.Control.ZoomBox.prototype.initialize.apply(this,[a]);},CLASS_NAME:"CNavZoomOutControl"});CNavOviewControl=OpenLayers.Class(OpenLayers.Control.OverviewMap,{initialize:function(a){this.minRatio=10;this.maxRatio=10;this.minRectSize=10;a=OpenLayers.Util.extend({mapOptions:{projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),size:new OpenLayers.Size(180,180),units:"m",maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508,-20037508,20037508*2,20037508)}},a);OpenLayers.Control.OverviewMap.prototype.initialize.apply(this,[a]);this.layers=[new CNavOviewLayer("overViewMap",TILE_PIV_URL)];},setOvMapCenter:function(){this.ovmap.setCenter(this.map.getExtent().getCenterLonLat());},updateMapToRect:function(){OpenLayers.Control.OverviewMap.prototype.updateMapToRect.apply(this,arguments);this.ovmap.setCenter(this.map.getExtent().getCenterLonLat());},createMap:function(){OpenLayers.Control.OverviewMap.prototype.createMap.apply(this,arguments);this.ovmap.events.register("moveend",this,this.updateRectToMap);this.ovmap.events.register("zoomend",this,this.updateRectToMap);},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!(this.layers.length>0)){if(this.map.baseLayer){var d=this.map.baseLayer.clone();this.layers=[d];}else{this.map.events.register("changebaselayer",this,this.baseLayerDraw);return this.div;}}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1000;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.mapDiv.appendChild(this.extentRectangle);this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(!this.outsideViewport){this.div.className+=" "+this.displayClass+"Container";var e=OpenLayers.Util.getImagesLocation();var b=e+"layer-switcher-maximize.png";this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,new OpenLayers.Size(15,15),b,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton";OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this));this.div.appendChild(this.maximizeDiv);b=e+"layer-switcher-minimize.png";this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,new OpenLayers.Size(15,15),b,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton";OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this));this.div.appendChild(this.minimizeDiv);var f=["dblclick","mousedown"];for(var c=0,a=f.length;c<a;c++){OpenLayers.Event.observe(this.maximizeDiv,f[c],OpenLayers.Event.stop);OpenLayers.Event.observe(this.minimizeDiv,f[c],OpenLayers.Event.stop);}this.minimizeControl();}else{this.element.style.display="";}if(this.map.getExtent()){this.update();}this.map.events.register("moveend",this,this.update);this.map.events.register("zoomend",this,this.update);this.map.events.register("dragend",this,this.update);this.map.events.register("moveend",this,this.setOvMapCenter);this.map.events.register("zoomend",this,this.setOvMapCenter);this.map.events.register("dragend",this,this.setOvMapCenter);return this.div;},createMap:function(){var b=OpenLayers.Util.extend({controls:[new CNavNavigationControl({Navigation:this})],maxResolution:"auto",fallThrough:false},this.mapOptions);this.ovmap=new CNavOviewMap(this.mapDiv,b);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width"));this.wComp=(this.wComp)?this.wComp:2;this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width"));this.hComp=(this.hComp)?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:true,"double":false,stopSingle:true,stopDouble:true,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,true);this.rectEvents.register("mouseover",this,function(d){if(!this.handlers.drag.active&&!this.map.dragging){this.handlers.drag.activate();}});this.rectEvents.register("mouseout",this,function(d){if(!this.handlers.drag.dragging){this.handlers.drag.deactivate();}});if(this.ovmap.getProjection()!=this.map.getProjection()){var c=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;var a=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=c&&a?OpenLayers.INCHES_PER_UNIT[c]/OpenLayers.INCHES_PER_UNIT[a]:1;}}});CNavScaleLine=OpenLayers.Class(OpenLayers.Control.ScaleLine,{initialize:function(a){OpenLayers.Control.ScaleLine.prototype.initialize.apply(this,[a]);this.maxWidth=80;},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.div.style.display="block";this.div.style.position="absolute";this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";var a=this.topInUnits.length;this.div.appendChild(this.eTop);this.eBottom=document.createElement("div");}this.map.events.register("moveend",this,this.update);this.update();return this.div;}});CNavCustomImg=OpenLayers.Class(OpenLayers.Control.ScaleLine,{flag:null,img:null,posLeft:null,initialize:function(a){OpenLayers.Control.ScaleLine.prototype.initialize.apply(this,[a]);this.flag=a.flag;this.img=a.img;this.posLeft=a.posLeft;},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(this.flag=="traffic"){this.div.style.top="4%";this.div.style.left="10%";this.div.appendChild(OpenLayers.Util.getElement(this.img));return this.div;}var c=document.createElement("img");if(c){c.src=this.img;if(this.posLeft){this.div.style.left=this.posLeft;}if(this.flag=="logo"){this.div.style.bottom="0px";this.div.style.left="50%";}var b=this.map.getCenter();var d=this.map.getLayerPxFromLonLat(b);var e=parseInt(this.getStyle(this.map.viewPortDiv,"width"));var a=parseInt(this.getStyle(this.map.viewPortDiv,"height"));if(this.flag=="animatation"){this.div.style.top=((a/2-32)*100/a)+"%";this.div.style.left=((e/2-32)*100/e)+"%";this.div.style.display="none";}if(this.flag=="center"){this.div.style.top=((a/2-5)*100/a)+"%";this.div.style.left=((e/2-5)*100/e)+"%";}this.div.appendChild(c);}return this.div;},setLeft:function(a){this.div.style.left=a;},getStyle:function(c,a){if(c.currentStyle){if(a=="width"){return c.offsetWidth;}else{return c.offsetHeight;}}else{if(document.defaultView&&document.defaultView.getComputedStyle){a=a.replace(/([A-Z])/g,"-$1");a=a.toLowerCase();var b=document.defaultView.getComputedStyle(c,"");return b&&b.getPropertyValue(a);}else{return null;}}},CLASS_NAME:"CNavCustomImg"});CNavToolbar=OpenLayers.Class(OpenLayers.Control.NavToolbar,{showElements:{pan:true,zoomout:true,zoomin:true,measureLine:true,measurePolygon:true,dynamicMaker:true,drawpoint:false,drawLine:true,drawPolygon:true,drawCircle:true,remove:true,modify:true,city:true},defaults:{pan:{title:"平移",displayClass:"olControlNavigation",zoomWheelEnabled:false},zoomin:{title:"放大",displayClass:"olControlZoomIn"},zoomout:{out:true,title:"缩小",displayClass:"olControlZoomOut"},measureLine:{displayClass:"CNavMeasureLineControl",title:"测距离",handlerOptions:{persist:false}},measurePolygon:{isPolygon:true,displayClass:"CNavMeasurePolygonControl",title:"测面积",handlerOptions:{persist:false}},dynamicMaker:{title:"动态标注",displayClass:"olControlDrawFeaturePoint",handlerOptions:{}},drawpoint:{title:"画点",displayClass:"olControlDrawFeaturePoint",handlerOptions:{}},drawLine:{title:"画线",displayClass:"olControlDrawFeaturePath",handlerOptions:{}},drawPolygon:{title:"画多边型",displayClass:"olControlDrawFeaturePolygon",handlerOptions:{}},drawCircle:{title:"画圆形",displayClass:"olControlDrawFeatureCircle",handlerOptions:{sides:40}},modify:{title:"修改元素",displayClass:"olControlDrawFeatureEdit"},remove:{title:"清除界面元素",displayClass:"olControlDrawFeatureRemove"},city:{title:"选择城市",displayClass:"olControlCity"}},defaultStyle:CNavDefaultStyle.clone(),styles:{measureLine:this.defaultStyle,measurePolygon:this.defaultStyle,drawLine:this.defaultStyle,measureLine:this.defaultStyle,drawPolygon:this.defaultStyle,drawCircle:this.defaultStyle},initialize:function(a){OpenLayers.Control.NavToolbar.prototype.initialize.apply(this,[a]);this.displayClass="olControlNavToolbar";if(a){if(a.showElements){OpenLayers.Util.extend(this.showElements,a.showElements);}if(a.defaults){for(var b in a.defaults){this.defaults[b]=OpenLayers.Util.extend(this.defaults[b],a.defaults[b]);}}if(a.style){OpenLayers.Util.extend(this.defaultStyle,a.style.getStyle());}}this.controls=[];this.addControls([new CNavNavigation(this.defaults.pan)]);},redraw:function(){this.div.innerHTML="";if(this.active){for(var c=0,a=this.controls.length;c<a;c++){var b=this.controls[c].panel_div;if(this.controls[c].active){b.className=this.controls[c].displayClass+"ItemActive";b.style.left=25*c+"px";b.style.top=-25*c+"px";}else{b.className=this.controls[c].displayClass+"ItemInactive";b.style.left=25*c+"px";b.style.top=-25*c+"px";}this.div.appendChild(b);}}},activateControl:function(a){OpenLayers.Control.NavToolbar.prototype.activateControl.apply(this,arguments);if(a.CLASS_NAME=="CNavRemoveElementsControl"){this.map.clearAllElements();}},draw:function(){var d=OpenLayers.Control.NavToolbar.prototype.draw.apply(this,arguments);if(this.showElements){var b=0;for(var c in this.showElements){if(this.showElements[c]){b++;}}var a=b*25+"px";this.div.style.width=a;}this.div.style.top="5px";this.div.style.right="5px";this.div.className="olControlNavToolbar";this.addDrawControl();return d;},addDrawControl:function(){var e=this.map.dynamicMarkerLayer;var d=this.map.dynamicVectorLayer.style;d=OpenLayers.Util.extend(d,this.defaultStyle);this.map.dynamicVectorLayer.style=d;this.defaults.measureLine.handlerOptions.style=d;this.defaults.measurePolygon.handlerOptions.style=d;this.defaults.drawLine.handlerOptions.style=d;this.defaults.drawPolygon.handlerOptions.style=d;this.defaults.drawCircle.handlerOptions.style=d;var c=this.map.dynamicVectorLayer;var a={zoomin:new OpenLayers.Control.ZoomBox(this.defaults.zoomin),zoomout:new OpenLayers.Control.ZoomBox(this.defaults.zoomout),measureLine:new CNavMeasureControl(this.defaults.measureLine),measurePolygon:new CNavMeasureControl(this.defaults.measurePolygon),dynamicMaker:new CNavDynamicMarkerControl(e,this.defaults.dynamicMaker),drawpoint:new OpenLayers.Control.DrawFeature(e,OpenLayers.Handler.Point,this.defaults.drawpoint),drawLine:new OpenLayers.Control.DrawFeature(c,OpenLayers.Handler.Path,this.defaults.drawLine),drawPolygon:new OpenLayers.Control.DrawFeature(c,OpenLayers.Handler.Polygon,this.defaults.drawPolygon),drawCircle:new OpenLayers.Control.DrawFeature(c,OpenLayers.Handler.RegularPolygon,this.defaults.drawCircle),modify:new OpenLayers.Control.ModifyFeature(c,this.defaults.modify),remove:new CNavRemoveElementsControl(this.defaults.remove),city:new CNavSelectCityControl(this.defaults.city)};for(var b in a){a[b].featureAdded=function(f){f.state=OpenLayers.State.INSERT;};if(this.showElements[b]){this.addControls(a[b]);}}},CLASS_NAME:"CNavToolbar"});CNavPanZoombar=OpenLayers.Class(OpenLayers.Control.PanZoomBar,{initialize:function(){OpenLayers.Control.PanZoom.prototype.initialize.apply(this,arguments);this.zoomStopHeight=7;this.zoomStopWidth=11;},draw:function(b){if(!b){b=new Pixel(-5,-35);}OpenLayers.Control.prototype.draw.apply(this,[b]);b=this.position.clone();this.buttons=[];var d=new OpenLayers.Size(18,18);var a=new OpenLayers.Pixel(b.x+d.w/2,b.y);var c=d.w;if(this.zoomWorldIcon){a=new OpenLayers.Pixel(b.x+d.w,b.y);}this._addButton("panup","up.png",a.add(30,d.h*3+5+25),d);b.y=a.y+d.h;this._addButton("panleft","left.png",b.add(c+6,d.h*3+28),d);if(this.zoomWorldIcon){c*=2;}this._addButton("panright","right.png",b.add(c+36,d.h*3+28),d);this._addButton("pandown","down.png",a.add(30,d.h*3+4+58),d);this._addButton("zoomin","add.png",a.add(30,d.h*3+5+80),d);a=this._addZoomBar(a.add(33,d.h*4+5+80));this._addButton("zoomout","derive.png",a.add(-3,2),d);OpenLayers.Event.observe(this.div,"mouseover",OpenLayers.Function.bind(this.__overSlider,this,a));OpenLayers.Event.observe(this.div,"mouseout",OpenLayers.Function.bindAsEventListener(this.__outSlider,this));return this.div;},__overSlider:function(b){if(!this.__over){var d=(4-this.map.minZoom)>-1?true:false;var a=(7-this.map.minZoom)>-1?true:false;var c=(12-this.map.minZoom)>-1?true:false;if(d){this._addZoomFactor("guo","guo.png",b.add(15,-((4-this.map.minZoom)*7+10)),new Size(24,17));}if(a){this._addZoomFactor("sheng","sheng.png",b.add(15,-(7*(7-this.map.minZoom)+10)),new Size(24,17));}if(c){this._addZoomFactor("shi","shi.png",b.add(15,-(7*(12-this.map.minZoom)+10)),new Size(24,17));}this._addZoomFactor("jie","jie.png",b.add(15,-(7*(this.map.maxZoom-this.map.minZoom)+10)),new Size(24,17));this.__over=true;}else{var d=(4-this.map.minZoom)>-1?true:false;var a=(7-this.map.minZoom)>-1?true:false;var c=(12-this.map.minZoom)>-1?true:false;if(d){OpenLayers.Util.getElement(this.id+"_guo").style.display="";}if(c){OpenLayers.Util.getElement(this.id+"_shi").style.display="";}if(a){OpenLayers.Util.getElement(this.id+"_sheng").style.display="";}OpenLayers.Util.getElement(this.id+"_jie").style.display="";}},__outSlider:function(){var a=function(){var e=(4-this.map.minZoom)>-1?true:false;var c=(7-this.map.minZoom)>-1?true:false;var d=(12-this.map.minZoom)>-1?true:false;if(e){OpenLayers.Util.getElement(this.id+"_guo").style.display="none";}if(d){OpenLayers.Util.getElement(this.id+"_shi").style.display="none";}if(c){OpenLayers.Util.getElement(this.id+"_sheng").style.display="none";}OpenLayers.Util.getElement(this.id+"_jie").style.display="none";this.__timeout__=null;};var b=OpenLayers.Function.bind(a,this);if(!this.__timeout__){this.__timeout__=window.setTimeout(b,5000);}else{window.clearTimeout(this.__timeout__);this.__timeout__=window.setTimeout(b,5000);}},_addButton:function(f,a,e,d){var c=OpenLayers.Util.getImagesLocation()+a;var b=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+f,e,d,c,"absolute");b.unselectable="on";this.div.appendChild(b);OpenLayers.Event.observe(b,"mousedown",OpenLayers.Function.bindAsEventListener(this.buttonDown,b));OpenLayers.Event.observe(b,"dblclick",OpenLayers.Function.bindAsEventListener(this.doubleClick,b));OpenLayers.Event.observe(b,"click",OpenLayers.Function.bindAsEventListener(this.doubleClick,b));b.action=f;b.map=this.map;b.slideFactor=this.slideFactor;this.buttons.push(b);return b;},_addZoomBar:function(a){var e=OpenLayers.Util.getImagesLocation();var g=this.id+"_"+this.map.id;var b=this.map.getNumZoomLevels()-1-this.map.getZoom();var c=OpenLayers.Util.createAlphaImageDiv(g,a.add(-5,b*this.zoomStopHeight),new OpenLayers.Size(22,8),e+"slider___.png","absolute");this.slider=c;this.sliderEvents=new OpenLayers.Events(this,c,null,true,{includeXY:true});this.sliderEvents.on({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});var d=new OpenLayers.Size();d.h=this.zoomStopHeight*this.map.getNumZoomLevels();d.w=this.zoomStopWidth;var f=null;if(OpenLayers.Util.alphaHack()){var g=this.id+"_"+this.map.id;f=OpenLayers.Util.createAlphaImageDiv(g,a,new OpenLayers.Size(d.w,this.zoomStopHeight),e+"zoombar___.png","absolute",null,"crop");f.style.height=d.h+"px";}else{f=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a,d,e+"zoombar___.png");}this.zoombarDiv=f;this.divEvents=new OpenLayers.Events(this,f,null,true,{includeXY:true});this.divEvents.on({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.div.appendChild(f);this.startTop=parseInt(f.style.top);this.div.appendChild(c);this.map.events.register("zoomend",this,this.moveZoomBar);a=a.add(0,this.zoomStopHeight*this.map.getNumZoomLevels());return a;},_addZoomFactor:function(f,a,e,d){var c=OpenLayers.Util.getImagesLocation()+a;var b=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+f,e,d,c,"absolute");b.unselectable="on";this.div.appendChild(b);OpenLayers.Event.observe(b,"click",OpenLayers.Function.bindAsEventListener(this.dealFactor,b));OpenLayers.Event.observe(b,"click",OpenLayers.Function.bindAsEventListener(this.dealFactor,b));b.action=f;b.map=this.map;b.slideFactor=this.slideFactor;this.buttons.push(b);return b;},dealFactor:function(a){var b=this.action;var c=-1;if(b&&b==="guo"){c=4-this.map.minZoom;}if(b&&b==="sheng"){c=7-this.map.minZoom;}if(b&&b==="shi"){c=12-this.map.minZoom;}if(b&&b==="jie"){c=17-this.map.minZoom;}if(c>-1){this.map.zoomTo(c);}},zoomBarUp:function(a){OpenLayers.Control.PanZoomBar.prototype.zoomBarUp.apply(this,[a]);this.zoomStart=null;},CLASS_NAME:"CNavPanZoombar"});CNavPanZoom=OpenLayers.Class(OpenLayers.Control.PanZoom,{initialize:function(){OpenLayers.Control.PanZoom.prototype.initialize.apply(this,arguments);},draw:function(b){OpenLayers.Control.prototype.draw.apply(this,arguments);b=this.position;this.buttons=[];var c=new OpenLayers.Size(18,18);var a=new OpenLayers.Pixel(b.x+c.w/2,b.y);this._addButton("panup","up.png",a,c);b.y=a.y+c.h;this._addButton("panleft","left.png",b,c);this._addButton("panright","right.png",b.add(c.w,0),c);this._addButton("pandown","down.png",a.add(0,c.h*2),c);this._addButton("zoomin","add.png",a.add(0,c.h*3+5),c);this._addButton("zoomout","derive.png",a.add(0,c.h*4+5),c);return this.div;},buttonDown:function(b){if(!OpenLayers.Event.isLeftClick(b)){return;}switch(this.action){case"panup":this.map.pan(0,-this.slideFactor);break;case"pandown":this.map.pan(0,this.slideFactor);break;case"panleft":this.map.pan(-this.slideFactor,0);break;case"panright":this.map.pan(this.slideFactor,0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":var a=this.map.placeListObj.getCityLonLatByCode(DEFAULT_CITY_CODE);var c=CNavUtil._toMerc(a);this.map.setCenter(c,this.map.getZoom(),false,true);break;}OpenLayers.Event.stop(b);},CLASS_NAME:"CNavPanZoom"});CNavDynamicMarkerControl=OpenLayers.Class(OpenLayers.Control.DragFeature,{showPopup:true,listener:null,isClear:false,markerAdded:true,needPositionInfo:true,handleSingleRightClick:false,handleDoubleRightClick:false,keyMask:OpenLayers.Handler.MOD_SHIFT,onDelete:null,initialize:function(b,a){OpenLayers.Control.DragFeature.prototype.initialize.apply(this,arguments);this.handlers.drag=new CNavDragHandler(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks));OpenLayers.Util.extend(this,a);if(this.handleSingleRightClick){this.handler=new CNavClickHandler(this,{contextmenu:this.addMarker},{});}else{if(this.handleDoubleRightClick){this.handler=new CNavClickHandler(this,{dblrightclick:this.addMarker},{});}else{this.handler=new OpenLayers.Handler.Click(this,{click:this.addMarker},{});}}},checkModifiers:function(a){if(this.keyMask==null){return true;}var b=(a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:0);return(b==this.keyMask);},addMarker:function(b){var a=b.xy.x;var g=b.xy.y;var e=new OpenLayers.Size(200,200);var d=new OpenLayers.Pixel(a,g);var c=this.map.getLonLatFromViewPortPx(d);feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(c.lon,c.lat));if(this.isClear){this.map._clearVector(this.layer);}if(this.markerAdded){this.layer.addFeatures([feature]);}if(this.needPositionInfo){this._retrieveInfo(d,feature);}else{var f=CNavUtil._toWGS84(c);this.listener.apply(this,[f,null]);}},_retrieveInfo:function(a,j,d){var c=this.map.getLonLatFromPixel(a);var i=CNavUtil._toWGS84(c);var b=d;if(!b){b=0;}var e=3000;var g=OpenLayers.Function.bind(this._callback,this,a,j,b);var f=OpenLayers.Function.bind(this._failure,this,a,j,b);var h=CNavUtil.__ajaxRemote;h.loadUrl(SERVER_URL+"query.do",{serviceType:"positionInfoService",cx:i.lon,cy:i.lat,acode:DEFAULT_CITY_CODE,radius:e},this,g,f);},_callback:function(a,b,d,g){if(!g&&d<2){this._retrieveInfo(a,b,d);}var f;if(!g){f="服务器无返回";this._dealPopup(f,b,a);return;}var e=g;if(!e.info){f=CNavUtil._buildDesc(e,true);}else{f=CNavUtil._buildDesc(e);var c="";f=c+f;}this._dealPopup(f,b,a);},_dealPopup:function(h,e,c){if(this.showPopup){if(e&&e.popup){this.map.removePopup(e.popup);}if(e&&e.geometry){var b=e.geometry.getBounds().getCenterLonLat();var d=CNavUtil._toWGS84(b);var a=new CNavTextPopup(this.id,d,h,true,null);this.map.addPopup(a);e.popup=a;}}if(e&&e.geometry&&this.listener){var f=e.geometry.getBounds().getCenterLonLat();var g=CNavUtil._toWGS84(f);this.listener.apply(this,[g,h]);}},_failure:function(a,b,c){if(c<3){c++;this._retrieveInfo(a,b,c);return;}else{var d=CNavUtil._buildDesc(null,true);this._dealPopup(d,b,a);}},onComplete:function(c,b){var e;if(c&&c.geometry){e=c.geometry.getBounds().getCenterLonLat();}else{e=this.map.getLonLatFromPixel(b);}var a=this.map.getPixelFromLonLat(e);if(this.needPositionInfo){this._retrieveInfo(a,c);}else{var d=CNavUtil._toWGS84(e);this.listener.apply(this,[d,null]);}},downFeature:function(b,a){var c=this.feature;var e=this.checkModifiers(a);if(e&&c){if(c.popup){this.map.removePopup(c.popup);}this.layer.removeFeatures([c]);if(this.onDelete){var d=CNavUtil._toWGS84(lonLatpx);this.onDelete(d);}this.over=false;this.upFeature(b);return false;}if(!e&&c&&c.popup){c.popup.toggle();}OpenLayers.Control.DragFeature.prototype.downFeature.apply(this,arguments);},moveFeature:function(a){if(this.feature&&this.feature.popup){this.feature.popup.hide();}OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments);},CLASS_NAME:"CNavDynamicMarkerControl"});CNavSelectCityControl=OpenLayers.Class(OpenLayers.Control,{initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);},activate:function(){var a=this.map.placeListObj;a.openWindow();OpenLayers.Control.prototype.activate.apply(this,arguments);this.deactivate();},CLASS_NAME:"CNavSelectCityControl"});CNavSearchBoxControl=OpenLayers.Class(OpenLayers.Control.ZoomBox,{callback:null,zoomToBox:true,activateEveryTime:true,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask});},zoomBox:function(a){if(a instanceof OpenLayers.Bounds){if(!this.out){var d=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.left,a.bottom));var b=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.right,a.top));var c=new OpenLayers.Bounds(d.lon,d.lat,b.lon,b.lat);}if(this.zoomToBox){this.map.zoomToExtent(c);}c=c.transform(CNavUtil.EPSG900913,CNavUtil.EPSG4326);this.callback(c);if(this.activateEveryTime){this.deactivate();}}},CLASS_NAME:"CNavSearchBoxControl"});CNavViewPortControl=OpenLayers.Class(OpenLayers.Control,{callback:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);},activate:function(){this.map.events.register("moveend",this,this.change);this.change();OpenLayers.Control.prototype.activate.apply(this,arguments);},deactivate:function(){OpenLayers.Control.prototype.activate.apply(this,arguments);this.map.events.unregister("moveend",this,this.change);},change:function(){var a=this.map.getExtent();a=a.transform(CNavUtil.EPSG900913,CNavUtil.EPSG4326);this.callback(a);},CLASS_NAME:"CNavViewPortControl"});CNavMarker=OpenLayers.Class(OpenLayers.Marker,{id:null,popups:[],bshow:false,__popupAdded:false,initialize:function(d,c,a){var b=CNavUtil._toMerc(d);OpenLayers.Marker.prototype.initialize.apply(this,[b,c]);this.id=this.icon.imageDiv.id+"_Marker";OpenLayers.Util.extend(this,a);this._registerEvents();this.icon.imageDiv.unselectable="on";},_registerEvents:function(){this.events.on({click:this.onclick,mouseover:this.onmouseover,mouseout:this.onmouseout,mousedown:this.onmousedown,scope:this});},addPopup:function(b,c,a){if(c!=null){this.bshow=c;if(c){this.__popupAdded=true;}}this.popups=this.popups.concat(b);if(a){this.events.on(a);}},removePopup:function(a){if(this.map){this.map.removePopup(a);}OpenLayers.Util.removeItem(this.popups,a);},getLonLat:function(){var a=CNavUtil._toWGS84(this.lonlat);return a;},onmouseout:function(a){},onmousedown:function(a){},onclick:function(){if(this.__popupAdded){if(this.popups){for(var a=0;a<this.popups.length;a++){this.popups[a].toggle();}}else{if(this.popup){this.popup.toggle();}}}else{if(this.popups){for(var a=0;a<this.popups.length;a++){this.map.addPopup(this.popups[a]);this.popups[a].updatePosition();}}else{if(this.popup){this.map.addPopup(this.popup);this.popup.updatePosition();}}this.__popupAdded=true;}},onmouseover:function(){this.icon.imageDiv.style.cursor="pointer";},fireEvent:function(a){if(!a){return;}this.events.triggerEvent(a);},on:function(a){if(!a){return;}this.events.on(a);},CLASS_NAME:"CNavMarker"});CNavMarker.defaultIcon=function(){return OpenLayers.Marker.defaultIcon();};CNavMarker.iconFrom=function(){var a=new Size(33,51);var c=new Pixel(-a.w/2,-a.h);var b=new Icon(OpenLayers.Util.getImagesLocation()+"ico_from.gif",a,c);return b;};CNavMarker.iconTo=function(){var a=new Size(33,51);var c=new Pixel(-a.w/2,-a.h);var b=new Icon(OpenLayers.Util.getImagesLocation()+"ico_to.gif",a,c);return b;};CNavMarker.iconStart=function(){var a=new Size(32,26);var c=new Pixel(-a.w/2,-a.h);var b=new Icon(OpenLayers.Util.getImagesLocation()+"trans_from.gif",a,c);return b;};CNavMarker.iconEnd=function(){var a=new Size(32,26);var c=new Pixel(-a.w/2,-a.h);var b=new Icon(OpenLayers.Util.getImagesLocation()+"trans_to.gif",a,c);return b;};CNavMarker.iconTransfer=function(){var a=new Size(25,28);var c=new Pixel(-a.w/2,-a.h);var b=new Icon(OpenLayers.Util.getImagesLocation()+"zhuan.gif",a,c);return b;};CNavMarker.iconStop=function(){var a=new Size(12,12);var c=new Pixel(-a.w/2,-a.h/2);var b=new Icon(OpenLayers.Util.getImagesLocation()+"blue.gif",a,c);return b;};CNavMarker.dragNode=function(){var a=new Size(11,11);var c=new Pixel(-a.w/2,-a.h/2);var b=new Icon(OpenLayers.Util.getImagesLocation()+"dragnode.png",a,c);return b;};CNavTextMarker=OpenLayers.Class(CNavMarker,{text:null,bshow:false,popupOption:null,initialize:function(c,b,d,a){CNavMarker.prototype.initialize.apply(this,[c,b,a]);this.text=d;if(this.text&&this.text.length>0){this.buildPopup(b);}},buildPopup:function(c){var b=OpenLayers.Util.getRenderedDimensions(this.text);var d=new Pixel(-b.w/2,-(c.size.h+b.h));var a=new CNavRelativePopup(this.id,CNavUtil._toWGS84(this.lonlat),this.text,false,null,d,this.popupOption);this.addPopup(a,this.bshow);},CLASS_NAME:"CNavTextMarker"});CNavSpecialMarker=OpenLayers.Class(CNavTextMarker,{textTop:null,textDown:null,popups:null,bshow:true,upPopupOption:null,downPopupOption:null,initialize:function(d,c,e,a,b){this.textTop=e;this.textDown=a;this.popups=[];this.iconForPopup=c;CNavTextMarker.prototype.initialize.apply(this,[d,c,"CNavSpecialMarker",b]);},buildPopup:function(){this.upPopupOption=OpenLayers.Util.extend(this.upPopupOption,{iconSize:this.iconForPopup.size});var b=new CNavSpecialTextPopup(this.id,CNavUtil._toWGS84(this.lonlat),this.textTop,false,null,this.upPopupOption);var a=new CNavTextPopup(this.id,CNavUtil._toWGS84(this.lonlat),this.textDown,false,null,this.downPopupOption);this.addPopup([b,a],this.bshow);},CLASS_NAME:"CNavSpecailMarker"});CNavPopup=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:true,panMapIfOutOfView:false,imageSize:new OpenLayers.Size(676,736),isAlphaImage:true,fixedRelativePosition:false,positionBlocks:{tl:{offset:new OpenLayers.Pixel(46,18),padding:new OpenLayers.Bounds(8,60,20,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,72,39,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(39,"auto"),anchor:new OpenLayers.Bounds(null,72,0,0),position:new OpenLayers.Pixel(-621,0)},{size:new OpenLayers.Size("auto",38),anchor:new OpenLayers.Bounds(0,34,39,null),position:new OpenLayers.Pixel(0,-611)},{size:new OpenLayers.Size(39,38),anchor:new OpenLayers.Bounds(null,34,0,null),position:new OpenLayers.Pixel(-621,-611)},{size:new OpenLayers.Size(81,54),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-685)}]},tr:{offset:new OpenLayers.Pixel(-38,17),padding:new OpenLayers.Bounds(8,60,20,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,72,39,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(39,"auto"),anchor:new OpenLayers.Bounds(null,72,0,0),position:new OpenLayers.Pixel(-621,0)},{size:new OpenLayers.Size("auto",38),anchor:new OpenLayers.Bounds(0,34,39,null),position:new OpenLayers.Pixel(0,-611)},{size:new OpenLayers.Size(39,38),anchor:new OpenLayers.Bounds(null,34,0,null),position:new OpenLayers.Pixel(-621,-611)},{size:new OpenLayers.Size(81,54),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-225,-685)}]},bl:{offset:new OpenLayers.Pixel(46,-6),padding:new OpenLayers.Bounds(8,29,20,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,38,39,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(39,"auto"),anchor:new OpenLayers.Bounds(null,38,0,32),position:new OpenLayers.Pixel(-621,0)},{size:new OpenLayers.Size("auto",55),anchor:new OpenLayers.Bounds(0,-17,39,null),position:new OpenLayers.Pixel(0,-611)},{size:new OpenLayers.Size(39,55),anchor:new OpenLayers.Bounds(null,-17,0,null),position:new OpenLayers.Pixel(-621,-611)},{size:new OpenLayers.Size(81,37),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-33,-6),padding:new OpenLayers.Bounds(8,29,20,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,38,39,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(39,"auto"),anchor:new OpenLayers.Bounds(null,38,0,32),position:new OpenLayers.Pixel(-621,0)},{size:new OpenLayers.Size("auto",55),anchor:new OpenLayers.Bounds(0,-17,39,null),position:new OpenLayers.Pixel(0,-611)},{size:new OpenLayers.Size(39,55),anchor:new OpenLayers.Bounds(null,-17,0,null),position:new OpenLayers.Pixel(-621,-611)},{size:new OpenLayers.Size(81,37),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-328,-674)}]}},minSize:new OpenLayers.Size(200,50),maxSize:new OpenLayers.Size(400,660),initialize:function(h,e,d,g,f,c){var b=CNavUtil._toMerc(e);var a=[h,b,null,d,null,g,f];this.imageSrc=OpenLayers.Util.getImagesLocation()+"cloud-popup-relative.png";OpenLayers.Popup.Framed.prototype.initialize.apply(this,a);this.contentDiv.className=this.contentDisplayClass;this.contentDiv.unselectable="on";OpenLayers.Util.extend(this,c);},destroy:function(){OpenLayers.Popup.Framed.prototype.destroy.apply(this,arguments);},addCloseBox:function(c){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,new OpenLayers.Size(14,14));this.closeDiv.className="olPopupCloseBox";var b=this.getContentDivPadding();this.closeDiv.style.margin="0px 0px";this.closeDiv.style.right=b.right+"px";this.closeDiv.style.top=b.top+"px";this.groupDiv.appendChild(this.closeDiv);var a=c||function(d){this.hide();OpenLayers.Event.stop(d);};OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(a,this));},createBlocks:function(){this.blocks=[];var f=null;for(var e in this.positionBlocks){f=e;break;}var a=this.positionBlocks[f];for(var d=0;d<a.blocks.length;d++){var h={};this.blocks.push(h);var b=this.id+"_FrameDecorationDiv_"+d;h.div=OpenLayers.Util.createDiv(b,null,null,null,"absolute",null,"hidden",null);h.div.unselectable="on";var c=this.id+"_FrameDecorationImg_"+d;var g=(this.isAlphaImage)?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;h.image=g(c,null,this.imageSize,this.imageSrc,"absolute",null,null,null);h.image.unselectable="on";h.div.appendChild(h.image);this.groupDiv.appendChild(h.div);}},CLASS_NAME:"CNavPopup"});CNavTextPopup=OpenLayers.Class(OpenLayers.Popup.AnchoredBubble,{panMapIfOutOfView:false,autoSise:true,maxSize:new OpenLayers.Size(500,700),relativePosition:"tl",initialize:function(b,e,d,a,g,f){var h=CNavUtil._toMerc(e);var i=[b,h,null,d,null,a,g];var c=null;OpenLayers.Popup.AnchoredBubble.prototype.initialize.apply(this,i);this.contentSize=(c!=null)?c:new OpenLayers.Size(CNavTextPopup.WIDTH,CNavTextPopup.HEIGHT);this.autoSize=true;OpenLayers.Util.extend(this,f);this.contentDiv.unselectable="on";},calculateRelativePosition:function(a){return"br";},CLASS_NAME:"CNavTextPopup"});CNavTextPopup.WIDTH=300;CNavTextPopup.HEIGHT=40;CNavTextPopup.COLOR="#000";CNavTextPopup.OPACITY=1;CNavTextPopup.BORDER="1px solid #000";CNavSpecialTextPopup=OpenLayers.Class(OpenLayers.Popup.AnchoredBubble,{panMapIfOutOfView:false,autoSize:true,relativePosition:"bl",maker:null,maxSize:new OpenLayers.Size(500,700),iconSize:null,initialize:function(b,e,d,a,g,f){var h=CNavUtil._toMerc(e);var i=[b,h,null,d,null,a,g];OpenLayers.Util.extend(this,f);var c=null;OpenLayers.Popup.AnchoredBubble.prototype.initialize.apply(this,i);this.contentSize=(c!=null)?c:new OpenLayers.Size(CNavTextPopup.WIDTH,CNavTextPopup.HEIGHT);this.autoSize=true;this.backgroundColor="#CCCC33";this.contentDiv.unselectable="on";},draw:function(a){if(a==null){if((this.lonlat!==null)&&(this.map!==null)){var b=this.iconSize.h;a=this.map.getLayerPxFromLonLat(this.lonlat).offset(new OpenLayers.Pixel(0,-(b)));}}else{var b=this.iconSize.h;a=a.offset(new OpenLayers.Pixel(0,-(b)));}if(this.closeOnMove){this.map.events.register("movestart",this,this.hide);}if(OpenLayers.Util.getBrowserName()=="firefox"){this.map.events.register("movestart",this,function(){var c=document.defaultView.getComputedStyle(this.contentDiv,null);var d=c.getPropertyValue("overflow");if(d!="hidden"){this.contentDiv._oldOverflow=d;this.contentDiv.style.overflow="hidden";}});this.map.events.register("moveend",this,function(){var c=this.contentDiv._oldOverflow;if(c){this.contentDiv.style.overflow=c;this.contentDiv._oldOverflow=null;}});}this.moveTo(a);if(!this.autoSize&&!this.size){this.setSize(this.contentSize);}this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();if(this.panMapIfOutOfView){this.panIntoView();}return this.div;},updatePosition:function(){if((this.lonlat)&&(this.map)){var a=this.iconSize.h;px=this.map.getLayerPxFromLonLat(this.lonlat).offset(new OpenLayers.Pixel(0,-(a)));if(px){this.moveTo(px);}}},calculateRelativePosition:function(a){return"tr";},CLASS_NAME:"CNavSpecialTextPopup"});CNavTextPopup.WIDTH=300;CNavTextPopup.HEIGHT=40;CNavTextPopup.COLOR="#fff";CNavTextPopup.OPACITY=1;CNavTextPopup.BORDER="1px solid #000";CNavRelativePopup=OpenLayers.Class(OpenLayers.Popup,{panMapIfOutOfView:false,autoSize:true,initialize:function(b,f,d,a,h,e,g){var j=CNavUtil._toMerc(f);var i=[b,j,null,d,a,h];var c=null;OpenLayers.Popup.prototype.initialize.apply(this,i);this.backgroundColor=CNavRelativePopup.COLOR;this.opacity=CNavRelativePopup.OPACITY;this.border=CNavRelativePopup.BORDER;if(e){this.pixeloffset=e;}else{this.pixeloffset=new Pixel(0,0);}OpenLayers.Util.extend(this,g);this.contentDiv.unselectable="on";},destroy:function(){OpenLayers.Popup.prototype.destroy.apply(this,arguments);},draw:function(a){if(a==null){if((this.lonlat!=null)&&(this.map!=null)){a=this.map.getLayerPxFromLonLat(this.lonlat).offset(this.pixeloffset);}}if(this.closeOnMove){this.map.events.register("movestart",this,this.hide);}if(OpenLayers.Util.getBrowserName()=="firefox"){this.map.events.register("movestart",this,function(){var b=document.defaultView.getComputedStyle(this.contentDiv,null);var c=b.getPropertyValue("overflow");if(c!="hidden"){this.contentDiv._oldOverflow=c;this.contentDiv.style.overflow="hidden";}});this.map.events.register("moveend",this,function(){var b=this.contentDiv._oldOverflow;if(b){this.contentDiv.style.overflow=b;this.contentDiv._oldOverflow=null;}});}this.moveTo(a);if(!this.autoSize&&!this.size){this.setSize(this.contentSize);}this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();if(this.panMapIfOutOfView){this.panIntoView();}return this.div;},updatePosition:function(){if((this.lonlat)&&(this.map)){px=this.map.getLayerPxFromLonLat(this.lonlat).offset(this.pixeloffset);if(px){this.moveTo(px);}}},CLASS_NAME:"CNavRelativePopup"});CNavRelativePopup.WIDTH=50;CNavRelativePopup.HEIGHT=20;CNavRelativePopup.COLOR="#fff";CNavRelativePopup.OPACITY=1;CNavRelativePopup.BORDER="0px solid #000";CNavPlaceList=OpenLayers.Class({cityList:null,count:0,map:null,sCodeLst:[],sNameLst:[],resultLst:[],codeLst:[],codeToName:[],callback:null,initialize:function(){this._transferList(CITY);},_getRemoteList:function(){if(!this.cityList){OpenLayers.loadURL(SERVER_URL+"query.do",{serviceType:"poiCityService",r:Math.random()},this,this._callback,this._failure);}},_callback:function(resp){if(!resp){this._counter();}var list=eval("("+resp.responseText+")");this.cityList=list;this._transferList(CITY);},_transferList:function(f){if(f.specialRegionList&&f.specialRegionList.length>0){this.sCodeLst["100000"]="直辖市";this.sNameLst["直辖市"]="100000";this.resultLst["100000"]=[];}var d;for(d=0,lst=f.provinceList;d<lst.length;d++){this.resultLst[lst[d].proviceCode]=[];for(var e=0;e<lst[d].cityList.length;e++){this.resultLst[lst[d].proviceCode].push(lst[d].cityList[e]);this._pushCode(lst[d].cityList[e].name,lst[d].cityList[e].code,lst[d].cityList[e].centerLonLat);}this.sCodeLst[lst[d].proviceCode]=lst[d].proviceName;this.sNameLst[lst[d].proviceName]=lst[d].proviceCode;}if(f.specialRegionList&&f.specialRegionList.length>0){this.sCodeLst.S00000="特别行政区";this.sNameLst["特别行政区"]="S00000";this.resultLst.S00000=[];this.sCodeLst.T00000="台湾省";this.sNameLst["台湾省"]="T00000";this.resultLst.T00000=[];}for(d=0,slst=f.specialRegionList;d<slst.length;d++){var g="(^.*)(北京|天津|重庆|上海)(.*)";var c="(^.*)(香港|澳门)(.*)";var b=new RegExp(g);var a=new RegExp(c);if(b.test(slst[d].name)){this.resultLst["100000"].push(slst[d]);}else{if(a.test(slst[d].name)){this.resultLst.S00000.push(slst[d]);}else{this.resultLst.T00000.push(slst[d]);}}this._pushCode(slst[d].name,slst[d].code,slst[d].centerLonLat);}},_pushCode:function(a,b,c){this.codeLst[a]={code:b,lonlat:c};this.codeToName[b]={name:a,lonlat:c};},_failure:function(){this._counter();},_counter:function(){if(this.count<3){this.count++;this._getRemoteList();}return;},_Match:function(d,f){var b=[];var e="(^.*)("+OpenLayers.String.trim(d)+")(.*)";var a=new RegExp(e);for(var c in f){if(a.test(c)){b.push(f[c]);}}return b;},getAllProvince:function(){var b=[];for(var e in this.sNameLst){b.push(e);}var g=[];b.sort(function(i,c){return i.localeCompare(c);});for(var e in b){var h=this.getProvinceCodeByName(b[e]);g[b[e]]=h;}var f=[];f["直辖市"]="100000";for(var d in g){f[d]=g[d];}return f;},getProvinceCodeByName:function(a){var b=this._Match(a,this.sNameLst);if(!b){alert("没有该省代码");}return b;},getCityListByProvName:function(b){var a=this._Match(b,this.sNameLst);if(a.length==1){var c=this.resultLst[a[0]];c.sort(function(e,d){return e.name.localeCompare(d.name);});return c;}else{alert("没有找到 "+b+" 相关城市");return null;}},getCityListByProvCode:function(a){var b=this.resultLst[a];if(b){b.sort(function(d,c){return d.name.localeCompare(c.name);});return b;}else{alert("没有该代码对应的省份");return null;}},getCityCodeByName:function(b){var a=this._Match(b,this.codeLst);if(a.length==1){return a[0]["code"];}else{alert("没有找到 "+b+" 相关城市代码");return null;}},getCityLonLatByName:function(b){var a=this._Match(b,this.codeLst);if(a.length==1){var c=a[0]["lonlat"];return new OpenLayers.LonLat(c[0],c[1]);}else{alert("没有找到 "+b+" 相关城市坐标");return null;}},getCityLonLatByCode:function(a){var b=this.codeToName[a]["lonlat"];if(b){return new OpenLayers.LonLat(b[0],b[1]);}else{alert("没有该城市代码对应的坐标");return null;}},getFullNameByCode:function(c){if(c.indexOf("0000")>-1){var b="";b=this.sCodeLst[c];if(!b||b.length===0){b=this.codeToName[c].name;}return b;}else{var a="";a=this.codeToName[c].name;var b=c.substring(0,2)+"0000";b=this.sCodeLst[b];return b+a;}return"";},getCityNameByCode:function(c){if(c.indexOf("0000")>-1){var b="";b=this.sCodeLst[c];if(!b||b.length===0){b=this.codeToName[c].name;}return b;}else{var a="";a=this.codeToName[c].name;return a;}return"";},register:function(a){if(typeof a==="function"){this.callback=a;}},_bindEvent:OpenLayers.Function.bindAsEventListener,_observe:OpenLayers.Event.observe,_createDiv:function(){if(OpenLayers.Util.getElement("placeList")){OpenLayers.Util.getElement("placeList").style.display="block";return false;}var a=OpenLayers.Util.createDiv("placeList");OpenLayers.Element.addClass(a,"placeList");var b=this._getBodySize();a.style.top="100px";a.style.left=(b[0]-500)/2+"px";var e=OpenLayers.Util.createDiv("title");OpenLayers.Element.addClass(e,"title");a.appendChild(e);var c=OpenLayers.Util.createDiv("content");OpenLayers.Element.addClass(c,"content");a.appendChild(c);var d=OpenLayers.Util.createDiv("cityList");OpenLayers.Element.addClass(d,"cityList");c.appendChild(d);this.main=a;document.body.appendChild(a);return true;},_closeEvent:function(){OpenLayers.Element.hide(this.main);OpenLayers.Element.hide(this.coverDiv);},_createTitle:function(){var c=OpenLayers.Util.getElement("title");var a="<div id='name' class='name'>全国城市列表</div>";var b="<div id='close' class='close'><img id='closeimg'  alt='关闭' src='"+OpenLayers.Util.getImagesLocation()+"iw_close.gif'></img></div>";c.innerHTML=a+b;this._observe(OpenLayers.Util.getElement("close"),"click",this._bindEvent(this._closeEvent,this));},_createSwitcher:function(){var a=OpenLayers.Util.getElement("switcher");a.innerHTML="<div id='s'>按省份</div><div id='s'>按拼音</div>";},_createLi:function(c,a,b){var d=document.createElement("li");d.id=c[b].code;d.innerHTML="<a href='javascript:;' class='a'>"+c[b].name+"</a>";d.cityName=c[b].name;a.appendChild(d);},_createDt:function(g,d){var f=document.createElement("Dt");var b=document.createElement("Dd");OpenLayers.Element.addClass(f,"dt");OpenLayers.Element.addClass(b,"dd");if(this._isIE()){b.style.margin="0 5px 0px 16px";}else{b.style.margin="0 0 0 -25px";}f.innerHTML=this.sCodeLst[d];var a=document.createElement("ul");OpenLayers.Element.addClass(a,"ul");var e=this.resultLst[d];e.sort(function(i,h){return i.code-h.code;});for(var c=0;c<e.length;c++){this._createLi(e,a,c);}b.appendChild(a);g.appendChild(f);g.appendChild(b);},_clickCity:function(a){var g=a.srcElement?a.srcElement:a.target;var f=g.parentNode;var d=f.id;var b=f.cityName;var c=/^(\d)+$/i;if(!c.test(d)){return;}var e={name:b,lonlat:this.getCityLonLatByCode(d),acode:d};if(d&&this.getCityLonLatByCode(d)){this.map.setDefaultCodeAndZoom(d,API.map.initZoom);this._closeEvent();if(this.callback){this.callback(e);}}else{}},_createCity:function(){var f=OpenLayers.Util.getElement("cityList");var e=document.createElement("DL");OpenLayers.Element.addClass(e,"dl");var c=[];for(a in this.resultLst){c.push(a);}c.sort();var d=[];for(var b=0;b<c.length;b++){var a=c[b];d[a]=this.resultLst[a];}this.resultLst=d;for(a in this.resultLst){this._createDt(e,a);}f.appendChild(e);this._observe(f,"click",this._bindEvent(this._clickCity,this));},_isIE:function(){return(document.all&&window.ActiveXObject&&!window.opera)?true:false;},_getBodySize:function(){var bodySize=[];with(document.body){bodySize[0]=(scrollWidth>clientWidth)?scrollWidth:clientWidth;bodySize[1]=(scrollHeight>clientHeight)?scrollHeight:clientHeight;}return bodySize;},_popCoverDiv:function(){if(OpenLayers.Util.getElement("cover_div")){OpenLayers.Util.getElement("cover_div").style.display="block";return;}var a=OpenLayers.Util.createDiv("cover_div");document.body.appendChild(a);OpenLayers.Element.addClass(a,"cover_div");var c=a.style;var b=this._getBodySize();c.width=b[0]+"px";c.height=b[1]+"px";if(this._isIE()){c.filter="Alpha(Opacity=30)";}else{c.opacity=0.3;}this.coverDiv=a;},__getMousePos:function(b){var c=b||window.event;var a=c.pageX||c.clientX+document.body.scrollLeft;var d=c.pageY||c.clientY+document.body.scrollTop;return{x:a,y:d};},__getRelativePos:function(a){var b=OpenLayers.Util.getElement("placeList");var a=a||window.event;offsetX=a.layerX||a.offsetX;offsetY=a.layerY||a.offsetY;return{offsetX:offsetX,offsetY:offsetY};},__onDivMouseMove:function(b){if(this.moved){var c=OpenLayers.Util.getElement("placeList");var a=this.__getMousePos(b);c.style.left=a.x-c.offsetX+"px";c.style.top=a.y-c.offsetY+"px";}},__onDivMouseUp:function(a){var b=OpenLayers.Util.getElement("placeList");OpenLayers.Event.stopObserving(document,"mousemove",this.moveTmp);this.moved=false;},__calInbound:function(f){var i=OpenLayers.Util.getElement("placeList");var g=OpenLayers.Util.getElement("title");var e=false;var b=parseInt(i.style.left);var c=parseInt(i.style.top);var a=parseInt(g.offsetWidth);var d=parseInt(g.offsetHeight);if(f.x>=b&&f.x<=(b+a)&&f.y>=c&&f.y<=(c+d)){e=true;}return e;},__onDivMouseDown:function(c){var f=OpenLayers.Util.getElement("placeList");var b=this.__getMousePos(c);var a=this.__calInbound(b);if(a){var d=this.__getRelativePos(c);f.offsetX=d.offsetX;f.offsetY=d.offsetY;this.moveTmp=this._bindEvent(this.__onDivMouseMove,this);this.moved=true;this._observe(document,"mousemove",this.moveTmp);}},__onDivOut:function(a){if(this.moved){this.__onDivMouseMove(a);}},__onDivOver:function(){var a=OpenLayers.Util.getElement("title");a.style.cursor="move";this._observe(a,"mousedown",this._bindEvent(this.__onDivMouseDown,this));this.upTmp=this._bindEvent(this.__onDivMouseUp,this);this._observe(a,"mouseup",this.upTmp);},__addMoveEvent:function(){var a=OpenLayers.Util.getElement("title");this._observe(a,"mouseover",this._bindEvent(this.__onDivOver,this));},openWindow:function(){this._popCoverDiv();if(this._createDiv()){this._createTitle();this._createCity();this.__addMoveEvent();}},CLASS_NAME:"CNavPlaceList"});CNavSearchPOI=OpenLayers.Class({key:null,acode:null,currentPage:0,totalPage:null,resultListener:null,imgCallback:null,map:null,__markers:[],panZoomMap:true,isClear:true,bshow:false,tcode:0,cacheResponse:true,cache:{},initialize:function(a){OpenLayers.Util.extend(this,a);if(!this.map){this.map=API.map;}},alertResult:function(a){var c="curent:"+this.currentPage+"\n";for(var b=0;b<a.length;b++){c+=a[b].name+":"+a[b].lonlat+":"+a[b].addr+":"+a[b].tel+"\n";}alert(c);},init:function(){this.currentPage=0;this.totalPage=null;this.tcode=0;this.isSuggestion=false;},register:function(d,c,e){var b=e;var a=(c?c:this);this.resultListener=function(){var f=Array.prototype.slice.apply(arguments,[0]);var g=f.concat(b);return d.apply(a,g);};},search:function(b,c,d,f){if(this.key!=b){this.init();}this.acode=c;if(!this.acode){this.acode=DEFAULT_CITY_CODE;}this.key=b;var a;var e={key:b,acode:this.acode,page:d,markable:f,loop:1};this.__getRemote(e);return true;},searchSuggestion:function(c,d,b,e){if(this.key!=c){this.init();}this.acode=d;if(!this.acode){this.acode=DEFAULT_CITY_CODE;}this.key=c;var g=0;if(b&&b instanceof Array){g=b.join(",");}else{if(b&&b!=null&&b!=""){g=b;}}var a;this.isSuggestion=true;var f={key:c,acode:this.acode,isSuggestion:true,tcode:g,page:e,markable:false,loop:1};this.__getRemote(f);return true;},searchByClass:function(b,c,g,d,f){if(this.key!=b){this.init();}this.acode=c;if(!this.acode){this.acode=DEFAULT_CITY_CODE;}this.key=b;if(g){this.tcode=g;}var a;var e={key:b,acode:this.acode,page:d,markable:f,loop:1};this.__getRemote(e);return true;},searchAndMark:function(b,c,d){var a=this.search(b,c,d,true);return true;},searchAndMarkByClass:function(b,c,e,d){var a=this.searchByClass(b,c,e,d,true);return true;},addMarkers:function(g){var a=new Date().getTime();if(!g||g.length<1){return;}this.map=API.map;if(this.isClear){this.map.clearMarkers(this.__markers);this.__markers=[];}for(var e=0;e<g.length;e++){var d=g[e];var h="<div style='font-size:13px'>&nbsp;<font style='color:#009933'>"+d.name+"</font><br/>";h+=d.addr?("&nbsp;地址："+d.addr):"";h+=d.tel?("<br/>&nbsp;电话："+d.tel):"";h+="</div>";var m=new Size(33,27);var b=new Pixel((-m.w/2),(-m.h));var k=OpenLayers.Util.getImagesLocation()+"/list_"+(e+1)+"_1.png";var j=this.imgCallback?this.imgCallback(e):new Icon(k,m,b);var c=new CNavMarker(d.lonlat,j,{id:"POI_id_"+d.pid});c.addPopup(new CNavPopup("marker"+e,d.lonlat,h,true,null),this.bshow);this.__markers.push(c);}this.map.addMarkerArray(this.__markers);if(this.panZoomMap){var l=new Bounds();for(e=0;e<this.__markers.length;e++){var f=new OpenLayers.LonLat(this.__markers[e].lonlat.lon,this.__markers[e].lonlat.lat);l.extend(f);}this.map.zoomToExtent(l);}},__getRemote:function(g){var e=g.page;if(e&&e>=1){if(this.totalPage){if(e<=this.totalPage){g.page=e;this.currentPage=e;}else{g.page=1;this.currentPage=1;}}else{g.page=1;this.currentPage=1;}}else{g.page=1;this.currentPage=1;}var a=OpenLayers.Function.bind(this.__callback,this,g);var b=OpenLayers.Function.bind(this.__failure,this,g);var d=CNavUtil.__ajaxRemote;var c=(this.tcode==0)?"poiService":"poiClassService";if(c=="poiClassService"&&!this.key){c="poiTypeService";}if(g.isSuggestion||this.isSuggestion){c="poiByTypeQuery";this.tcode=g.tcode;}var f="query.do";var h=window.DEFAULT_LANGUAGE?window.DEFAULT_LANGUAGE:null;if(h&&h==="EN_US"){c="queryPOIENService";this.tcode=0;f="traquery.do";}d.loadUrl(SERVER_URL+f,{serviceType:c,tcode:this.tcode,acode:g.acode,page:g.page,name:g.key,IP:null},this,a,b);},__callback:function(c,d){if(d){if(this.cacheResponse){this.cache.trip=c;this.cache.resp=d;}var b=d;if(b.ExceptionMessage&&b.type=="1"){if(c.loop<2){c.loop++;this.__getRemote(c);}else{this.resultListener(null);}return;}this.totalPage=b.totalpage;var a=this.__buildList(b);if(!a){if(c.loop<2){c.loop++;this.__getRemote(c);}else{this.resultListener(null);}}else{this.resultListener(a);if(c.markable){this.addMarkers(a);}}}else{if(c.loop<2){c.loop++;this.__getRemote(c);}else{this.resultListener(null);}}},__failure:function(a,b){if(a.loop<2){a.loop++;this.__getRemote(a);}else{this.resultListener(null);}},__buildList:function(b){var a=this.__buildPOIList(b);return a;},__buildPOIList:function(l,k){if(k){return null;}var b=l.features;var e=[];if(!b){if(l.poi){var b=l.poi;for(var d=0;d<b.length;d++){var g=b[d];var j=g.point;var a=g;var h=a.addr?a.addr:a.name;e.push({pid:g.pid,name:a.name,lonlat:new OpenLayers.LonLat(j[0],j[1]),addr:h,tel:a.tel});}}if(l.pois){var b=l.pois;for(var d=0;d<b.length;d++){var g=b[d];e.push({pid:g.id,name:g.ename,lonlat:new OpenLayers.LonLat(g.lon,g.lat),addr:"",tel:""});}}return e;}for(var d=0;d<b.length;d++){var g=b[d];var j=g.geometry.coordinates;var a=g.properties;var h=a.addr?a.addr:a.name;e.push({pid:g.id,name:a.name,lonlat:new OpenLayers.LonLat(j[0],j[1]),addr:h,tel:a.tel});}return e;},next:function(b){var a=this.currentPage+1;if(a>this.totalPage){return null;}if(!b){return this.search(this.key,this.acode,a);}else{return this.searchAndMark(this.key,this.acode,a);}},nextAndMark:function(){var a=this.currentPage+1;if(a>this.totalPage){return null;}return this.searchAndMark(this.key,this.acode,a);},previous:function(b){var a=this.currentPage-1;if(a<1){return null;}if(!b){return this.search(this.key,this.acode,a);}else{return this.searchAndMark(this.key,this.acode,a);}},previousAndMark:function(){var a=this.currentPage-1;if(a<1){return null;}return this.searchAndMark(this.key,this.acode,a);},first:function(a){if(!a){if(this.currentPage!=1){return this.search(this.key,this.acode,1);}}else{return this.searchAndMark(this.key,this.acode,1);}},firstAndMark:function(){if(this.currentPage!=1){return this.searchAndMark(this.key,this.acode,1);}},last:function(a){if(this.totalPage){if(!a){if(this.currentPage!=this.totalPage){return this.search(this.key,this.acode,this.totalPage);}}else{return this.searchAndMark(this.key,this.acode,this.totalPage);}}return false;},lastAndMark:function(){if(this.totalPage){if(this.currentPage!=this.totalPage){return this.searchAndMark(this.key,this.acode,this.totalPage);}}return false;},clear:function(){this.map.clearMarker(this.__markers);this.__markers=[];},panZoomToID:function(f,g,a,c){var b=null;if(f&&(b=this.map.getMarkerById("POI_id_"+f))){if(g){this.map.zoomToLonLat(CNavUtil._toWGS84(b.lonlat),g);}else{this.map.panToLonLat(CNavUtil._toWGS84(b.lonlat));}if(b.popups.length>0&&a===true){if(c){for(var d=0;d<this.map.popups.length;d++){this.map.popups[d].hide();}}if(b.__popupAdded){for(var e=0;e<b.popups.length;e++){b.popups[e].toggle();}}else{b.fireEvent("click");}}}if(b){this.map.bringMarkerTop(b);}},getMarkerById:function(b){if(typeof b==="undefined"){return null;}var a=this.map.getMarkerById("POI_id_"+b);if(a){return a;}else{return null;}},CLASS_NAME:"CNavSearchPOI"});CNavSearchHB=OpenLayers.Class(CNavSearchPOI,{acode:null,resultListener:null,imgUrl:null,imgSize:null,map:null,isTest:false,__markers:[],_hbPoiCb:null,initialize:function(a){OpenLayers.Util.extend(this,a);if(!this.map){this.map=API.map;}if(a.imgUrl){this.imgUrl=a.imgUrl;}if(a.imgSize){this.imgSize=a.imgSize;}CNavSearchPOI.prototype.initialize.apply(this,arguments);},register:function(d,c,e){var b=e;var a=(c?c:this);this.resultListener=function(){var f=Array.prototype.slice.apply(arguments,[0]);var g=f.concat(b);return d.apply(a,g);};},searchPoiByOrg:function(f,c,e,b){this.acode=c;if(!this.acode){this.acode=DEFAULT_CITY_CODE;}if(b){if(f.split(",").length===0){var d={ExceptionMessage:"传入的orgid格式有误!"};this.resultListener(d);return true;}var a=this._getPoiOrgs(f,this.acode,e);return true;}var a=this._getPoiOrg(f,this.acode,e);return true;},searchAndMarkPoiByOrg:function(d,b,a){var c=this.searchPoiByOrg(d,b,true,a);return true;},addMarker:function(h){if(!h){return;}this.map=API.map;this.map.clearMarkers();var g="<div style='font-size:13px'>&nbsp;<font style='color:#009933'>"+h.name+"</font><br/>";g+=h.addr?("&nbsp;地址："+h.addr):"";g+=h.tel?("<br/>&nbsp;电话："+h.tel):"";g+="</div>";var b=this.imgUrl?this.imgUrl:OpenLayers.Util.getImagesLocation()+"list_1_2.png";var e=this.imgSize?this.imgSize:new Size(33,27);var f=new Pixel((-e.w/2),(-e.h));var c=new Icon(b,e,f);var d=new LonLat(h.lonlat[0],h.lonlat[1]);var a=new CNavMarker(d,c);a.addPopup(new CNavPopup("marker1",d,g,true,null),false);this.map.addMarker(a);this.map.zoomToLonLat(d,this.map.getZoom());},addMarkers:function(g){if(!g||g.length<1){return;}this.map=API.map;if(this.isClear){this.map.clearMarkers(this.__markers);this.__markers=[];}var l=null;for(var e=0;e<g.length;e++){var d=g[e];var a=d.lonlat[0]?d.lonlat[0]:d.lonlat.lon;var j=d.lonlat[1]?d.lonlat[1]:d.lonlat.lat;if("undefined"==typeof(a)){}else{if(!l){l=new LonLat(a,j);}else{l.lon=a;l.lat=j;}var h="<div style='font-size:13px'>&nbsp;<font style='color:#009933'>"+d.name+"</font><br/>";h+=d.addr?("&nbsp;地址："+d.addr):"";h+=d.tel?("<br/>&nbsp;电话："+d.tel):"";h+="</div>";var o=new Size(33,27);var b=new Pixel((-o.w/2),(-o.h));var m=OpenLayers.Util.getImagesLocation()+"list_"+(e%10+1)+"_1.png";var k=this.imgCallback?this.imgCallback(e):new Icon(m,o,b);var c=new CNavMarker(l,k);c.addPopup(new CNavPopup("marker"+e,l,h,true,null),false);this.__markers.push(c);}}alert(this.__markers);if(this.__markers.length>0){this.map.addMarkerArray(this.__markers);if(this.panZoomMap){var n=new Bounds();for(e=0;e<this.__markers.length;e++){var f=new OpenLayers.LonLat(this.__markers[e].lonlat.lon,this.__markers[e].lonlat.lat);n.extend(f);}this.map.zoomToExtent(n);}}},search:function(b,c,d,f,g){if(this.key!=b){this.init();}this.acode=c;if(!this.acode){this.acode=DEFAULT_CITY_CODE;}this.key=b;this._hbPoiCb=g?g:function(h){};var a;var e={key:b,acode:this.acode,page:d,markable:f,loop:1};if(d&&d>=1){if(this.totalPage){if(d<=this.totalPage){e.page=d;this.currentPage=d;}else{e.page=1;this.currentPage=1;}}else{e.page=1;this.currentPage=1;}}else{e.page=1;this.currentPage=1;}this.__getRemote(e);return true;},searchAndMark:function(b,c,d,e){var a=this.search(b,c,d,true,e);return true;},__getRemote:function(c){var d=OpenLayers.Function.bind(this._callback2,this,c);var a=OpenLayers.Function.bind(this._failure2,this,c);var b=CNavUtil.__ajaxRemote;b.loadUrl(SERVER_URL+"query.do",{serviceType:"poiService2",acode:c.acode,name:c.key,page:c.page},this,d,a);},_getPoiOrg:function(h,e,g,d){var i=d?d:{str:null,count:null,markable:g};if(i.count==null){i.count=1;}if(this.isTest){var b=this._testRtn(e,h);this._callback(i,h,e,b);}else{var c=OpenLayers.Function.bind(this._callback,this,i,h,e);var a=OpenLayers.Function.bind(this._failure,this,i,h,e);var f=CNavUtil.__ajaxRemote;f.loadUrl(SERVER_URL+"query.do",{serviceType:"PoiOrgService",acode:e,name:h,IP:null},this,c,a);}},_getPoiOrgs:function(h,e,g,d){var i=d?d:{str:null,count:null,markable:g};if(i.count==null){i.count=1;}if(this.isTest){var b=this._testRtn(e,h);this._callback(i,h,e,b);}else{var c=OpenLayers.Function.bind(this._callback1,this,i,h,e);var a=OpenLayers.Function.bind(this._failure1,this,i,h,e);var f=CNavUtil.__ajaxRemote;f.loadUrl(SERVER_URL+"query.do",{serviceType:"MorePoiOrgService",acode:e,name:h,IP:null},this,c,a);}},_testRtn:function(acode,key){var result='{"ExceptionMessage":"目前仅支持上海企业查询","type":"1"}';if(acode!="310000"){return eval("("+result+")");}if(key=="SH0000065562"){result='{"pid":1,"name":"上海志力物业管理有限公司","lonlat":[121.364,31.2497],"addr":"丰庄北路365号"}';}else{if(key=="SH0000018611"){result='{"pid":2,"name":"虹口房地产经纪事务有限公司(淞南门市部)","lonlat":[121.4841,31.3373],"addr":"宝山区长逸路６６３号"}';}else{if(key=="SH0000070439"){result='{"pid":3,"name":"上海蓝梯体育用品有限公司","lonlat":[121.5594,31.2282],"addr":"浦东新区丁香路１１８８号"}';}else{if(key=="SH0000039987"){result='{"pid":4,"name":"迪欧咖啡(青浦店)","lonlat":[121.1245,31.1494],"addr":"青浦区公园路９９号"}';}else{if(key=="SH0000096163"){result='{"pid":5,"name":"上海好德便利(长辉店)","lonlat":[121.4539,31.3369],"addr":"宝山区长江西路１４０１号"}';}else{result='{"ExceptionMessage":"目前暂无数据","type":"1"}';}}}}}return eval("("+result+")");},_callback:function(d,a,b,e){if(e){if(e.ExceptionMessage&&e.type=="1"){var c={ExceptionMessage:e.ExceptionMessage};this.resultListener(c);return;}d.str=e;var c=d.str;this.resultListener(c);if(d.markable&&!c.ExceptionMessage){this.addMarker(c);}}},_failure:function(c,a,b){if(c.count<3){c.count++;this._getPoiOrg(a,b,c.markable,c);}else{c.str="未查询到信息";this.resultListener(c.str);}},_callback1:function(d,a,b,e){if(e){if(e.ExceptionMessage&&e.type=="1"){var c={ExceptionMessage:e.ExceptionMessage};this.resultListener(c);return;}d.str=e;var c=d.str;this.resultListener(c);if(d.markable&&!c.ExceptionMessage){this.addMarkers(c);}}},_failure1:function(c,a,b){if(c.count<3){c.count++;this._getPoiOrgs(a,b,c.markable,c);}else{c.str="未查询到信息";this.resultListener(c.str);}},_callback2:function(d,e){if(e){var b=e;if(b.ExceptionMessage&&b.type=="1"){var c={ExceptionMessage:b.ExceptionMessage};this._hbPoiCb(c);return;}this.totalPage=b.totalpage;var a=this.__buildList(b);if(!a){if(d.loop<2){d.loop++;this.__getRemote(d);}}else{this._hbPoiCb(a);if(d.markable){this.addMarkers(a);}}}else{var c={ExceptionMessage:"未查询到信息"};this._hbPoiCb(c);return;}},_failure2:function(b,c){if(b.loop<3){b.loop++;this.__getRemote(b);}else{var a={ExceptionMessage:"未查询到信息"};this._hbPoiCb(a);}},CLASS_NAME:"CNavSearchHB"});CNavSearchNearby=OpenLayers.Class({pid:null,type:null,acode:null,totalPage:null,currentPage:null,totalCnt:null,r:null,poiObj:null,map:null,POIListener:null,resultListener:null,typeCallback:null,imgCallback:null,byName:false,rtnDet:false,retmode:1,__markers:[],panZoomMap:true,isClear:true,bshow:false,isTest:false,cacheResponse:true,cache:{},arrPOIType:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.poiObj=new CNavSearchPOI();if(this.POIListener){this.registerPOIListener(this.POIListener,this);}if(!this.map){this.map=API.map;}arrPOIType=new Array();},init:function(a){this.currentPage=null;this.totalPage=null;this.totalCnt=null;},defaultListener:function(a){this.result=a;var b=this.result[0];this.searchAndMark(b.pid,"2030000");},registerPOIListener:function(b,a,c){this.poiObj.register(b,a,c);},registerNearbyListener:function(b,a,c){this.poiObj.register.apply(this,arguments);},register:function(c,a,b){this.registerPOIListener(c.fn,c.caller,c.params);this.registeTypeCallback(a.fn,a.caller,a.params);this.registerNearbyListener(b.fn,b.caller,b.params);},registeTypeCallback:function(d,c,e){var b=e;var a=(c?c:this);this.typeCallback=function(){var f=Array.prototype.slice.apply(arguments,[0]);var g=f.concat(b);return d.apply(a,g);};},getCenter:function(c,b,d){(this.map)?(this.poiObj.map=this.map):(this.poiObj.map=API.map);if(b){this.setCity(b);}else{this.acode=DEFAULT_CITY_CODE;}var a=this.poiObj.search(c,this.acode,d);return a;},nextCenter:function(){var a=this.poiObj.next();return a;},lastCenter:function(){var a=this.poiObj.last();return a;},firstCenter:function(){var a=this.poiObj.first();return a;},previousCenter:function(){var a=this.poiObj.previous();return a;},getType:function(){return TYPE.POIType;},setCity:function(a){var b=this.map.placeListObj.getCityCodeByName(a);if(b){this.acode=b;}},search:function(d,f,g,e,a,h){var b;if(this.pid!=d){this.pid=d;this.init();}a?this.r=a:this.r=3000;this.acode=g?g:DEFAULT_CITY_CODE;if(!this.byName){if(!f){if(!this.type){alert("请设置poi类型!");return null;}}else{if(!this.type){this.type=f;b={pid:this.pid,type:this.type,acode:this.acode,page:e,markable:h,loop:1};}else{var k=false;if(arrPOIType!=null){for(var c=0;c<arrPOIType.length;c++){if(arrPOIType[c]==f){k=true;break;}}}if(!k){this.type=f;}}}}else{this.type=f;}var j;if(b==null){b={pid:this.pid,type:this.type,acode:this.acode,page:e,markable:h,loop:1};}if(e&&e>=1){if(this.totalPage){if(e<=this.totalPage){b.page=e;this.currentPage=e;}else{b.page=1;this.currentPage=1;}}else{b.page=1;this.currentPage=1;}}else{b.page=1;this.currentPage=1;}j=this.__getRemote(b);return j;},searchAndMark:function(b,d,c,f,e){var a=this.search(b,d,c,f,e,true);return a;},addMarkers:function(a){CNavSearchPOI.prototype.addMarkers.apply(this,arguments);},__getRemote:function(e){var b=OpenLayers.Function.bind(this.__callback,this,e);var c=OpenLayers.Function.bind(this.__failure,this,e);var h;var f=e.type;var g=Number(f);if(!isNaN(g)){h="poiRoundServiceDetail";}else{h="poiRoundServiceDetail2";}var a={serviceType:h,acode:e.acode,page:e.page,pid:e.pid,tcode:e.type,radius:this.r,retmode:this.retmode,pagesize:10,IP:null};if((e.pid instanceof LonLat)|e.pid instanceof OpenLayers.LonLat){h="poiRoundServiceDetail3";if(this.byName){a={serviceType:h,cx:e.pid.lon,cy:e.pid.lat,acode:e.acode,page:e.page,name:e.type,tcode:"",radius:this.r,retmode:this.retmode,pagesize:10,IP:null};}else{a={serviceType:h,cx:e.pid.lon,cy:e.pid.lat,acode:e.acode,page:e.page,name:"",tcode:e.type,radius:this.r,retmode:this.retmode,pagesize:10,IP:null};}}var d=CNavUtil.__ajaxRemote;d.loadUrl(SERVER_URL+"query.do",a,this,b,c);return true;},__callback:function(c,d){if(d){var a=d;if(a.ExceptionMessage&&a.type=="1"){this.totalCnt="0";var b={ExceptionMessage:a.ExceptionMessage};this.resultListener(b);return;}this.totalPage=a.totalpage;this.totalCnt=a.tcnt;arr=this.__buildList(a);if(!arr){if(c.loop<2){c.loop++;this.__getRemote(c);}}else{if(this.cacheResponse){this.cache.trip=c;this.cache.resp=d;}if(c.markable){this.addMarkers(arr);}this.resultListener(arr);}}},__failure:function(a,c){if(a.loop<2){a.loop++;this.__getRemote(a);}else{var b=CNavUtil._buildPOIList(null,true);this.totalCnt="0";this.resultListener(b);}},__buildList:function(b){var a=this.isTest?this._buildTestData():CNavUtil._buildPOIList(b);return a;},_buildTestData:function(result){var arr=new Array();var str="";if(this.byName){if(this.type.indexOf("咖啡")>-1){str='{"pid":4,"name":"迪欧咖啡(青浦店)","lonlat":new OpenLayers.LonLat(121.1245,31.1494),"addr":"青浦区公园路９９号","tel":"暂无","orgid":"SH0000039987"}';}else{if(this.type.indexOf("物业")>-1){str='{"pid":1,"name":"上海志力物业管理有限公司","lonlat":new OpenLayers.LonLat(121.364,31.2497),"addr":"丰庄北路365号","tel":"暂无","orgid":"SH0000065562"}';}else{if(this.type.indexOf("体育")>-1){str='{"pid":3,"name":"上海蓝梯体育用品有限公司","lonlat":new OpenLayers.LonLat(121.5594,31.2282),"addr":"浦东新区丁香路１１８８号","tel":"暂无","orgid":"SH0000070439"}';}else{if(this.type.indexOf("便利店")>-1){str='{"pid":5,"name":"上海好德便利(长辉店)","lonlat":new OpenLayers.LonLat(121.4539,31.3369),"addr":"宝山区长江西路１４０１号","tel":"暂无","orgid":"SH0000096163"}';}else{if(this.type.indexOf("房地产")>-1){str='{"pid":5,"name":"虹口房地产经纪事务有限公司(淞南门市部)","lonlat":new OpenLayers.LonLat(121.4841,31.3373),"addr":"宝山区长逸路６６３号","tel":"暂无","orgid":"SH0000018611"}';}else{str='{"ExceptionMessage":"目前暂无数据","type":"1"}';}}}}}arr.push(eval("("+str+")"));return arr;}return arr;},next:function(b){var a=this.currentPage+1;if(a>this.totalPage){return null;}if(!b){return this.search(this.pid,this.type,this.acode,a,this.r);}else{return this.search(this.pid,this.type,this.acode,a,this.r,true);}},nextAndMark:function(){var a=this.currentPage+1;if(a>this.totalPage){return null;}return this.searchAndMark(this.pid,this.type,this.acode,a,this.r);},previous:function(b){var a=this.currentPage-1;if(a<1){return null;}if(!b){return this.search(this.pid,this.type,this.acode,a,this.r);}else{return this.search(this.pid,this.type,this.acode,a,this.r,true);}},previousAndMark:function(){var a=this.currentPage-1;if(a<1){return null;}return this.searchAndMark(this.pid,this.type,this.acode,a,this.r);},first:function(a){if(!a){return this.search(this.pid,this.type,this.acode,1,this.r);}else{return this.search(this.pid,this.type,this.acode,1,this.r,true);}},firstAndMark:function(){return this.searchAndMark(this.pid,this.type,this.acode,1,this.r);},last:function(a){if(this.totalPage){if(!a){return this.search(this.pid,this.type,this.acode,this.totalPage,this.r);}else{return this.search(this.pid,this.type,this.acode,this.totalPage,this.r,true);}}return false;},lastAndMark:function(){if(this.totalPage){return this.searchAndMark(this.pid,this.type,this.acode,this.totalPage,this.r);}return false;},clear:function(){this.map.clearMarker(this.__markers);this.__markers=[];},panZoomToID:function(c,d,a,b){CNavSearchPOI.prototype.panZoomToID.apply(this,arguments);},getMarkerById:function(b){if(typeof b==="undefined"){return null;}var a=this.map.getMarkerById("POI_id_"+b);if(a){return a;}else{return null;}},__bindEvent:OpenLayers.Function.bindAsEventListener,__observe:OpenLayers.Event.observe,__createDiv:function(){if(OpenLayers.Util.getElement("poitypeList")){OpenLayers.Util.getElement("poitypeList").style.display="block";return false;}var a=OpenLayers.Util.createDiv("poitypeList");OpenLayers.Element.addClass(a,"placeList");var b=this.__getBodySize();a.style.top="100px";a.style.left=(b[0]-500)/2+"px";var f=OpenLayers.Util.createDiv("typetitle");OpenLayers.Element.addClass(f,"title");a.appendChild(f);var d=OpenLayers.Util.createDiv("typecontent");OpenLayers.Element.addClass(d,"content");a.appendChild(d);var c=OpenLayers.Util.createDiv("typeswitcher");OpenLayers.Element.addClass(c,"switcher");d.appendChild(c);var e=OpenLayers.Util.createDiv("typeList");OpenLayers.Element.addClass(e,"cityList");d.appendChild(e);this.main=a;document.body.appendChild(a);return true;},__closeEvent:function(){OpenLayers.Element.hide(this.main);OpenLayers.Element.hide(this.coverDiv);},__createTitle:function(){var c=OpenLayers.Util.getElement("typetitle");var a="<div id='typename'class='name'>兴趣点类型表</div>";var b="<div id='typeclose' class='close'>关闭</div>";c.innerHTML=a+b;this.__observe(OpenLayers.Util.getElement("typeclose"),"click",this.__bindEvent(this.__closeEvent,this));},__createSwitcher:function(){var a=OpenLayers.Util.getElement("typeswitcher");a.innerHTML="<div id='s'>按省份</div><div id='s'>按拼音</div>";},__createLi:function(b,a){var c=document.createElement("li");c.id=b.code;c.innerHTML="<a href='javascript:;' hascode=1 key='"+b.name+"' class='a' id='"+b.code+"'>"+b.name+"</a>";a.appendChild(c);},__createDt:function(h,d,g){var f=document.createElement("Dt");var b=document.createElement("Dd");OpenLayers.Element.addClass(f,"dt");OpenLayers.Element.addClass(b,"dd");if(this.__isIE()){b.style.margin="0 5px 0px 16px";}else{b.style.margin="0 0 0 -25px";}f.innerHTML="<a href='javascript:;' hascode=1 key='"+d+"' class='big' id='"+g.code+"'>>>"+d+"</a>";var a=document.createElement("ul");OpenLayers.Element.addClass(a,"ul");var e=g.subtype;for(var c=0;c<e.length;c++){arrPOIType.push(e[c]["name"]);this.__createLi(e[c],a);}b.appendChild(a);h.appendChild(f);h.appendChild(b);},__clickType:function(a){var f=a.srcElement?a.srcElement:a.target;var e=f;var c=e.getAttribute("hascode");var b=e.getAttribute("key");var d={name:b,code:c};if(c){this.type=e.id;this.__closeEvent();this.typeCallback(d);}},__createType:function(){var e=OpenLayers.Util.getElement("typeList");var d=document.createElement("DL");OpenLayers.Element.addClass(d,"dl");var c=this.getType();var b;for(b=0;b<c.length;b++){var a=c[b]["name"];arrPOIType.push(a);if(c[b]["subtype"].length>0){this.__createDt(d,a,c[b]);}}for(b=0;b<c.length;b++){var a=c[b]["name"];if(c[b]["subtype"].length==0){this.__createDt(d,a,c[b]);}}e.appendChild(d);this.__observe(e,"click",this.__bindEvent(this.__clickType,this));},__isIE:function(){return(document.all&&window.ActiveXObject&&!window.opera)?true:false;},__getBodySize:function(){var bodySize=[];with(document.body){bodySize[0]=(scrollWidth>clientWidth)?scrollWidth:clientWidth;bodySize[1]=(scrollHeight>clientHeight)?scrollHeight:clientHeight;}return bodySize;},__popCoverDiv:function(){if(OpenLayers.Util.getElement("cover_div1")){OpenLayers.Util.getElement("cover_div1").style.display="block";return;}var a=OpenLayers.Util.createDiv("cover_div1");document.body.appendChild(a);OpenLayers.Element.addClass(a,"cover_div");var c=a.style;var b=this.__getBodySize();c.width=b[0]+"px";c.height=b[1]+"px";if(this.__isIE()){c.filter="Alpha(Opacity=30)";}else{c.opacity=0.3;}this.coverDiv=a;},openTypeSelector:function(){this.__popCoverDiv();if(this.__createDiv()){this.__createTitle();this.__createType();}},CLASS_NAME:"CNavSearchBearby"});CNavSearchBusLine=OpenLayers.Class({acode:DEFAULT_CITY_CODE,name:null,sIcon:CNavMarker.iconStart(),mIcon:CNavMarker.iconStop(),eIcon:CNavMarker.iconEnd(),markerAdded:true,lineAdded:true,listenerFirst:null,listenerSecond:null,map:API.map,__markers:null,__currentFeature:null,panZoomMap:true,cacheResponse:true,cache:{},initialize:function(a){OpenLayers.Util.extend(this,a);if(!this.map){this.map=API.map;}if(!this.acode){this.acode=DEFAULT_CITY_CODE;this.name=DEFAULT_CITY_NAME;}},setCity:function(a){var b=this.map.placeListObj.getCityCodeByName(a);if(b){this.acode=b;this.name=a;}},registerListenerFirst:function(c,d){var b=d;var a=this;this.listenerFirst=function(){var e=Array.prototype.slice.apply(arguments,[0]);var f=e.concat(b);return c.apply(a,f);};},registerListenerSecond:function(c,d){var b=d;var a=this;this.listenerSecond=function(){var e=Array.prototype.slice.apply(arguments,[0]);var f=e.concat(b);return c.apply(a,f);};},register:function(b,a){this.registerListenerFirst(b.fn,b.params);this.registerListenerSecond(a.fn,a.params);},searchFirst:function(e,d,c){if(!e){return null;}if(d){this.setCity(d);}else{this.acode=DEFAULT_CITY_CODE;}var g=c?c:null;if(!g){g={loop:1,params:{key:e,name:d}};}var a=OpenLayers.Function.bind(this.__callback,this,g);var b=OpenLayers.Function.bind(this.__failure,this,g);var f=CNavUtil.__ajaxRemote;f.loadUrl(SERVER_URL+"query.do",{serviceType:"busLineFristService",acode:this.acode,name:e},this,a,b);},__callback:function(b,c){if(c){var a=this.__buildList(c,b);if(a){if(this.cacheResponse){this.cache.trip=b;this.cache.resp=c;}this.listenerFirst.apply(this,[a]);}else{if(b.loop<2){b.loop++;this.searchFirst(b.params.key,b.params.name,b);}else{this.listenerFirst.apply(this,[a]);}}}else{if(b.loop<2){b.loop++;this.searchFirst(b.params.key,b.params.name,b);}else{this.listenerFirst.apply(this,[null]);}}},__failure:function(a,b){if(a.loop<2){a.loop++;this.searchFirst(a.params.key,a.params.name,a);}else{this.listenerFirst.apply(this,[null]);}},__buildList:function(f,e){var a=f.busLines;if(a){var b=[];for(var d=0;d<a.length;d++){var c=a[d];b.push({bid:c.bid,name:c.lineName,cost:c.cost,sTime:c.Stime,eTime:c.Etime,internals:c.Internal,scnt:c.scnt});}return b;}return null;},searchSecond:function(e,d,c){if(!e){return null;}if(d){this.setCity(d);}else{this.acode=DEFAULT_CITY_CODE;}var g=c?c:null;if(!g){g={loop:1,params:{bid:e,name:d}};}var a=OpenLayers.Function.bind(this.__callback1,this,g);var b=OpenLayers.Function.bind(this.__failure1,this,g);var f=CNavUtil.__ajaxRemote;f.loadUrl(SERVER_URL+"query.do",{serviceType:"busLineSecondService",acode:this.acode,bid:e},this,a,b);},__callback1:function(a,d){if(d){var g=this.__buildList1(d,a);if(g){this.listenerSecond.apply(this,[g]);var l;if(this.lineAdded){var m=[];var f;var k=g.coordinates;for(f=0;f<k.length;f++){var h=new LonLat(k[f][0],k[f][1]);var n=CNavUtil._toMerc(h);m.push(new OpenLayers.Geometry.Point(n.lon,n.lat));}l=new OpenLayers.Geometry.LineString(m);var p=new OpenLayers.Feature.Vector(l);if(this.__currentFeature){this.map.dynamicVectorLayer.removeFeatures(this.__currentFeature);}this.__currentFeature=p;this.map.dynamicVectorLayer.addFeatures(p);}if(this.markerAdded){var e=[];e.push(new CNavTextMarker(new LonLat(g.stopcoords[0][0],g.stopcoords[0][1]),this.sIcon.clone(),g.stops[0]));for(f=1;f<g.stops.length-1;f++){var j=new CNavTextMarker(new LonLat(g.stopcoords[f][0],g.stopcoords[f][1]),this.mIcon.clone(),g.stops[f],{bshow:false,popupOption:{border:"#000 1px solid"}});j.on({mouseover:function(c){this.fireEvent("click");},mouseout:function(c){this.fireEvent("click");}});e.push(j);}e.push(new CNavTextMarker(new LonLat(g.stopcoords[g.stops.length-1][0],g.stopcoords[g.stops.length-1][1]),this.eIcon.clone(),g.stops[g.stops.length-1]));if(this.__markers&&this.__markers.length>0){this.map.clearMarker(this.__markers);}this.__markers=e;this.map.addMarkerArray(e);}if(this.panZoomMap){var b=l.getBounds();if(this.__markers.length<1){return;}var o=new Bounds();for(f=0;f<this.__markers.length;f++){var h=new OpenLayers.LonLat(this.__markers[f].lonlat.lon,this.__markers[f].lonlat.lat);o.extend(h);}o.extend(b);this.map.zoomToExtent(o);}}else{if(a.loop<2){a.loop++;this.searchSecond(a.params["key"],a.params["name"],a.params["markable"],a);}else{this.listenerSecond.apply(this,[g]);}}}else{if(a.loop<2){a.loop++;this.searchSecond(a.params["key"],a.params["name"],a.params["markable"],a);}else{this.listenerSecond.apply(this,[null]);}}},__failure1:function(a,b){if(a.loop<2){a.loop++;this.searchSecond(a.params.bid,a.params.name,a.params.markable,a);}else{this.listenerSecond.apply(this,[null]);}},__buildList1:function(d,b){if(d.features){var g=d.features[0];var h=g.geometry.geometries[0].coordinates;var f=g.bid;var j=g.properties.stoplst;var a=g.properties.lineName;var k=[];for(var e=1;e<g.geometry.geometries.length;e++){k.push(g.geometry.geometries[e].coordinates);}return{bid:f,name:a,stops:j,coordinates:h,stopcoords:k};}return null;},clear:function(){if(this.__markers&&this.__markers.length>0){this.map.clearMarker(this.__markers);}if(this.__currentFeature){this.map.dynamicVectorLayer.removeFeatures(this.__currentFeature);}},CLASS_NAME:"CNavSearchBusLine"});CNavSearchRoute=OpenLayers.Class({acodeS:DEFAULT_CITY_CODE,acodeE:DEFAULT_CITY_CODE,poiObjS:null,poiObjE:null,strategy:2,map:null,GeoJSONFormater:null,startListener:null,endListener:null,resultListener:function(){},sIcon:CNavMarker.iconFrom(),eIcon:CNavMarker.iconTo(),__markers:[],__features:[],markerAdded:true,routeAdded:true,panZoomMap:true,SEAdded:true,style:null,isclear:true,cacheResponse:true,cache:{},layer:null,limit:-1,searchOnMove:false,styleMaps:CNavDefaultStyle.getStyleMap(),styleMape:CNavDefaultStyle.getStyleMap(),hasDragControl:false,initialize:function(a){OpenLayers.Util.extend(this,a);if(this.style){this.style=this.style.getStyle();}this.poiObjS=new CNavSearchPOI();this.poiObjE=new CNavSearchPOI();this.GeoJSONFormater=new OpenLayers.Format.GeoJSON({internalProjection:CNavUtil.EPSG900913,externalProjection:CNavUtil.EPSG4326});if(this.startListener){this.registerStartListener(this.startListener);}if(this.endListener){this.registerEndListener(this.endListener);}if(!this.map){this.map=API.map;}this.layer=this.map.dynamicMarkerLayer;if(this.hasDragControl){this.dragControl=new CNavDragRouteControl(this.layer,this);this.map.addControl(this.dragControl);}},init:function(a){},registerStartListener:function(a,b){this.poiObjS.register(a,this,b);},registerEndListener:function(a,b){this.poiObjE.register(a,this,b);},registerRouteListener:function(b,c){var a=[b,this,c];this.poiObjS.register.apply(this,a);},register:function(a,b,c){this.registerStartListener(a.fn,a.params);this.registerEndListener(b.fn,b.params);this.registerRouteListener(routeListener.fn,routeListener.params);},setStrategy:function(a){this.strategy=a;},setStartCity:function(a){var b=this.map.placeListObj.getCityCodeByName(a);if(b){this.acodeS=b;}},setEndCity:function(a){var b=this.map.placeListObj.getCityCodeByName(a);if(b){this.acodeE=b;}},getStart:function(b,a,d){(this.map)?(this.poiObjS.map=this.map):(this.poiObjS.map=API.map);if(a){this.setStartCity(a);}else{this.acodeS=DEFAULT_CITY_CODE;}var c=this.poiObjS.search(b,this.acodeS,d);return c;},nextStart:function(){var a=this.poiObjS.next();return a;},lastStart:function(){var a=this.poiObjS.last();return a;},firstStart:function(){var a=this.poiObjS.first();return a;},previousStart:function(){var a=this.poiObjS.previous();return a;},getEnd:function(b,a,d){(this.map)?(this.poiObjE.map=this.map):(this.poiObjE.map=API.map);if(a){this.setEndCity(a);}else{this.acodeE=DEFAULT_CITY_CODE;}var c=this.poiObjE.search(b,this.acodeE,d);return c;},nextEnd:function(){var a=this.poiObjE.next();return a;},lastEnd:function(){var a=this.poiObjE.last();return a;},firstEnd:function(){var a=this.poiObjE.first();return a;},previousEnd:function(){var a=this.poiObjE.previous();return a;},search:function(i,a,f,d,e,g,c){e?this.strategy=e:this.strategy=0;var h;var b={slonlat:i,sname:a,elonlat:f,byway:[],ename:d,strategy:this.strategy,needseg:c,realtime:(g===true?g:false),loop:1};this.trip={slonlat:i,sname:a,elonlat:f,byway:[],ename:d,strategy:this.strategy,needseg:c,realtime:(g===true?g:false),loop:1};h=this.__getRemote(b);return h;},searchByWay:function(j,a,f,d,g,e,h,c){if(this.dragControl&&(this.dragControl.__byWay)){this.dragControl.__byWay=[];}e?this.strategy=e:this.strategy=0;var i;var b={byway:g,slonlat:j,sname:a,elonlat:f,ename:d,strategy:this.strategy,needseg:c,realtime:(h===true?h:false),loop:1};this.trip={byway:g,slonlat:j,sname:a,elonlat:f,ename:d,strategy:this.strategy,needseg:c,realtime:(h===true?h:false),loop:1};i=this.__getRemote(b);return i;},__addGeometrys:function(j,s,u,r,e){this.map=API.map;if(this.isclear){this.clear();}s=new LonLat(s.lon,s.lat);r=new LonLat(r.lon,r.lat);var m=CNavUtil._toMerc(s);var k=CNavUtil._toMerc(r);var d=this.GeoJSONFormater.read(j);if(this.SEAdded){d[0].geometry.addPoint(new OpenLayers.Geometry.Point(m.lon,m.lat),0);d[d.length-1].geometry.addPoint(new OpenLayers.Geometry.Point(k.lon,k.lat));}this.routeName=[];if(this.routeAdded){for(var l=0;l<d.length;l++){if(d[l].geometry.CLASS_NAME=="OpenLayers.Geometry.LineString"){d[l].style=this.style;var v=d[l].attributes.name;if(v&&(OpenLayers.Util.indexOf(this.routeName,v)==-1)){this.routeName.push(v);}this.layer.addFeatures([d[l]]);this.__features[l]=d[l];}}}else{this.__features[l]=[];}if(this.markerAdded){if(this.dragControl){var b=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(m.lon,m.lat));var p=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(k.lon,k.lat));this.__markers=[b,p];this.styleMaps.externalGraphic=this.sIcon.url;var n=this.sIcon.size;this.styleMaps.graphicWidth=n.w;this.styleMaps.graphicHeight=n.h;this.styleMaps.graphicXOffset=-n.w/2;this.styleMaps.graphicYOffset=-n.h;b.style=this.styleMaps;b.__flag="from";this.styleMape.externalGraphic=this.eIcon.url;n=this.eIcon.size;this.styleMape.graphicWidth=n.w;this.styleMape.graphicHeight=n.h;this.styleMape.graphicXOffset=-n.w/2;this.styleMape.graphicYOffset=-n.h;p.style=this.styleMape;p.__flag="to";this.layer.addFeatures([b,p]);}else{var h=new CNavTextMarker(s.clone(),this.sIcon.clone(),u);var c=new CNavTextMarker(r.clone(),this.eIcon.clone(),e);this.__markers=[h,c];this.map.addMarkerArray(this.__markers);}}else{this.__markers=[];}if(this.dragControl){this.dragControl.addByWay();this.dragControl.clearPoint();}if(this.panZoomMap){if(this.trip.__noPanZoom){this.trip.__noPanZoom=null;this.trip.edited=false;return;}var l=this.dragControl?(this.dragControl.__byWay?true:false):false;var q=false;if(l){q=this.dragControl?(this.dragControl.__byWay.length<1?true:false):false;}if((!l)||q||this.trip.edited){var g=new Bounds();for(var o=0;o<this.__features.length;o++){var a=this.__features[o].geometry.getBounds();g.extend(a);}this.map.zoomToExtent(g);this.trip.edited=false;}}},__getRemote:function(h){var a=OpenLayers.Function.bind(this.__callback,this,h);var b=OpenLayers.Function.bind(this.__callback,this,h);var g=CNavUtil.__ajaxRemote;var e="()";if(h.byway){var d=[];for(var c=0;c<h.byway.length;c++){var f=h.byway[c];d.push(f.lon+" "+f.lat);}e="("+d.join(",")+")";}if(this.dragControl&&this.dragControl.active){this.__controlActive=true;this.dragControl.deactivate();}g.loadUrl(SERVER_URL+"query.do",{serviceType:"drivemultipleService",mp:e,type:h.strategy,spx:h.slonlat.lon,spy:h.slonlat.lat,epx:h.elonlat.lon,epy:h.elonlat.lat,realtime:h.realtime,shpflag:1,IP:null},this,a,b);return true;},checkDrag:function(j){var d=j.__feature;var a=j.__oldLonLat;if(d&&a){oldLonLat1=CNavUtil._toMerc(j.__oldLonLat);d.layer=this.layer;d.move(oldLonLat1);if(d.__flag.indexOf("from")!=-1){j.slonlat=a;}else{if(d.__flag.indexOf("to")!=-1){j.elonlat=a;}else{for(var c=0;c<j.byway.length;c++){var h=j.byway[c];if(d.__lonlat.equals(h)){j.byway[c]=a;d.__lonlat=a;}}}}j.__feature=null;j.__oldLonLat=null;if(this.dragControl){this.layer.removeFeatures([this.dragControl.marker]);}}else{if(this.dragControl){if(this.dragControl.marker){this.layer.removeFeatures([this.dragControl.marker]);}if(d){OpenLayers.Util.removeItem(this.trip.byway,d.__lonlat);OpenLayers.Util.removeItem(this.dragControl.__byWay,d);}else{if(this.trip.__insertOption){var b=OpenLayers.Util.removeItem(this.trip.byway,this.trip.__insertOption.lonlat);this.trip.__feature=null;}}if(this.trip.__delOption){this.trip.byway.splice(this.trip.__delOption.index,0,this.trip.__delOption.lonlat);var g=CNavUtil._toMerc(this.trip.__delOption.lonlat);var e=this.dragControl.mapFeature(this.trip.__delOption.lonlat,g);this.trip.byway.splice(this.trip.__delOption.index2,0,e);this.layer.addFeatures([e]);this.trip.__delOption=null;}}}},__callback:function(a,d){if(this.dragControl&&this.__controlActive){this.__controlActive=false;this.dragControl.activate();}if(d){var m=d;var h=this.__buildList(m);if(!h){if(a.loop<2){a.loop++;this.__getRemote(a);}else{this.checkDrag(a);this.resultListener(null);}}else{if(this.cacheResponse){this.cache.trip=a;this.cache.resp=d;}if(this.markerAdded||this.routeAdded){if(this.dragControl){if(this.dragControl.__byWay){var c=this.dragControl.__byWay;for(var e=0;e<c.length;e++){var j=c[e];if(j.__popup){this.map.removePopup(j.__popup);}}}if((this.dragControl.__byWay&&this.dragControl.__byWay.length<1)||this.trip.edited!="undefined"){this.layer.removeFeatures(this.dragControl.__byWay);this.dragControl.__byWay=[];if(a.byway.length>0){for(var k=0;k<a.byway.length;k++){var g=a.byway[k];var l=CNavUtil._toMerc(g);this.dragControl.__byWay.push(this.dragControl.mapFeature(g,l));}this.trip.edited=true;}}}this.__addGeometrys(m,a.slonlat,a.sname,a.elonlat,a.ename);}var b={slonlat:a.slonlat,sname:a.sname,elonlat:a.elonlat,ename:a.ename,strategy:a.strategy,desc:m.description};if(a.needseg){this.resultListener(m);}else{this.resultListener(b);}}}else{if(a.loop<2){a.loop++;this.__getRemote(a);}else{this.checkDrag(a);this.resultListener(null);}}},__failure:function(a,c){if(a.loop<2){a.loop++;this.__getRemote(a);}else{var b=CNavUtil._buildRouteList(null,true);this.checkDrag(a);this.resultListener(b);}},__buildList:function(b){var a=CNavUtil._buildRouteList(b);return a;},clear:function(){if(this.__markers&&this.__markers.length>0){if(this.dragControl){for(var a=0;a<this.__markers.length;a++){var c=this.__markers[a];if(c&&c.geometry){this.layer.removeFeatures([c]);}}}else{this.map.clearMarker(this.__markers);}this.__markers=[];}if(this.__features){this.layer.removeFeatures(this.__features);this.__features=[];}if(this.dragControl&&this.dragControl.__features){this.layer.removeFeatures(this.dragControl.__features);this.dragControl.__features=null;}if(this.dragControl&&(this.dragControl.__byWay)){var b=this.dragControl.__byWay;for(var a=0;a<b.length;a++){var c=b[a];if(c.__popup){this.map.removePopup(c.__popup);}}this.layer.removeFeatures(this.dragControl.__byWay);if(!this.trip.__feature){if(!this.trip.edited){this.dragControl.__byWay=[];}else{}}}},CLASS_NAME:"CNavSearchRoute"});CNavSearchBusTransfer=OpenLayers.Class(CNavSearchRoute,{acode:DEFAULT_CITY_CODE,name:null,transfers:[],tsIcon:CNavMarker.iconFrom(),tmIcon:CNavMarker.iconTransfer(),teIcon:CNavMarker.iconTo(),sIcon:CNavMarker.iconStart(),eIcon:CNavMarker.iconEnd(),initialize:function(a){OpenLayers.Util.extend(this,a);if(this.style){this.style=this.style.getStyle();}this.poiObjS=new CNavSearchPOI();this.poiObjE=new CNavSearchPOI();this.GeoJSONFormater=new OpenLayers.Format.GeoJSON({internalProjection:CNavUtil.EPSG900913,externalProjection:CNavUtil.EPSG4326});if(this.startListener){this.registerStartListener(this.startListener);}if(this.endListener){this.registerEndListener(this.endListener);}if(!this.map){this.map=API.map;}this.layer=this.map.dynamicMarkerLayer;},setCity:function(a){var b=this.map.placeListObj.getCityCodeByName(a);if(b){this.acode=b;this.name=a;}},getStart:function(c,b,d){(this.map)?(this.poiObjS.map=this.map):(this.poiObjS.map=API.map);if(b){this.setCity(b);}else{this.acode=DEFAULT_CITY_CODE;}var a=this.poiObjS.search(c,this.acode,d);return a;},getEnd:function(c,b,d){(this.map)?(this.poiObjE.map=this.map):(this.poiObjE.map=API.map);if(b){this.setCity(b);}else{this.acode=DEFAULT_CITY_CODE;}var a=this.poiObjE.search(c,this.acode,d);return a;},registerTransferListener:function(b,c){var a=[b,this,c];this.poiObjS.register.apply(this,a);},register:function(a,b,c){this.registerStartListener(a.fn,a.params);this.registerEndListener(b.fn,b.params);this.registerTransferListener(c.fn,c.params);},getTime:function(){if(this.time){var d=this.time;this.time=null;return d;}var b=new Date();var c=b.getHours();var a=b.getMinutes();if(c<10){c="0"+c;}if(a<10){c="0"+a;}return c+":"+a;},setTime:function(a){this.time=a;},__getRemote:function(d){this.acode?this.acode=this.acode:this.acode=DEFAULT_CITY_CODE;var a=OpenLayers.Function.bind(this.__callback,this,d);var b=OpenLayers.Function.bind(this.__callback,this,d);var c=CNavUtil.__ajaxRemote;if(!d.time){d.time=this.getTime();}c.loadUrl(SERVER_URL+"query.do",{serviceType:"busTransService",strategy:d.strategy,time:d.time,acode:this.acode,spx:d.slonlat.lon,spy:d.slonlat.lat,epx:d.elonlat.lon,epy:d.elonlat.lat,eName:d.ename,sName:d.sname,IP:null},this,a,b);return true;},__callback:function(c,d){if(d){var b=d;var a=this.__buildList(b,c.slonlat,c.sname,c.elonlat,c.ename);if(!a){if(c.loop<2){c.loop++;this.__getRemote(c);}else{this.resultListener(null);}}else{if(this.cacheResponse){this.cache.trip=c;this.cache.resp=d;}this.__selectTransfer=OpenLayers.Function.bind(this.__select,this,c.slonlat,c.sname,c.elonlat,c.ename);if(this.markerAdded||this.routeAdded){this.display(0);}this.resultListener(a);}}else{if(c.loop<2){c.loop++;this.__getRemote(c);}else{this.resultListener(null);}}},display:function(a){this.__selectTransfer(a);},__buildList:function(k,j,a,e,c){var d=CNavUtil._buildRouteList(k);if(!d){return null;}var b=this.GeoJSONFormater.read(d);this.transfers=[];var f=[];var h={sLonLat:j,sName:a,eLonLat:e,eName:c};for(var g=0;g<b.length;g++){this.transfers[g]=b[g];f[g]={distance:b[g].attributes.distsum,count:b[g].attributes.linesum-1,buslst:k.features[g].properties.buslst,sbuslst:b[g].attributes.sbuslst,dbuslst:b[g].attributes.dbuslst,swdist:b[g].attributes.swdist,ewdist:b[g].attributes.ewdist,stopcnts:b[g].attributes.stopcnts,desc:b[g].attributes.des};OpenLayers.Util.extend(f[g],h);this.__getLonLatInfo(g,f[g]);}return f;},__getLonLatInfo:function(g,f){var a=this.transfers[g];f.sbusLonLatlst=[];f.dbusLonLatlst=[];var c=a.geometry.components;for(var b=0;b<c.length;b++){if(c[b].CLASS_NAME=="OpenLayers.Geometry.Point"){var e=c[b];var d=CNavUtil._toWGS84(new LonLat(e.x,e.y));if(b==1){f.sbusLonLatlst.push(d);}if(b==c.length-1){f.dbusLonLatlst.push(d);}if((b>1)&&(b%2!==0)){f.sbusLonLatlst.push(d);}if((b>1)&&(b!==c.length-1)&&(b%2===0)){f.dbusLonLatlst.push(d);}}}return f;},__selectTransfer:function(){},__select:function(b,a,d,c,e){this.clear();this.__features=[];this.__markers=[];this.__markers.push(new CNavTextMarker(b,this.sIcon.clone(),a,{bshow:false}));this.__markers.push(new CNavTextMarker(d,this.eIcon.clone(),c,{bshow:false}));this.__selectFeature(e);},__selectFeature:function(c){var e=this.transfers[c];var k=e.geometry.components;var h=null;for(var m=0;m<k.length;m++){if(k[m].CLASS_NAME=="OpenLayers.Geometry.Point"){var d=k[m];var j=CNavUtil._toWGS84(new LonLat(d.x,d.y));var l=e.attributes.sbuslst;var b;if(m==1){b=l[0];h=new CNavTextMarker(j,this.tsIcon.clone(),b);this.__markers.push(h);}if(m==k.length-1){l=e.attributes.dbuslst;b=l[l.length-1];h=new CNavTextMarker(j,this.teIcon.clone(),b);this.__markers.push(h);}if((m>1)&&(m%2!==0)){b=l[(m+1)/2-1];h=new CNavTextMarker(j,this.tmIcon.clone(),b);this.__markers.push(h);}}}if(this.markerAdded){this.map.addMarkerArray(this.__markers);}else{this.__markers=[];}if(this.routeAdded){var o=new OpenLayers.Feature.Vector(k[0]);this.layer.addFeatures([o]);this.__features.push(o);}else{this.__features=[];}if(this.panZoomMap){var a=new Bounds();var g;for(g=0;g<this.__features.length;g++){var f=this.__features[g].geometry.getBounds();a.extend(f);}var n=new Bounds();for(g=0;g<this.__markers.length;g++){var j=new OpenLayers.LonLat(this.__markers[g].lonlat.lon,this.__markers[g].lonlat.lat);n.extend(j);}a.extend(n);this.map.zoomToExtent(a);}},clear:function(){if(this.__markers&&this.__markers.length>0){this.map.clearMarker(this.__markers);}if(this.__features){this.layer.removeFeatures(this.__features);}},CLASS_NAME:"CNavSearchBusTransfer"});CNavSearchBusStop=OpenLayers.Class({acode:window.DEFAULT_CITY_CODE,name:null,resultListener:null,map:null,__markers:[],panZoomMap:true,isClear:true,markerAdded:true,icon:CNavMarker.defaultIcon(),cacheResponse:true,cache:{},initialize:function(a){CNavSearchPOI.prototype.initialize.apply(this,arguments);if(!this.acode){this.acode=DEFAULT_CITY_CODE;}},setCity:function(a){var b=this.map.placeListObj.getCityCodeByName(a);if(b){this.acode=b;this.name=a;}},register:function(a,b){if(!a){alert("Function not pass.");return;}CNavSearchPOI.prototype.register.apply(this,[a,this,b]);},search:function(b,a){if(!b){return;}if(a){this.setCity(a);}else{this.acode=DEFAULT_CITY_CODE;}var c;var d={key:b,name:a,loop:1};c=this.__getRemote(d);return c;},__getRemote:function(b){var a=OpenLayers.Function.bind(this.__callback,this,b);var c=OpenLayers.Function.bind(this.__failure,this,b);var d=CNavUtil.__ajaxRemote;d.loadUrl(SERVER_URL+"query.do",{serviceType:"busStopService",name:b.key,acode:this.acode},this,a,c);},__addMarkers:function(f){if(!f||f.length<1){return;}this.map=API.map;if(this.isClear){this.map.clearMarker(this.__markers);this.__markers=[];}for(var c=0;c<f.length;c++){var b=f[c];var g="";for(var a=0;a<b.tracks.length-1;a++){g+=b.tracks[a].bname+",";}g+=b.tracks[b.tracks.length-1].bname;var h="<div id='stops'><b>"+b.sname+"</b><div id='tracks'>"+g+"</div></div>";var d=new CNavMarker(b.lonlat,this.icon.clone(),{id:"stop_"+b.sid});d.addPopup(new CNavPopup("marker"+c,b.lonlat,h,true,null),false);this.__markers.push(d);}this.map.addMarkerArray(this.__markers);if(this.panZoomMap){var k=new Bounds();for(c=0;c<this.__markers.length;c++){var e=new OpenLayers.LonLat(this.__markers[c].lonlat.lon,this.__markers[c].lonlat.lat);k.extend(e);}this.map.zoomToExtent(k);}},__callback:function(b,c){if(c){var a=this.__buildList(c);if(a){if(this.cacheResponse){this.cache.trip=b;this.cache.resp=c;}if(this.markerAdded){this.__addMarkers(a);}this.resultListener(a);}else{if(b.loop<2){b.loop++;this.__getRemote(b);}else{this.resultListener(null);}}}else{if(b.loop<2){b.loop++;this.__getRemote(b);}else{this.resultListener(null);}}},__failure:function(a,b){if(a.loop<2){a.loop++;this.__getRemote(a);}else{this.resultListener(null);}},__buildList:function(d){var m=[];if(d.ExceptionMessage){return null;}for(var g=0;g<d.features.length;g++){var h=d.features[g];var l=h.geometry.coordinates;var b=h.properties;var a=b.sname;var k=[];for(var e=0;e<b.bidList.length;e++){k.push({bid:b.bidList[e],bname:b.bnameList[e]});}m.push({sid:b.sid,lonlat:new LonLat(l[0],l[1]),sname:a,tracks:k});}return m;},clear:function(){if(this.__markers&&this.__markers.length>0){this.map.clearMarker(this.__markers);}},panZoomToID:function(c,g,a,d){var b=null;if((typeof c!="undefined")&&(b=this.map.getMarkerById("stop_"+c))){if(g){this.map.zoomToLonLat(CNavUtil._toWGS84(b.lonlat),g);}else{this.map.panToLonLat(CNavUtil._toWGS84(b.lonlat));}if(b.popups.length>0&&a===true){if(d){for(var e=0;e<this.map.popups.length;e++){this.map.popups[e].hide();}}if(b.__popupAdded){for(var f=0;f<b.popups.length;f++){b.popups[f].toggle();}}else{b.fireEvent("click");}}}if(b){this.map.bringMarkerTop(b);}},getMarkerById:function(b){if(typeof pid==="undefined"){return null;}var a=this.map.getMarkerById("stop_id_"+pid);if(a){return a;}else{return null;}},CLASS_NAME:"CNavSearchBusStop"});CNavSearchStopAround=OpenLayers.Class(CNavSearchBusStop,{__poiObj:null,POIListener:null,cacheResponse:true,cache:{},initialize:function(a){CNavSearchBusStop.prototype.initialize.apply(this,arguments);this.poiObj=new CNavSearchPOI();if(this.POIListener){this.registerPOIListener(this.POIListener);}},registerPOIListener:function(a,b){this.poiObj.register(a,this,b);},registerResultListener:function(a,b){this.poiObj.register.apply(this,[a,this,b]);},register:function(a,b){if(a){this.registerPOIListener(a.fn,a.params);}if(b){this.registerResultListener(b.fn,b.params);}},getCenter:function(b,a,d){(this.map)?(this.poiObj.map=this.map):(this.poiObj.map=API.map);if(a){this.setCity(a);}else{this.acode=DEFAULT_CITY_CODE;}var c=this.poiObj.search(b,this.acode,d);return c;},nextCenter:function(){var a=this.poiObj.next();return a;},lastCenter:function(){var a=this.poiObj.last();return a;},firstCenter:function(){var a=this.poiObj.first();return a;},previousCenter:function(){var a=this.poiObj.previous();return a;},search:function(d,a,b){if(!d){return;}if(b){this.setCity(b);}else{this.acode=DEFAULT_CITY_CODE;}var c;a=a?a:800;var e={lonlat:d,name:b,radius:a,loop:1};c=this.__getRemote(e);return c;},__getRemote:function(b){var a=OpenLayers.Function.bind(this.__callback,this,b);var c=OpenLayers.Function.bind(this.__failure,this,b);var d=CNavUtil.__ajaxRemote;d.loadUrl(SERVER_URL+"query.do",{serviceType:"stopAroudService",cx:b.lonlat[0],cy:b.lonlat[1],radius:b.radius,acode:this.acode},this,a,c);},CLASS_NAME:"CNavSearchStopAround"});CNavSearchRoadCondition=OpenLayers.Class({acode:DEFAULT_CITY_CODE,name:null,listenerFirst:null,listenerSecond:null,map:API.map,__markers:[],pagesize:10,initialize:function(a){OpenLayers.Util.extend(this,a);if(!this.map){this.map=API.map;}if(!this.acode){this.acode=DEFAULT_CITY_CODE;this.name=DEFAULT_CITY_NAME;}},setCity:function(a){var b=this.map.placeListObj.getCityCodeByName(a);if(b){this.acode=b;this.name=a;}},registerListenerFirst:function(c,d){var b=d;var a=this;this.listenerFirst=function(){var e=Array.prototype.slice.apply(arguments,[0]);var f=e.concat(b);return c.apply(a,f);};},registerListenerSecond:function(c,d){var b=d;var a=this;this.listenerSecond=function(){var e=Array.prototype.slice.apply(arguments,[0]);var f=e.concat(b);return c.apply(a,f);};},register:function(b,a){this.registerListenerFirst(b.fn,b.params);this.registerListenerSecond(a.fn,a.params);},searchFirst:function(b,a,c){this.searchRoadsByKey(b,a,c?c:this.listenerFirst);},__searchRoads:function(c){var d=OpenLayers.Function.bind(this._callback,this,c);var a=OpenLayers.Function.bind(this._failure,this,c);var b=CNavUtil.__ajaxRemote;b.loadUrl(c.url,c.params,this,d,a);},searchRoadsByLonlat:function(f,d,a,b,e,g){if(e){this.setCity(e);}else{this.acode=DEFAULT_CITY_CODE;}var c=null;if(!c){c={loop:1,callback:g,url:SERVER_URL+"traquery.do",params:{lon_x:f,lat_y:d,acode:this.acode,roadName:a,radius:b,serviceType:"jamListRadiusService"}};}this.__searchRoads(c);},searchRoadsByKey:function(a,c,d){if(!a){return null;}if(c){this.setCity(c);}else{this.acode=DEFAULT_CITY_CODE;}var b=null;if(!b){b={loop:1,callback:d,url:SERVER_URL+"traquery.do",params:{serviceType:"jamListService",acode:this.acode,roadName:a,pagesize:this.pagesize}};}this.__searchRoads(b);},searchMapedRoadsByKey:function(a,c,d){if(!a){return null;}if(c){this.setCity(c);}else{this.acode=DEFAULT_CITY_CODE;}var b=null;if(!b){b={loop:1,filter:this.__mapedRoadsFilter,callback:d,url:SERVER_URL+"traquery.do",params:{serviceType:"roadNameWithMapService",acode:this.acode,roadName:a}};}this.__searchResult(b);},__mapedRoadsFilter:function(c){if(c.ExceptionMessage){return null;}var a={};var d=c.txtInfo;var b=d.split(",");a.result=c.result;a.matchedType=b[0];b.shift();a.roads=b;return a;},searchUnMapedRoadsByArray:function(a,c,d){if(!a){return null;}if(c){this.setCity(c);}else{this.acode=DEFAULT_CITY_CODE;}var b=null;if(!b){b={loop:1,filter:this.__unMapedRoadsFilter,callback:d,url:SERVER_URL+"traquery.do",params:{serviceType:"nonExisRoadNameWithMapService",acode:this.acode,roadNames:a}};}this.__searchResult(b);},__unMapedRoadsFilter:function(c){if(c.ExceptionMessage){return null;}if(c.result==="0"){return null;}var a={};var d=c.txtInfo;var b=d.split(",");a=b;return a;},searchENRoadNamesByArray:function(a,c,d){if(!a){return null;}if(c){this.setCity(c);}else{this.acode=DEFAULT_CITY_CODE;}var b=null;if(!b){b={loop:1,filter:this.__unMapedRoadsFilter,callback:d,url:SERVER_URL+"traquery.do",params:{serviceType:"roadNamesCNToENService",acode:this.acode,roadNames:a}};}this.__searchResult(b);},searchRoadNamesByRTInfo:function(a,b,d,e){if(!a){return null;}if(b){this.acode=b;}else{this.acode=DEFAULT_CITY_CODE;}var c=null;if(!c){c={loop:1,callback:e,url:SERVER_URL+"traquery.do",params:{serviceType:"roadNamesByRTInfoService",acode:this.acode,roadName:a,lang:d}};}this.__searchResult(c);},searchEndsByStartDir:function(a,d,f,b,e){if(!a){return null;}if(d){this.setCity(d);}else{this.acode=DEFAULT_CITY_CODE;}var c=null;if(!c){c={loop:1,callback:e,url:SERVER_URL+"traquery.do",params:{serviceType:"jamEndByStartService",acode:this.acode,roadName:a,dirName:b,startName:f}};}this.__searchRoads(c);},_callback:function(b,c){if(c){var a=this._buildList(c,b);if(a){b.callback.apply(this,[a]);}else{if(b.loop<2){b.loop++;this.__searchRoads(b);}else{b.callback.apply(this,[null]);}}}},_failure:function(a,b){if(a.loop<2){a.loop++;this.__searchRoads(a);}else{a.callback.apply(this,[null]);}},_buildList:function(f,e){var a=f.roads;if(a){var b=[];for(var d=0;d<a.length;d++){var c=a[d];b.push(c.road);}return b;}return null;},__searchResult:function(d){var c=CNavUtil.__ajaxRemote;var e=OpenLayers.Function.bind(this._callback1,this,d);var a=OpenLayers.Function.bind(this._failure1,this,d);var b="traquery.do";if(d.params.needEvt){b="EventAndJamServlet";}c.loadUrl(SERVER_URL+b,d.params,this,e,a);},searchSecond:function(b,a){this.searchSigleRoadTraffic(b,a,true,false,this.listenerSecond);},searchSigleRoadTraffic:function(a,f,c,e,g){if(f){this.setCity(f);}else{this.acode=DEFAULT_CITY_CODE;}var b=c?"jamService":"jamSingleRoadByNameService";var d={loop:1,callback:g,params:{serviceType:b,needEvt:e,roadName:a,full:c,acode:this.acode}};this.__searchResult(d);},searchMulticRoadsTraffic:function(b,a,e,d,f){if(e){this.setCity(e);}else{this.acode=DEFAULT_CITY_CODE;}var c={loop:1,callback:f,params:{serviceType:"jamMulticRoadByNamesService",needEvt:d,roadName:b.toString(),full:a,acode:this.acode}};this.__searchResult(c);},searchStartEndTraffic:function(d,c,b,e,g,h,f,i){if(f){this.setCity(f);}else{this.acode=DEFAULT_CITY_CODE;}var a={loop:1,callback:i,params:{serviceType:"jamByStartEndService",needEvt:h,roadName:d,dirName:c,startName:b,endName:e,full:g,acode:this.acode}};this.__searchResult(a);},searchSingleRoadDirTraffic:function(a,b,c,f,e,g){if(f){this.setCity(f);}else{this.acode=DEFAULT_CITY_CODE;}var d={loop:1,callback:g,params:{serviceType:"jamSingleRoadDirService",needEvt:e,roadName:a,dirName:b,full:c,acode:this.acode}};this.__searchResult(d);},searchRoadCoordinateByDirAndStart:function(a,e,g,b,c,f){if(!a){return null;}if(e){this.setCity(e);}else{this.acode=DEFAULT_CITY_CODE;}var d=null;if(!d){d={loop:1,filter:this.__roadCoordinateByDirAndStartFilter,callback:f,url:SERVER_URL+"traquery.do",params:{serviceType:"roadConditionsService",acode:this.acode,roadName:a,dirName:c,endName:b,startName:g}};}this.__searchResult(d);},__roadCoordinateByDirAndStartFilter:function(b){if(b.result==="1"){return null;}var a=[];a=b.coordinate;return a;},_callback1:function(b,c){if(c){var a=this._buildList1(c,b);if(b.filter){a=b.filter(a);}if(a){b.callback.apply(this,[a]);}else{if(b.loop<2){b.loop++;this.__searchResult(b);}else{b.callback.apply(this,[null]);}}}},_failure1:function(a,b){if(a.loop<2){a.loop++;this.__searchResult(a);}else{a.callback.apply(this,[null]);}},_buildList1:function(b,a){return b;},_retrieve:function(d,c,f,b){if(!d|!f){return null;}if(c){this.setCity(c);}var g=b?b:null;if(!g){g={loop:1,params:{type:d,name:c,listener:f}};}var h=OpenLayers.Function.bind(this._callback2,this,g);var a=OpenLayers.Function.bind(this._failure2,this,g);var e=CNavUtil.__ajaxRemote;e.loadUrl(SERVER_URL+"HotQueryServlet",{serviceType:d,acode:this.acode,r:Math.random()},this,h,a);},_callback2:function(b,c){if(c){var a=this._buildList2(c,b);if(a){b.params.listener.apply(this,[a]);}else{if(b.loop<2){b.loop++;this._retrieve(b.params["type"],b.params["name"],b.params["listener"],b);}else{b.params.listener.apply(this,[null]);}}}},_failure2:function(a,b){if(a.loop<2){a.loop++;this._retrieve(a.params["type"],a.params["name"],a.params["listener"],a);}else{a.params.listener.apply(this,[null]);}},_buildList2:function(b,a){if(b.cnt){return b;}return null;},getHotRoads:function(b,a){this._retrieve("hotLinkService",a,b);},getHotAreas:function(b,a){this._retrieve("hotAreaService",a,b);},addedFeatures:null,addedLine:null,panZoomToStartEnd:function(a,l,b,n,j,i,c){var m=new LonLat(a,l);var k=new LonLat(n,j);if(this.__markers.length>0){this.map.clearMarker(this.__markers);this.__markers=[];}var p=new CNavTextMarker(m,CNavMarker.iconFrom(),b);var h=new CNavTextMarker(k,CNavMarker.iconTo(),i);this.map.addMarker(p);this.map.addMarker(h);this.__markers.push(p);this.__markers.push(h);if(c){this.addedLine=new CNavLine(c);this.addedFeatures=this.addedLine.addToMap(true);}var f=this.addedLine.getDataExtent();var e=this.map.getMarkerExtent(this.__markers);var d=!!window.ActiveXObject;var g=d&&!!document.documentMode;f.extend(e);this.map.zoomToExtent(f);if(g){var o=this.map.getZoom();this.map.zoomTo(o-1);this.map.zoomTo(o);}},clearLineOnMap:function(){this.addedLine.clear(this.addedFeatures);},CLASS_NAME:"CNavSearchRoadCondition"});CNavSearchEvents=OpenLayers.Class({map:null,acode:null,name:null,resultListener:null,__typeMarker:[],__typeData:[],__activeCount:0,__activeMap:[],timeID:null,markerAdded:true,isClear:true,bshow:false,sTypes:null,layerIsAlone:false,initialize:function(a){OpenLayers.Util.extend(this,a);if(!this.map){this.map=API.map;}if(!this.acode){this.acode=DEFAULT_CITY_CODE;this.name=DEFAULT_CITY_NAME;}if(this.layerIsAlone){this.layer=new OpenLayers.Layer.Markers("eventsMarkers");this.map.addLayer(this.layer);}},setCity:function(a){var b=this.map.placeListObj.getCityCodeByName(a);if(b){this.clearCache(b);this.acode=b;this.name=a;}},clearCache:function(){if(this.layerIsAlone){this.layer.clearMarkers();}else{for(var a in this.__typeMarker){var b=this.__typeMarker[a];this.map.clearMarker(b);}}this.__typeMarker=[];this.__typeData=[];},__search:function(b){if(!b){return null;}if(b.name){this.setCity(b.name);}else{this.acode=DEFAULT_CITY_CODE;}this.clearCache();var c=OpenLayers.Function.bind(this.__callback,this,b);var a=OpenLayers.Function.bind(this.__failure,this,b);b.param.acode=this.acode;this.__getRemote(b.url,b.param,c,a);},searchType:function(c,a,e,b){this.sTypes={type:this.searchType,option:[c,a,e,b]};if(!c){return null;}var d=null;if(!d){d={loop:1,type:c,name:a,callback:e,option:b,url:"",param:{}};}this.__search(d);},searchToday:function(a,d,b){this.sTypes={type:this.searchToday,option:[a,d,b]};var c=null;if(!c){c={loop:1,name:a,option:b?b:{},callback:d,url:SERVER_URL+"traquery.do",param:{serviceType:"eventListService",acode:this.acode}};}this.__search(c);},searchValid:function(a,d,b){this.sTypes={type:this.searchValid,option:[a,d,b]};var c=null;if(!c){c={loop:1,name:a,option:b,callback:d,url:SERVER_URL+"traquery.do",param:{serviceType:"eventAllListService",acode:this.acode}};}this.__search(c);},__getRemote:function(b,d,e,a){var c=CNavUtil.__ajaxRemote;c.loadUrl(b,d,this,e,a);},__callback:function(c,d){if(d){var a=this.__buildList(d,c);if(a){if(c.type){if(c.option&&c.option.makerAdded){this.__addMarker(b,data,c.option);}}else{data=[];for(var b in this.__typeData){this.__addMarker(b,this.__typeData[b],c.option);}}if(c.callback){c.callback.apply(this,[a]);}var e=this.getEventMarkersExtent();}else{if(c.loop<2){c.loop++;this.__search(c);}else{return null;}}}},__failure:function(a,b){if(a.loop<2){a.loop++;this.__search(a);}else{return null;}},__buildList:function(c){if(!c.result){return null;}var b=c.events;for(var a=0;a<b.length;a++){var d=b[a];if(!this.__typeData[d.type]){this.__typeData[d.type]=[];}this.__typeData[d.type].push(d);}return c;},__addMarker:function(c,a,b){b=(b?b:{});b.isClear=(b&&b.isClear?b.isClear:this.isClear);this.__addType(c,a,b);},__addType:function(k,h,g){var n=new Size(20,20);var a=new Pixel((-n.w/2),(-n.h));var e=(k==="限行")?"res.png":(k==="施工"?"work.png":(k==="事故"?"acc.png":"other.png"));var m=OpenLayers.Util.getImagesLocation()+e;var l=new Icon(m,n,a);for(var d=0;d<h.length;d++){var c=h[d];var j="<div style='font-size:13px'><font style='color:#009933'>"+c.name+"</font><br/>";j+=c.evtInfo?("描述："+c.evtInfo):"";j+="</div>";var f=new LonLat(c.lonlat[0],c.lonlat[1]);if(!f||!f.lon||!f.lat){continue;}var b=new CNavMarker(f,l.clone(),{id:"evt_id_"+c.id});b.addPopup(new CNavPopup("Event"+d,f,j,true,null),g.bshow?g.bshow:this.bshow);if(!this.__typeMarker[k]){this.__typeMarker[k]=[];}this.__typeMarker[k].push(b);if(this.layerIsAlone){this.layer.addMarker(b);}else{this.map.addMarker(b);}}},refresh:function(){this.sTypes.type.apply(this,this.sTypes.option);},activate:function(c,b){var a=this.__typeData[c];if(a&&a.length>0&&this.acode===DEFAULT_CITY_CODE){this.__addMarker(c,a,b);}else{}},deactivate:function(d){var b=this.__typeMarker[d];if(b&&b.length>0){if(!this.layerIsAlone){this.map.clearMarker(b);}else{while(b.length>0){var a=b[0];for(var c=0;c<a.popups.length;c++){a.removePopup(a.popups[c]);}OpenLayers.Util.removeItem(b,a);this.layer.removeMarker(a);}}this.__typeMarker[d]=[];}},panZoomToID:function(g,f,a,c){var b=null;if(g!="undefined"&&(b=this.map.getMarkerById("evt_id_"+g,this.layer))){if(f){this.map.zoomToLonLat(CNavUtil._toWGS84(b.lonlat),f);}else{this.map.panToLonLat(CNavUtil._toWGS84(b.lonlat));}if(b.popups.length>0&&a===true){if(c){for(var d=0;d<this.map.popups.length;d++){this.map.popups[d].hide();}}if(b.__popupAdded){for(var e=0;e<b.popups.length;e++){b.popups[e].toggle();}}else{b.fireEvent("click");}}}},getEventMarkersExtent:function(){var c=[];for(var b in this.__typeMarker){var a=this.__typeMarker[b];c=c.concat(a);}return this.map.getMarkerExtent(c);},CLASS_NAME:"CNavSearchEvents"});CNavSearchParking=OpenLayers.Class(CNavSearchPOI,{initialize:function(a){CNavSearchPOI.prototype.initialize.apply(this,arguments);},addMarkers:function(f){if(!f||f.length<1){return;}this.map=API.map;if(this.isClear){this.map.clearMarkers(this.__markers);this.__markers=[];}for(var d=0;d<f.length;d++){var c=f[d];var g="<div style='font-size:13px'>&nbsp;<font style='color:#009933'>"+c.name+"</font><br/>";g+=c.addr?("&nbsp;地址："+c.addr):"";g+=c.tel?("<br/>&nbsp;电话："+c.tel):"";g+=c.tel?("<br/>&nbsp;空置率："+c.freenum+"/"+c.count):"";g+="</div>";var l=new Size(33,27);var a=new Pixel((-l.w/2),(-l.h));var j=OpenLayers.Util.getImagesLocation()+"/list_"+(d+1)+"_1.png";var h=this.imgCallback?this.imgCallback(d):new Icon(j,l,a);var b=new CNavMarker(c.lonlat,h,{id:"Park_id_"+c.id});b.addPopup(new CNavTextPopup("marker"+d,c.lonlat,g,true,null),this.bshow);this.__markers.push(b);}this.map.addMarkerArray(this.__markers);if(this.panZoomMap){var k=new Bounds();for(d=0;d<this.__markers.length;d++){var e=new OpenLayers.LonLat(this.__markers[d].lonlat.lon,this.__markers[d].lonlat.lat);k.extend(e);}this.map.zoomToExtent(k);}},__getRemote:function(e){var d=e.page;if(d&&d>=1){if(this.totalPage){if(d<=this.totalPage){e.page=d;this.currentPage=d;}else{e.page=1;this.currentPage=1;}}else{e.page=1;this.currentPage=1;}}else{e.page=1;this.currentPage=1;}var a=OpenLayers.Function.bind(this.__callback,this,e);var b=OpenLayers.Function.bind(this.__failure,this,e);var c=CNavUtil.__ajaxRemote;c.loadUrl(SERVER_URL+"traquery.do",e.params?e.params:{serviceType:"parkService",acode:e.acode,pageIdx:e.page,roadName:e.key,pageSize:10,IP:null},this,a,b);},__buildPOIList:function(a,g){if(g){return null;}var b=a.parks;for(var d=0;d<b.length;d++){var e=b[d];var h=e.lonlat;b[d].lonlat=new OpenLayers.LonLat(h[0],h[1]);}return b;},setCity:function(a){var b=this.map.placeListObj.getCityCodeByName(a);if(b){this.acode=b;this.name=a;}},searchParksByLonLat:function(d,e,a,h,f,g,c,j,i){if(e){this.setCity(e);}else{this.acode=DEFAULT_CITY_CODE;}var b={loop:1,markable:i,params:{serviceType:"parkRadiusService",roadName:d,lon_x:a,lat_y:h,radius:f,pageidx:g,pagesize:c,acode:this.acode,r:Math.random()}};this.__getRemote(b);},panZoomToID:function(f,g,a,c){var b=null;if(f!="undefine"&&(b=this.map.getMarkerById("Park_id_"+f))){if(g){this.map.zoomToLonLat(CNavUtil._toWGS84(b.lonlat),g);}else{this.map.panToLonLat(CNavUtil._toWGS84(b.lonlat));}if(b.popups.length>0&&a===true){if(c){for(var d=0;d<this.map.popups.length;d++){this.map.popups[d].hide();}}if(b.__popupAdded){for(var e=0;e<b.popups.length;e++){b.popups[e].toggle();}}else{b.fireEvent("click");}}}if(b){this.map.bringMarkerTop(b);}},getMarkerById:function(b){if(typeof b==="undefined"){return null;}var a=this.map.getMarkerById("Park_id_"+b);if(a){return a;}else{return null;}},CLASS_NAME:"CNavSearchParking"});CNavSearchBox=OpenLayers.Class(CNavSearchPOI,{pageSize:10,bound:null,tcode:0,key:"",acode:null,panZoomMap:false,initialize:function(a){OpenLayers.Util.extend(this,a);if(!this.map){this.map=API.map;}},init:function(){this.currentPage=0;this.totalPage=null;this.tcode=0;this.bound=null;this.key="";},setBound:function(a){this.bound=a;},setTcode:function(a){this.tcode=a;},search:function(d,b,h,c,e,g){if(this.bound&&d&&!this.bound.equals(d)){this.init();this.bound=d;}else{this.bound=d;}this.key=b?b:"";this.tcode=h?h:0;this.acode=c;if(!this.acode){this.acode=DEFAULT_CITY_CODE;}var a;var f={cx1:d.left,cy1:d.bottom,cx2:d.right,cy2:d.top,key:this.key,tcode:this.tcode,acode:this.acode,page:e,pagesize:this.pageSize,markable:g,loop:1};this.__getRemote(f);return true;},searchAndMark:function(d,b,f,c,e){var a=this.search(d,b,f,c,e,true);return true;},__getRemote:function(e){var d=e.page;if(d&&d>=1){if(this.totalPage){if(d<=this.totalPage){e.page=d;this.currentPage=d;}else{e.page=1;this.currentPage=1;}}else{e.page=1;this.currentPage=1;}}else{e.page=1;this.currentPage=1;}var a=OpenLayers.Function.bind(this.__callback,this,e);var b=OpenLayers.Function.bind(this.__failure,this,e);var c=CNavUtil.__ajaxRemote;c.loadUrl(SERVER_URL+"query.do",{serviceType:"poirectangleService",cx1:e.cx1,cy1:e.cy1,cx2:e.cx2,cy2:e.cy2,tcode:this.tcode,acode:e.acode,page:e.page,pagesize:this.pageSize,retmode:1,name:e.key,IP:null},this,a,b);},next:function(b){var a=this.currentPage+1;if(a>this.totalPage){return null;}if(!b){return this.search(this.bound,this.key,this.tcode,this.acode,a);}else{return this.searchAndMark(this.bound,this.key,this.tcode,this.acode,a);}},nextAndMark:function(){var a=this.currentPage+1;if(a>this.totalPage){return null;}return this.searchAndMark(this.bound,this.key,this.tcode,this.acode,a);},previous:function(b){var a=this.currentPage-1;if(a<1){return null;}if(!b){return this.search(this.bound,this.key,this.tcode,this.acode,a);}else{return this.searchAndMark(this.bound,this.key,this.tcode,this.acode,a);}},previousAndMark:function(){var a=this.currentPage-1;if(a<1){return null;}return this.searchAndMark(this.bound,this.key,this.tcode,this.acode,a);},first:function(a){if(!a){return this.search(this.bound,this.key,this.tcode,this.acode,1);}else{return this.searchAndMark(this.bound,this.key,this.tcode,this.acode,1);}},firstAndMark:function(){return this.searchAndMark(this.bound,this.key,this.tcode,this.acode,1);},last:function(a){if(this.totalPage){if(!a){return this.search(this.bound,this.key,this.tcode,this.acode,this.totalPage);}else{return this.searchAndMark(this.bound,this.key,this.tcode,this.acode,this.totalPage);}}return false;},lastAndMark:function(){if(this.totalPage){return this.searchAndMark(this.bound,this.key,this.tcode,this.acode,this.totalPage);}return false;},toPage:function(b,a){if(b&&b<=this.totalPage){if(!a){return this.search(this.bound,this.key,this.tcode,this.acode,b);}else{return this.searchAndMark(this.bound,this.key,this.tcode,this.acode,b);}}return false;},CLASS_NAME:"CNavSearchBox"});CNavOviewMap=OpenLayers.Class(OpenLayers.Map,{initialize:function(e,b){this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.maxExtent=new OpenLayers.Bounds(-180,-90,180,90);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";OpenLayers.Util.extend(this,b);this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(e);OpenLayers.Element.addClass(this.div,"olMap");var d=this.div.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(d,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);d=this.div.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(d);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.viewPortDiv.appendChild(this.layerContainerDiv);this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES,this.fallThrough,{includeXY:true});this.layers=[];this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners);}this.events.register("movestart",this,this.updateSize);if(OpenLayers.String.contains(navigator.appName,"Microsoft")){this.events.register("resize",this,this.updateSize);}else{this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy);}if(this.controls==null){if(OpenLayers.Control!=null){this.controls=[new CNavNavigation(),new OpenLayers.Control.PanZoom(),new OpenLayers.Control.ArgParser(),new OpenLayers.Control.Attribution()];}else{this.controls=[];}}for(var c=0,a=this.controls.length;c<a;c++){this.addControlToMap(this.controls[c]);}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);},CLASS_NAME:"CNavOviewMap"});API.map=null;CNavMap=OpenLayers.Class(OpenLayers.Map,{dynamicVectorLayer:null,staticVectorLayer:null,dynamicMarkerLayer:null,staticMarkerLayer:null,placeListObj:null,markers:[],panZoomListener:null,regionalListener:null,positionListener:null,initCity:DEFAULT_CITY_NAME,maxZoom:MAX_ZOOM,minZoom:MIN_ZOOM,initZoom:(((MAX_ZOOM-MIN_ZOOM)>5)?(MAX_ZOOM-MIN_ZOOM-5):0),trafficLayer:null,showLogo:true,initialize:function(f,b){this._initURL();var d=b;if(!d){d={};}this.loading=new CNavCustomImg({flag:"animatation",img:OpenLayers.Util.getImagesLocation()+"animatation.gif"});OpenLayers.Util.extend(d,{controls:[new OpenLayers.Control.Navigation(),new OpenLayers.Control.ArgParser(),new OpenLayers.Control.Attribution()]});if(b&&b.regionalListener){if(b.regionalListener){OpenLayers.Util.extend(d,{eventListeners:{moveend:this.getCenterRegional}});}}this.EVENT_TYPES=this.EVENT_TYPES.concat("changecity");OpenLayers.Map.prototype.initialize.apply(this,[f,d]);this.theme=OpenLayers._getScriptLocation()+"theme/default/"+STYLE_CSS;this.projection=new OpenLayers.Projection("EPSG:900913");this.displayProjection=new OpenLayers.Projection("EPSG:4326");this.units="m";this.numZoomLevels=this.maxZoom-this.minZoom+1;this.maxResolution=19567.8792375*2*2*2;if(this.minZoom>=0){for(var c=0;c<this.minZoom;c++){this.maxResolution=(this.maxResolution/2);}}this.maxExtent=new OpenLayers.Bounds(-20037508,-20037508,20037508*2,20037508);this.restrictedExtent=new OpenLayers.Bounds(-20037508,-20037508,20037508*2,13358338.667);this.addLayer(new CNavTileCache("baseMap",TILE_PIV_URL,{isBaseLayer:true}));this.div.oncontextmenu=function(){return false;};this.placeListObj=new CNavPlaceList();this.placeListObj.map=this;if(this.initCity){var a=this.placeListObj.getCityLonLatByName(this.initCity);DEFAULT_CITY_CODE=this.placeListObj.getCityCodeByName(this.initCity);var e=CNavUtil._toMerc(a);this.setCenter(e,this.initZoom,false,true);}this._initLayer();API.map=this;this.addControl(this.loading);if(this.showLogo){this.addControl(new CNavCustomImg({flag:"logo",img:OpenLayers.Util.getImagesLocation()+"logo.gif"}));}},_initLayer:function(){var a=[this.trafficLayer=new CNavTrafficTileCache("trafficLayer",TRAFFIC_PIV_URL,{isBaseLayer:false,visibility:false,opacity:1}),this.dynamicVectorLayer=new OpenLayers.Layer.Vector("featureLayer"),this.dynamicMarkerLayer=new CNavDynamicMarkerLayer("dynamicMarkerLayer"),this.staticMarkerLayer=new CNavMarkersLayer("staticMarkersLayer")];this.addLayers(a);this.dynamicVectorLayer.style=CNavDefaultStyle.clone();},_initURL:function(){var a=new AjaxRemote(false);a.loadUrl(SERVER_URL+"queryCityURL.do",{serviceType:"cityURLService"},this,this._fnURL,this._failureURL);},_fnURL:function(b){CITY_URL=b.CITYURL;var a=CNavUtil.get_TRAFFIC_PIV_URL_ByCode("000000");if(a!=undefined){if(a==="0"){TRAFFIC_PIV_URL=CNavUtil.get_TRAFFIC_PIV_URL_ByCode(DEFAULT_CITY_CODE);HIS_TRAF_URL=CNavUtil.get_HIS_TRAF_URL_ByCode(DEFAULT_CITY_CODE);}else{TRAFFIC_PIV_URL=a;HIS_TRAF_URL=CNavUtil.get_HIS_TRAF_URL_ByCode("000000");}}if(this.trafficLayer){this.trafficLayer.refresh();}},_failureURL:function(a){},zoomToLonLat:function(c,b){if(this.regionalListener){this.getCenterRegional(null,null,c);}var d=CNavUtil._toMerc(c);this.setCenter(d,b,false,true);if(this.positionListener){this.getDescription(c,this.positionListener,500);}var e=navigator.appVersion.split("MSIE");var a=parseFloat(e[1]);if(a===6){setTimeout(OpenLayers.Function.bind(this._timeOut,this,b),10);}},_timeOut:function(j){var b=j?j:this.getZoom();b=b+this.minZoom;var c=this.baseLayer.div;var h=c.childNodes;this.baseLayer.setVisibility(false);for(var f=0;f<h.length;f++){var d=h[f];var g=d.firstChild;var a=g.src;var e=a.split("/");lev=e[e.length-1].split("-")[0];if(lev==b){if(d.style.display=="none"){d.style.display="block";}}else{d.style.display="none";}}this.baseLayer.setVisibility(true);},zoomToExtent:function(d){if(d.left==null||d.right==null||d.top==null||d.bottom==null){return;}var f=navigator.appVersion.split("MSIE");var b=parseFloat(f[1]);if(b==6){var c=this.getZoomForExtent(d);var a=d.getCenterLonLat();var e=CNavUtil._toWGS84(a);this.zoomToLonLat(e,c);}else{OpenLayers.Map.prototype.zoomToExtent.apply(this,arguments);var e=this.getCenterLonLat();if(this.regionalListener){this.getCenterRegional(null,null,e);}}},getCenterLonLat:function(){var a=this.getCenter();var b=CNavUtil._toWGS84(a);return b;},getZoom:function(){return OpenLayers.Map.prototype.getZoom.apply(this,arguments);},panToLonLat:function(a){this.zoomToLonLat(a);},setDefaultCodeAndZoom:function(c,b){DEFAULT_CITY_CODE=c;this.events.triggerEvent("changecity");var d=this.placeListObj.getCityLonLatByCode(c);if(b){this.zoomToLonLat(d,b);}else{this.panToLonLat(d);}var a=this.getControlsByClass("CNavViewPortControl");if(a&&a.active){a.change();}},getCurrentCode:function(){return DEFAULT_CITY_CODE;},getPlaceListObj:function(){return this.placeListObj;},__isGettingCenterRegional:false,getCenterRegional:function(c,f,g){var b=g?g:this.getCenter();var e=g?b:CNavUtil._toWGS84(b);f=f?f:{count:0};if(this.__isGettingCenterRegional){return;}else{this.__isGettingCenterRegional=true;}var h=OpenLayers.Function.bind(this._RegionalCallback,this,c,f,g);var a=OpenLayers.Function.bind(this._RegionalFailure,this,c,f,g);var d=new AjaxRemote(false);d.loadUrl(SERVER_URL+"query.do",{serviceType:"cityXyQueryService",x:e.lon,y:e.lat},this,h,a);},_RegionalCallback:function(c,f,b,g){this.__isGettingCenterRegional=false;if((!g)||(g.ExceptionMessage)){if(f.count<2){f.count++;return this.getCenterRegional(c,f,b);}return;}var a=g.cityXyQuery;var d={acode:a.acode,province:a.province,city:a.city?a.city:a.province,regional:a.county};var h;if(d.regional&&d.regional.indexOf("市")==-1&&d.regional.indexOf("州")==-1){h=this.placeListObj.getCityCodeByName(d.city);}else{if(a.city.length==0){h=this.placeListObj.getCityCodeByName(d.province);}else{h=this.placeListObj.getCityCodeByName(d.city);}}if(h&&(DEFAULT_CITY_CODE!=h)){DEFAULT_CITY_CODE=h;this.events.triggerEvent("changecity");var e=this.getControlsByClass("CNavViewPortControl");if(e&&e.active){e.change();}}if(this.regionalListener){this.regionalListener(d);}},_RegionalFailure:function(b,c,a){this.__isGettingCenterRegional=false;if(c.count<2){c.count++;return this.getCenterRegional(b,c,a);}},addMarker:function(a){var b=this.staticMarkerLayer;b.addMarker(a);},addMarkerArray:function(b){var a=this.staticMarkerLayer;a.addMarkerArray(b);},clearMarker:function(a){var c=this.staticMarkerLayer;if(a&&(typeof a==="object")&&(a.constructor!==Array)){c.removeMarker(a);}else{if(a.constructor===Array){for(var b=0;b<a.length;b++){this.clearMarker(a[b]);}}}},clearMarkers:function(){var a=this.staticMarkerLayer;if(a.markers){while(a.markers.length>0){this.clearMarker(a.markers[0]);}}},getMarkerExtent:function(c){var a=new OpenLayers.Bounds();if(!c){var f=this.staticMarkerLayer.getDataExtent();if(f){a.extend(f);}}else{for(var e=0;e<c.length;e++){var d=c[e];a.extend(d.lonlat);}}return a;},getMarkerById:function(c,b){if(!c){return null;}var b=b?b:this.staticMarkerLayer;for(var a=0;a<b.markers.length;a++){if(b.markers[a].id===c){return b.markers[a];}}return null;},__addPopup:function(a,d){if(d){for(var b=this.popups.length-1;b>=0;--b){this.removePopup(this.popups[b]);}}a.map=this;this.popups.push(a);var c=a.draw();if(c){c.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;}return c;},getLeftTopLonLat:function(){var a=this.calculateBounds();var b=new LonLat(a.left,a.top);return CNavUtil._toWGS84(b);},getRightBottomLonLat:function(){var a=this.calculateBounds();var b=new LonLat(a.right,a.bottom);return CNavUtil._toWGS84(b);},getOffsetLonLat:function(a,b,g){var f=new CNavSquare(a,g);var c=f.create();var d=c.getBounds();d.transform(CNavUtil.EPSG900913,CNavUtil.EPSG4326);var e;if(b==="S"){e=new LonLat(a.lon,d.bottom);}else{if(b==="N"){e=new LonLat(a.lon,d.top);}else{if(b==="E"){e=new LonLat(d.right,a.lat);}else{e=new LonLat(d.left,a.lat);}}}return e;},getDescription:function(d,h,a,e){var i=d;var f;a?(f=a):(f=3000);var c=e?e:0;var b={str:"",_fn:h?h:OpenLayers.Function.bind(this._markDesc,this,d)};_fn=OpenLayers.Function.bind(this._DesCallback,this,i,b,c,a);_failure=OpenLayers.Function.bind(this._DescFailure,this,i,b,c,a);var g=CNavUtil.__ajaxRemote;g.loadUrl(SERVER_URL+"query.do",{serviceType:"positionInfoService",cx:i.lon,cy:i.lat,acode:DEFAULT_CITY_CODE,radius:f},this,_fn,_failure);return true;},_DesCallback:function(b,a,e,d,g){if(!g&&e<2){this.getDescription(b,a._fn,d,e+1);return;}var f=g;if(!f.info){if(e<2){e++;this.getDescription(b,a._fn,d,e);return;}else{a.str=CNavUtil._buildDesc(f,true);return;a._fn(a.str);}}var c="";a.str=c+CNavUtil._buildDesc(f);a._fn(a.str);},_DescFailure:function(b,a,d,c){if(d<2){this.getDescription(b,a._fn,c,d+1);}else{a.str=CNavUtil._buildDesc(null,true);a._fn(a.str);}},_markDesc:function(b,c){var a=new CNavTextMarker(b,CNavMarker.defaultIcon(),c);this.addMarker(a);},createAlphaDivOnMap:function(b,i,h,f,e,d,c,g){var a=OpenLayers.Util.createDiv(b,i,h,f,e,d,c,g);a.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length+1;a.style.backgroundColor="#fff";this.viewPortDiv.appendChild(a);return a;},startClickListener:function(f,e,b,a){if(!this.CNavDynamicMarkerControl){var d={title:"动态标注",displayClass:"olControlDrawFeaturePoint",listener:f,handlerOptions:{}};OpenLayers.Util.extend(d,a);var c=null;if(e){c=CNavDefaultStyle.getStyleMap({externalGraphic:e,pointRadius:b/2});}else{c=CNavDefaultStyle.getStyleMap();}this.dynamicMarkerLayer.styleMap=new OpenLayers.StyleMap(c);this.CNavDynamicMarkerControl=new CNavDynamicMarkerControl(this.dynamicMarkerLayer,d);this.addControl(this.CNavDynamicMarkerControl);}if(!this.CNavDynamicMarkerControl.active){this.CNavDynamicMarkerControl.activate();}},stopClickListener:function(){if(this.CNavDynamicMarkerControl){this.CNavDynamicMarkerControl.deactivate();}},getRenderedDimensions:function(c,b,a){return OpenLayers.Util.getRenderedDimensions(c,b,{displayClass:a});},clearAllElements:function(){var b=this.dynamicMarkerLayer;var a=this.staticMarkerLayer;var c=this.dynamicVectorLayer;this._clearVector(c);this._clearVector(b);this._clearMarker(a);},_clearVector:function(b){if(b){var a=b.features.length;for(var d=0;d<a;d++){var c=b.features[d];if(c&&c.popup){this.removePopup(c.popup);}}b.removeFeatures(b.features);}},_clearMarker:function(a){if(a){a.clearMarkers();this.markers=[];if(this.popups){while(this.popups.length>0){this.removePopup(this.popups[0]);}}}},bringMarkerTop:function(b){var a=b.icon.imageDiv.parentNode;var c=b.icon.imageDiv;(function(d,e){d.appendChild(e);})(a,c);},writeFeaturesToWKT:function(h){var g=new OpenLayers.Format.WKT({externalProjection:CNavUtil.EPSG4326,internalProjection:CNavUtil.EPSG900913});var c=this.getControlsByClass("OpenLayers.Control.ModifyFeature");var f=c[0].selectControl;var d=this.dynamicVectorLayer.selectedFeatures;for(var b=0;b<d.length;b++){var a=d[b];f.unselect(a);}var d=this.dynamicVectorLayer.features;var e="";if(d&&(d.length>0)){e=g.write(this.dynamicVectorLayer.features);}h(e);return e;},showFeaturesFromWKT:function(d,c){var e=new OpenLayers.Format.WKT({externalProjection:CNavUtil.EPSG4326,internalProjection:CNavUtil.EPSG900913});var b=e.read(d);var a=this.dynamicVectorLayer.style;this.dynamicVectorLayer.style=c.getStyle();this.dynamicVectorLayer.addFeatures(b);this.dynamicVectorLayer.style=a;},removeSelectedFeature:function(){var c=this.getControlsByClass("OpenLayers.Control.ModifyFeature");var e=c[0].selectControl;var d=this.dynamicVectorLayer.selectedFeatures;for(var b=0;b<d.length;b++){var a=d[b];e.unselect(a);this.dynamicVectorLayer.removeFeatures(a);}},openTrafficLayer:function(a){if(!this.trafficLayer){this.trafficLayer=new CNavTrafficTileCache("trafficLayer",TRAFFIC_PIV_URL,{timeCallback:a,isBaseLayer:false,visibility:false});this.addLayer(this.trafficLayer);this.trafficLayer.registerRefresh();this.trafficLayer.start();}else{this.trafficLayer.timeCallback=a;this.trafficLayer.start();}},closeTrafficLayer:function(){if(this.trafficLayer){this.trafficLayer.setVisibility(false);this.trafficLayer.stopInterval();}},openHistoryTrafficLayer:function(a,b){if(!this.trafficLayer){this.trafficLayer=new CNavTrafficTileCache("trafficLayer",TRAFFIC_PIV_URL,{isBaseLayer:false,visibility:false});this.addLayer(this.trafficLayer);this.trafficLayer.registerRefresh();this.trafficLayer.toHistory(a,b);}else{this.trafficLayer.setVisibility(true);this.trafficLayer.toHistory(a,b);}},closeHistoryTrafficLayer:function(b,a){if(b){this.openTrafficLayer(a);}else{if(this.trafficLayer){this.trafficLayer.setVisibility(false);}}},getStaticMap:function(b,a){CNavUtil.__getStaticMap(b,a,this);},getTypeList:function(){return TYPE.POIType;},getCityList:function(){return[CITY.provinceList,CITY.specialRegionList];},registerEvents:function(a){this.events.on(a);},unregisterEvents:function(a){this.events.un(a);},CLASS_NAME:"CNavMap"});